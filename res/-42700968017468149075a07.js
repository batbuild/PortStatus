
/*---
/js/bs/bs.js
---*/
window.name="tcMain";window.$j=window.$j||jQuery.noConflict;var OO={extend:function(a,b){return $j.extend({},a,b);},bindAll:function(b){var a=new Object();for(var c in b){if(typeof(b[c])=="function"){a[c]=b[c].bind(a);}else{a[c]=b[c];}}return a;}};var BS={Log:{log:function(b,c){var a=window.console;if(a&&a[c]){a[c](b);if(b.stack){a[c](b.stack);}}},error:function(a){this.log(a,"error");},warn:function(a){this.log(a,"warn");},info:function(a){this.log(a,"info");},debug:function(a){this.log(a,"debug");}},loadingUrl:window["base_uri"]+"/img/spinner.gif",loadingIcon:'<i class="icon-refresh icon-spin"></i>',_canReload:true,_temporaryBlocked:false,_tempBlockedTimer:null,stopObservingInContainers:function(c){if(c.nodeType==1){c=[c];}var a=c.length;while(a--){var b=c[a];BS.Log.info("Clean all data under element "+b.id);jQuery.cleanData(b.getElementsByTagName("*"));jQuery.cleanData([b]);Element.purge(b);}},refreshBlocked:function(){return !BS._canReload||BS._temporaryBlocked;},canReload:function(){return !BS.Hider.hasVisiblePopups()&&!BS.refreshBlocked()&&document.readyState!="loading"&&document.readyState!="uninitialized";},initReloadBlocker:function(){if(BS.Browser.mozilla){$(document.body).on("mousedown",function(b,a){if(typeof BS=="object"){if(a.tagName.toUpperCase()=="A"&&a.href&&(a.href.indexOf("#")==-1||a.href.indexOf("javascript://")==-1)){BS.blockRefreshTemporary(1000);}}});}$(document.body).on("mousemove",function(){if(typeof BS!="object"){return;}BS.blockRefreshTemporary(100);});Event.observe(window,"scroll",function(){if(typeof BS!="object"){return;}BS.blockRefreshTemporary(100);});},blockRefreshTemporary:function(a){if(!BS._canReload){return;}var b=a||10*1000;if(BS._tempBlockedTimer){clearTimeout(BS._tempBlockedTimer);}BS._temporaryBlocked=true;BS._tempBlockedTimer=setTimeout(function(){BS._temporaryBlocked=false;},b);},_blockingActions:{},blockRefreshPermanently:function(a){BS._blockingActions[a||"default"]=true;BS._canReload=false;},unblockRefresh:function(a){delete BS._blockingActions[a||"default"];if(_.isEmpty(BS._blockingActions)){BS._canReload=true;if(BS._tempBlockedTimer){clearTimeout(BS._tempBlockedTimer);}BS._temporaryBlocked=false;}},_reloadTimeout:null,reload:function(b,a){if(BS._reloadTimeout){clearTimeout(BS._reloadTimeout);BS._reloadTimeout=null;}if(BS.canReload()||b){if(a){a();}else{window.location.reload(true);}}else{BS._reloadTimeout=setTimeout(function(){BS.reload(b,a);},100);}},trimText:function(b,a){b=b||"";a-=1;if(b.length>a+3){return b.substr(0,a/2)+"&hellip;"+b.substr(b.length-a/2,b.length);}return b;},ajaxRequest:function(b,a){var c=BS._patchOptions(b,a);return new Ajax.Request(b,c);},ajaxUpdater:function(a,c,b){if(a==null){return null;}if(!a.success){a={success:a};}var d=BS._patchOptions(c,b,a);return new Ajax.Updater(a,c,d);},_getRequestKey:function(a,b){if(_.isObject(b)){return a+Object.toQueryString(b);}else{if(_.isString(b)){return a+b;}else{return a;}}},_patchOptions:function(c,b,a){if(b==null){b={};}var d=b.onComplete;b.onComplete=function(e,f){var g=e.responseXML;if(g){var h=BS.XMLResponse.processErrors(g,{onAccessDeniedError:function(i){BS.XMLResponse.processRedirect(i.ownerDocument);}});if(h){return;}}else{if(BS._reloadIfReceivedHTML(e)){return;}}if(d){d.call(b,e,f);}if(a){if($(a) instanceof Element){BS.loadRetinaImages(a);}else{["success","failure"].forEach(function(i){if(a[i]){BS.loadRetinaImages(a[i]);}});}}};return b;},internalProperty:function(a,c){var b=window["internalProps"]==undefined?c:window["internalProps"][a];return b==undefined?c:b;},_reloadIfReceivedHTML:function(a){var b=a.responseText;if(a.status==200&&b.match(/^\s*<!DOCTYPE html[^>]*>.*<\/html>\s*/)){BS.reload(true);return true;}return false;}};BS.Socket=function(){var c={};var k;var l=false;var h;var j;var m=[];var b;var a=[];var d=function(o){BS.Log.debug("WebSocket: "+o);if(o.length>100){o=o.substring(0,100)+"...";}if(a.length>50){a.shift();}var n=new Date();a.push("["+n.getMinutes()+":"+n.getSeconds()+":"+n.getUTCMilliseconds()+"]: "+o);};var g=function(n){d("WebSocket failed: "+n);l=false;atmosphere.unsubscribe();if(h.state()==="pending"){h.resolve(false);}};var f=function(){l=true;clearTimeout(j);d("WebSocket connection is successfully established");m=[];for(var n in c){if(c.hasOwnProperty(n)){m.push(n);}}if(!b){b=setInterval(function(){if(m.length>0){var o=m.join(",");e(o);m=[];}},500);}BS.Socket.subscribe("ping",function(o){e("pong");});if(h.state()==="pending"){h.resolve(true);}};var e=function(n){d("Sending message '"+n+"'");k.push(n);};var i=function(){var n={url:window["base_uri"]+"/app/subscriptions",shared:false,trackMessageLength:true,transport:"websocket",fallbackTransport:"none",maxReconnectOnClose:0,headers:{"browserLocationHost":window["base_uri"]}};n.onMessage=function(o){var s=o.responseBody;d("Message received: '"+s+"'");if(s=="socketWorks"){f();return;}var t=s.indexOf("#");var q=s.substring(0,t);var r=s.substring(t+1);var p=c[q];if(p){p(r);}else{d("Message from the unexpected topic '"+q+"' was received");}};n.onTransportFailure=function(p,o){if(j){clearTimeout(j);}g("Transport failure");};n.onClose=function(o){d("WebSocket closed");if(o.status){d("Handshake response status: "+o.status);}if(l&&o.state!="unsubscribe"){l=false;BS.ServerLink.waitUntilServerIsAvailable(i);}};n.onError=function(o){d("WebSocket error: "+o.error);};n.onOpen=function(){e("testSocket");};k=atmosphere.subscribe(n);j=setTimeout(function(){g("Connection timeout");},BS.internalProperty("teamcity.ui.websocket.connectTimeout",1500));};return{init:function(n){h=$j.Deferred();if(!n){d("WebSocket are disabled on server side");h.resolve(false);return;}i();},checkSocketAvailable:function(n){h.done(function(o){n(o);});},subscribe:function(n,o){this.checkSocketAvailable(function(p){if(!p){BS.Log.warn("Attempt to subscribe using socket, that can't be opened");}else{c[n]=o;m.push(n);}});},getLog:function(){return a;}};}();BS.SubscriptionManager=function(){var e=[];var c={};var a=null;var d=false;var b=function(f){BS.ajaxRequest(window["base_uri"]+"/subscriptions.html",{method:"post",parameters:"topics="+e.join(","),onComplete:function(h){if(h&&h.status!=200){BS.ServerLink.waitUntilServerIsAvailable(function(){b(true);});return;}var k=h.responseText.trim();while(k.length!==0){var g=k.indexOf("|");var i=k.substring(0,g);k=k.substring(g+1);var l=k.indexOf("|");var j=k.substring(0,l);k=k.substring(l+1);c[i](k.substring(0,j));k=k.substring(j);}if(f){a=setTimeout(function(){b(true);},BS.internalProperty("teamcity.ui.pollInterval")*1000);}}});};return{subscribe:function(f,g){if(e.include(f)){return;}c[f]=g;e.push(f);BS.Socket.checkSocketAvailable(function(h){if(h){BS.Socket.subscribe(f,g);}else{if(!d){d=true;b(true);}}});},unsubscribe:function(g){var f=e.indexOf(g);if(f!=-1){e.splice(f,1);}},checkNow:function(){BS.Socket.checkSocketAvailable(function(f){if(!f){b(false);}});},dispose:function(){if(a){clearTimeout(a);}e=[];c={};}};}();BS.PeriodicalUpdater=Class.create(Ajax.PeriodicalUpdater,{initialize:function($super,a,c,b){this.initialFrequency=b.frequency||2;this.initialOnSuccess=b.onSuccess||Prototype.emptyFunction();this.initialOnFailure=b.onFailure||Prototype.emptyFunction();b.onSuccess=this.onSuccess.bind(this);b.onFailure=this.onFailure.bind(this);b.onException=this.onException.bind(this);this.pageVisibilitySupported=this.setupVisibilityHandler();if(a&&!a.success){a={success:a};}$super(a||{update:function(){}},c,b);},onSuccess:function(a,b){if(a&&a.status==0){this.onFailure(a,b);return;}if(!this.pageVisibilitySupported){this.frequency=this.initialFrequency;}this.failureState=false;if(this.initialOnSuccess){if(BS._reloadIfReceivedHTML(a)){return;}this.initialOnSuccess.call(this.options,a,b);}},onFailure:function(a,b){this.frequency=this.initialFrequency*5;this.failureState=true;if(this.initialOnFailure){this.initialOnFailure.call(this.options,a,b);}},onException:function(b,a){this.frequency=this.initialFrequency*5;this.failureState=true;},setupVisibilityHandler:function(){var f=BS.PageVisibility.detect();
var a=f.supported;var e=f.hiddenProperty;var b=f.visibilityChangeEvent;var c=this;function d(){if(document[e]){c.frequency=c.initialFrequency*5;}else{if(c.failureState===false){c.frequency=c.initialFrequency;}c.updateNow();}}if(BS.Cookie.get("disable-visibility-api")==1){return false;}if(a){document.addEventListener(b,d,false);}return a;}});BS.PageVisibility={detect:function(){var c,b;if(typeof document.hidden!=="undefined"){c="hidden";b="visibilitychange";}else{if(typeof document.mozHidden!=="undefined"){c="mozHidden";b="mozvisibilitychange";}else{if(typeof document.msHidden!=="undefined"){c="msHidden";b="msvisibilitychange";}else{if(typeof document.webkitHidden!=="undefined"){c="webkitHidden";b="webkitvisibilitychange";}}}}var a=typeof document.addEventListener!=="undefined"&&typeof c!=="undefined";return{supported:a,hiddenProperty:c,visibilityChangeEvent:b};}};BS.EventTracker={_subscriptions:{},_toBeInvokedListeners:[],subscribeOnEvent:function(a,b,c){this._subscribeOnEvent(a,b,"",c);},subscribeOnProjectEvent:function(b,c,a,d){this._subscribeOnEvent(b,c,"p:"+a,d);},subscribeOnBuildTypeEvent:function(b,c,a,d){this._subscribeOnEvent(b,c,"b:"+a,d);},subscribeOnUserEvent:function(a,c,b,d){this._subscribeOnEvent(a,c,"u:"+b,d);},_subscribeOnEvent:function(a,b,d,e){var c={currentValue:b,listeners:[e],id:a+";"+d};this._addSubscription(c);},_addSubscription:function(c){var b=this._subscriptions[c.id];if(b!=null){for(var a=0;a<b.listeners.length;a++){if(b.listeners[a].toString().strip()==c.listeners[0].toString().strip()){return;}}b.listeners.push(c.listeners[0]);}else{this._subscriptions[c.id]=c;}BS.SubscriptionManager.subscribe("events/"+c.id,function(d){if(c.currentValue!=d){c.currentValue=d;for(var e=0;e<c.listeners.length;e++){BS.EventTracker._addPendingListener(c.listeners[e]);}}});},_callPendingListeners:function(){for(var a=0;a<this._toBeInvokedListeners.length;a++){this._toBeInvokedListeners[a]();}this._toBeInvokedListeners=[];},_addPendingListener:function(a){if(!this._toBeInvokedListeners.include(a)){this._toBeInvokedListeners.push(a);}},startTracking:function(){setInterval(function(){BS.EventTracker._callPendingListeners();},BS.internalProperty("teamcity.ui.events.pollInterval")*1000);},checkEvents:function(){BS.SubscriptionManager.checkNow();}};BS.StatisticsMonitor=function(){var a=function(e,h,j,d){if(e!=null){var k=0;if(h>0||j>0){k=Math.round(h*100/(j+h));}if(k<0){k=100;}var c=j;if(c<0){c=0;}var i="";if(e==0){i="There are no agents";}else{if(c==0){i="All agents are busy";}else{if(c==e){i="All agents are idle";}else{i=h+(h>1?" builds are":" build is")+" running, ";i+=c+(c>1?" agents are":" agent is")+" idle";}}}var f='<div class="mug" onmouseover="BS.Tooltip.showMessage(this, {shift:{x:10,y:20}}, \''+i+'\')" onmouseout="BS.Tooltip.hidePopup()">';if(k>0){var l=16;var g=Math.round((100-k)/100*l);f+='<div class="mugStuff" style="top: '+g+"px; height: "+(l-g)+'px;"></div>';}f+="</div>";var b=BS.topNavPane.getTab("agents");b.setPostLinkContent(f);b.setCaption("Agents ("+e+")");}if(d!=null&&BS.topNavPane.getTab("queue")){BS.topNavPane.getTab("queue").setCaption("Build Queue ("+d+")");}};return{start:function(){BS.SubscriptionManager.subscribe("statistics",function(c){var b=JSON.parse(c);a(b.agentsNum,b.runningBuildsNum,b.freeAgentsNum,b.buildQueueSize);});}};}();BS.InvestigationsCounterMonitor=function(){var a=function(d,b){var c=$j(".investigationsTicker");if(c.length>0){c.removeClass("investigationsNew");c.removeClass("investigationsOld");if(d==0){c.html("");}else{var e=b?"You have some recently updated investigations, click to view":"Review your active investigations";c.html("<a class='investigationsLink' href='"+window["base_uri"]+"/investigations.html' title='"+e+"'>"+d+"</a>");c.addClass(b?"investigationsNew":"investigationsOld");}}};return{start:function(b){BS.SubscriptionManager.subscribe("investigationsCounter/"+b,function(f){var g=$j.parseXML(f).documentElement;var c=g.getElementsByTagName("investigations");if(!c||c.length!=1){return;}var e=c[0].getAttribute("activeCount");var d=c[0].getAttribute("hasNew")=="true";a(e,d);});}};}();BS.Util={wrapRelative:function(a){return $j(a).wrap('<div class="posRel"/>').parent();},place:function(b,a,c){$(b).setStyle({left:a+"px",top:c+"px"});},center:function(b,a){var c=BS.Util.computeCenter(b,a);BS.Util.place(b,c[0],c[1]);},computeCenter:function(d,a){if(!a){a=$("mainContent");}d=$(d);var b=a.getDimensions();var c=a.cumulativeOffset();var j=BS.Util.windowSize();var f=d.style.visibility;var g=d.style.display;d.setStyle({visibility:"hidden",display:"block"});var e=d.getDimensions();d.setStyle({visibility:f,display:g});var i=0;var h=Math.round(this._scrollTop()+(j[1]-e.height)/2);if(b.width>j[0]){i=Math.round(this._scrollLeft()+(j[0]-e.width)/2);}else{i=Math.round(c[0]+(b.width-e.width)/2);}if(_.isElement(a)&&a.id=="mainContent"){h=Math.max(h,0);}return[i,h];},_scrollTop:function(){return $j(window).scrollTop();},_scrollLeft:function(){return $j(window).scrollLeft();},windowSize:function(a){var b=$j(a||window);return[b.width(),b.height()];},placeNearElement:function(d,c,b){if(!b){b={};b.x=0;b.y=15;}c=$(c);var f=c.positionedOffset();var a=f[0]+b.x;var e=f[1]+b.y;BS.Util.place(d,a,e);},showNearElement:function(d,a,b){var c=$(a);if(typeof b=="undefined"){b=-180;}BS.Util.placeNearElement(c,d,{x:b,y:21});BS.Hider.showDivWithTimeout(c,{hideOnMouseOut:false});},visible:function(a){a=$(a);return jQuery(a).is(":visible");},show:function(){for(var b=0;b<arguments.length;b++){var a=$(arguments[b]);jQuery(a).show();}},hide:function(){for(var b=0;b<arguments.length;b++){var a=$(arguments[b]);jQuery(a).hide();}},toggleDependentElements:function(e,c,d,a){var b=a&&a[e];if(!b){b=e;}var f="."+c+":not(."+b+")";$j(f).hide();if(!!d){$j(f+" input:text").val("");$j(f+" input:password").val("");$j(f+" input:file").val("");$j(f+" select").prop("selectedIndex",0);$j(f+" textarea").val("");}$j("."+c+"."+b).show();},toggleVisible:function(){for(var b=0;b<arguments.length;b++){var a=$(arguments[b]);jQuery(a).toggle();}},isParameterIgnored:function(a){return !a||$j(a).parents(".non_serializable_form_elements_container").length!=0;},serializeForm:function(c){var g=Form.getElements(c);var h=BS.jQueryDropdown.namePrefix;g=g.filter(function(i){return i.type!="password"&&i.name.indexOf("prop:encrypted")==-1&&!i.name.endsWith(h)&&!BS.Util.isParameterIgnored(i);});var b,f,a=false,e;var d=g.inject({},function(i,j){if(j.name){b=j.name;f=$(j).getValue();if(f!=null&&(j.type!="submit"||(!a&&e!==false&&(!e||b==e)&&(a=true)))){if(b in i){if(!_.isArray(i[b])){i[b]=[i[b]];}i[b].push(f);}else{i[b]=f;}}}return i;});return Object.toQueryString(d);},disableFormTemp:function(e,d){var c=[];for(var b=0;b<e.elements.length;b++){var a=e.elements[b];if(!d||d(a)){this.disableInputTemp(a);c.push(a);}}BS.VisibilityHandlers.updateVisibility(e);return c;},isDisabled:function(a){return a.disabled=="disabled"||a.disabled;},disableInputTemp:function(a){a.blur();if(this.isDisabled(a)){a._wasDisabled=true;}else{a.disabled="disabled";}},reenableInput:function(a){if(typeof a._wasDisabled=="undefined"){a.disabled="";}else{a._wasDisabled=undefined;}},reenableForm:function(d,c){for(var b=0;b<d.elements.length;b++){var a=d.elements[b];if(!c||c(a)){this.reenableInput(a);}}BS.VisibilityHandlers.updateVisibility(d);},shiftToFitPage:function(b){b=$(b);if(!b||b.hasClassName("modalDialogFixed")){return;}var d=b.style.overflow;if(BS.Browser.opera||BS.Browser.msie){b.style.overflow="visible";}var g=BS.Util.windowSize();var e=BS.Util._scrollLeft();var h=b.positionedOffset();var f=b.getDimensions();var a=g[0]+e;var c=h[0];var i=h[0]+f.width;if(c<e){b.style.left=(10+e)+"px";}else{if(i>a&&f.width<a){b.style.left=(a-f.width-20)+"px";}else{if(f.width>=a){b.style.left="10px";}}}if(BS.Browser.opera||BS.Browser.msie){b.style.overflow=d;}},showHelp:function(c,b,a){Event.stop(c);var d=b.split("#");if(d.length==2){BS.Util.popupWindow(d[0]+"#"+d[1].replace(/\+/g,""),"tcHelp",a);}else{BS.Util.popupWindow(b,"tcHelp",a);
}},popupWindow:function(d,h,c){h=h||"_blank";c=c||{};var f=c.width||1000;var a=c.height||600;var b=window.open(d,h,"toolbar=no,scrollbars=yes,resizable=yes,width="+f+",height="+a);try{b.focus();}catch(g){}return b;},hideSuccessMessages:function(){if(window._shownMessages){for(var b in window._shownMessages){var a=$(b);if(a&&window._shownMessages[b]=="info"){a.style.visibility="hidden";}}window._shownMessages={};}},showIFrameIfNeeded:function(c){c=$(c);var a=BS.Util.getOrCreateDialogIFrame(c);if(a==null){return;}a.absolutize();a.clonePosition(c);var b=parseInt(c.style.zIndex,10);a.style.zIndex=""+(b-1);BS.Util.show(a);},hideIFrameIfNeeded:function(b){b=$(b);var a=BS.Util.getOrCreateDialogIFrame(b);if(a==null){return;}BS.Util.hide(a);},moveDialogIFrame:function(b){b=$(b);var a=BS.Util.getOrCreateDialogIFrame(b);if(a==null){return;}a.absolutize();a.clonePosition(b);},getOrCreateDialogIFrame:function(b){if(!BS.Browser.msie6){return null;}var a=$("iframe_"+b.id);if(a==null){a=document.createElement("iframe");a.src="javascript:false";a.id="iframe_"+b.id;document.body.appendChild(a);}return $(a);},addWordToTextArea:function(b,c){var a=b.value;if(a.length==0){b.value=c;}else{b.value=a+" "+c;}},processError:function(a){if(a.message){alert(a.message);}else{alert(a.toString());}},changeChildrenColor:function(e,b){var a=b.color;var f=b.backgroundColor;var d=b.filter;var g=e.childNodes;for(var c=0;c<g.length;c++){if(d&&!d(g[c])){continue;}if(g[c].style){if(a!=null){g[c].style.color=a;}if(f!=null){g[c].style.backgroundColor=f;}}}},documentRoot:function(a){if(!a.responseXML){return null;}return a.responseXML.documentElement;},trimSpaces:function(a){return a.replace(/^\s+(.*)/,"$1").replace(/(.*?)\s+$/,"$1");},makeBreakable:function(b,a){a=a?new RegExp("("+a+")","g"):/(.{60})/g;return b.replace(a,"$1<wbr/>");},formatSeconds:function(f,c){if(f<0){return"N/A";}if(f==0){return"&lt;1s";}var a="";var d=parseInt(f);if(d>=3600){var b=Math.floor(d/3600);d-=b*3600;a+=b+"h";}if(d>=60){var e=Math.floor(d/60);d-=e*60;if(a!=""){a+=":";}a+=e+"m";}if(d>0&&c){f=d;if(a!=""){a+=":";}a+=f+"s";}else{if(a==""){a="&lt;1m";}}return a;},selectAll:function(b,a){this._setChecked(b,a,true);},unselectAll:function(b,a){this._setChecked(b,a,false);},getSelectedValues:function(d,b){var a=[];var e=Form.getInputs(d,"checkbox",b);for(var c=0;c<e.length;c++){if(e[c].checked){a.push(e[c].value);}}return a;},_setChecked:function(d,a,c){var e=Form.getInputs(d,"checkbox",a);for(var b=0;b<e.length;b++){if(!e[b].disabled){e[b].checked=c;}}},descendantOf:function(b,a){while(b!=null){if(b===a){return true;}b=b.parentNode;}return false;},isDetached:function(a){if(a.id){return $(a.id)!==a;}if(a===document.documentElement||a===window||a===document){return false;}if(a.parentNode==null){return true;}return BS.Util.isDetached(a.parentNode);},runWithElement:function(a,b,c){if(!c){c=1000;}BS.WaitFor(function(){return $(a)&&!BS.Util.isDetached($(a));},b,c/1000);},setTitle:function(a){document.title=a?a+" \u2014 TeamCity":"TeamCity";},capitalize:function(a){return a.replace(/\s+(\w)/g,function(b,c){return" "+c.toUpperCase();});},fadeOutAndDelete:function(a){$j(a).fadeOut("fast",function(){$j(this).remove();});},createDelayedInvocator:function(a,b){return{_timeoutId:null,invoke:function(){if(this._timeoutId){clearTimeout(this._timeoutId);}var c=this;this._timeoutId=setTimeout(function(){c._timeoutId=null;a();},b);}};},escapeId:function(a){if(a.toString().match(/^#/)){return a;}return"#"+a.toString().replace(/(:|\.)/g,"\\$1");},getTextChildren:function(a){return $j(BS.Util.escapeId(a)).contents().filter(function(){return this.nodeType==3;});},getLineFeed:function(){return navigator.userAgent.toLowerCase().match(/windows/)?"\r\n":"\n";},isModifierKey:function(a){return a&&(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey);},installPlaceHolder:function(a,b,c){a=$(a);b=b.trim();if(c){a.value=b;}if(a.value.trim()==b){a.style.color="gray";}a.on("focus",function(){if(this.value.trim()==b){this.value="";this.style.color="black";}});a.on("blur",function(){if(this.value.trim().length==0){this.value=b;this.style.color="gray";}});},paramsFromHash:function(f){var b={};var e=document.location.hash;if(e.length>1){e=e.substring(1);var g=e.split(f||"&");for(var d=0;d<g.length;d++){var a=g[d].indexOf("=");if(a==-1){continue;}var c=g[d].substring(0,a);b[c]=g[d].substring(a+1);}}return b;},setParamsInHash:function(g,e,f){var d="";for(var c=0;c<g.length;c+=2){d+=g[c]+"="+g[c+1]+e;}if(d.length>0){d=d.substring(0,d.length-1);}if(f){var b=document.location.href;var a=b.indexOf("#");if(a!=-1){b=b.substring(0,a);}b+="#"+d;document.location.replace(b);}else{document.location.hash=d;}},syncValues:function(d,e){var c=d.value;var b=e.value;var a=e.getAttribute("generated");if(b.length==0||(a!=null&&b==a)){e.value=c;e.setAttribute("generated",c);$j(e).trigger("keyup");}},_visibilityAPI:null,isPageVisible:function(){if(this._visibilityAPI==null){this._visibilityAPI=BS.PageVisibility.detect();}return !this._visibilityAPI.supported||!document[this._visibilityAPI.hiddenProperty];}};BS.Hider={hidingDivs:{},allDivs:{},afterHideFuncs:{},hasVisiblePopups:function(){return !$j.isEmptyObject(this.allDivs);},_currentZindex:function(){if(this._shownStack.length==0){return 10;}var a=this._shownStack[this._shownStack.length-1];return parseInt($(a).style.zIndex,10)+5;},addHideFunction:function(c,b){if(typeof this.afterHideFuncs[c]=="function"){var a=this.afterHideFuncs[c];this.afterHideFuncs[c]=function(){b();a();};}else{this.afterHideFuncs[c]=b;}},showDivWithTimeout:function(d,a){var b=$(d);d=b.id;if(!a){a={};}if(a.hideOnMouseOut===undefined){a.hideOnMouseOut=true;}if(a.hideOnMouseClickOutside===undefined){a.hideOnMouseClickOutside=true;}if(a.draggable===undefined){a.draggable=false;}if(!_.isElement(a.dragHandle)){a.draggable=false;}var c=this._currentZindex();if(a.zIndex===undefined||a.zIndex<c){a.zIndex=c;}if(a.afterHideFunc!=undefined){this.addHideFunction(d,a.afterHideFunc);}if(!b.hasClassName("modalDialog")){b.style.position="absolute";}b.style.zIndex=""+a.zIndex;BS.Util.show(d);BS.Util.shiftToFitPage(d);BS.Util.showIFrameIfNeeded(d);this.allDivs[d]=d;this.stopHidingDiv(d);this._shownStack.indexOf(d)<0&&this._shownStack.push(d);this._setupHandlers(d,a);BS.VisibilityHandlers.updateVisibility(d);b._hideOnMouseClickOutside=false;if(a.hideOnMouseClickOutside){setTimeout(function(){b._hideOnMouseClickOutside=true;}.bind(this),10);}if(a.draggable&&!b._draggable){b._draggable=new Draggable(d,{starteffect:function(){},endeffect:function(){},change:function(){BS.Util.moveDialogIFrame(d);$j(window).off("resize.modalDialog scroll.modalDialog");},handle:a.dragHandle});}},startHidingDiv:function(c,a){if(a==undefined){a=500;}c=$(c).id;this.stopHidingDiv(c,true);var b=this;this.hidingDivs[c]=setTimeout(function(){if(b.hidingDivs[c]){var d;$j("span.toggle").each(function(){if(this.getAttribute("data-popup")==c){d=this.getAttribute("data-pinned")==="true";return false;}});if(!d){b.hideDivSingle(c);}}},a);},hideDiv:function(e){var d=-1;for(var b=0;b<this._shownStack.length;b++){if(this._shownStack[b]==e){d=b;break;}}if(d!=-1){var c=this._shownStack.length-d;while(c>0){var a=this._shownStack.pop();this.hideDivSingle(a);c--;}}if(this.afterHideFuncs[e]){this.afterHideFuncs[e]();delete this.afterHideFuncs[e];}},hideDivSingle:function(b){BS.Util.hideIFrameIfNeeded(b);this.stopHidingDiv(b,true);delete this.allDivs[b];$j("span.toggle").each(function(){if(this.getAttribute("data-popup")==b){this.removeAttribute("data-pinned");this.removeAttribute("data-popup");return false;}});var a=$(b);if(a&&a._draggable){a._draggable.destroy();a._draggable=null;}Event.stopObserving(a);BS.Util.hide(a);this._runAfterHide(b);},_runAfterHide:function(a){if(this.afterHideFuncs[a]){this.afterHideFuncs[a]();delete this.afterHideFuncs[a];}},stopHidingDiv:function(d,b){var c=$(d).id;if(this.hidingDivs[c]){if(b){clearTimeout(this.hidingDivs[c]);}else{for(var a=0;a<this._shownStack.length;a++){clearTimeout(this._shownStack[a]);
if(this._shownStack[a]==c){break;}}}delete this.hidingDivs[c];}},hideAll:function(b){var d=[];for(var a in this.allDivs){if(!$(a)){continue;}d.push($(a));}d.sort(function(i,h){var g=parseInt(i.style.zIndex,10);var f=parseInt(h.style.zIndex,10);return g-f;});for(var c=d.length-1;c>=0;c--){var e=d[c];if(e==b){break;}if(!e._hideOnMouseClickOutside){break;}this.hideDiv(e.id);e._hideOnMouseClickOutside=true;}$j("span.toggle").each(function(){if(b&&this.getAttribute("data-popup")==b.id){return false;}this.removeAttribute("data-pinned");this.removeAttribute("data-popup");});},_shownStack:[],_setupHandlers:function(c,a){var b=$(c);if(a.hideOnMouseOut){b.on("mouseout",function(){if(document.activeElement){if(a.overrideHideIfActive&&document.activeElement==$(a.overrideHideIfActive)){return;}}var d=BS.Hider._shownStack[BS.Hider._shownStack.length-1];if(d!=c){return;}if(typeof a.hideOnMouseOut=="function"){if(!a.hideOnMouseOut()){return;}}BS.Hider.startHidingDiv(c);});}b.on("mouseover",function(){BS.Hider.stopHidingDiv(c);});},_escapeHandler:function(a){if(this._shownStack.length==0){return;}if(a.keyCode==Event.KEY_ESC){var b=this._shownStack[this._shownStack.length-1];BS.Hider.hideDiv(b);return false;}}};jQuery(document).ready(function(){var a=document.getElementById("bodyWrapper")||document.getElementById("mainContent");jQuery(a).on("click",function(f){var c=f.target;var b=null;for(var g in BS.Hider.allDivs){var d=$(g);if(!d){continue;}if(BS.Util.descendantOf(c,d)){b=d;break;}}BS.Hider.hideAll(b);});$j(document).on("keydown",BS.Hider._escapeHandler.bind(BS.Hider));});BS.Navigation={items:[],siblingsNavType:null,writeBreadcrumbs:function(){if(this.items.length==0){return;}$j("#mainNavigation").html(this.getItemsHtml()).css("visibility","visible");var a=this;$j(document).ready(function(){a._renderSiblingsNav();});this._selectHeaderTabIfNeeded();$j(document).trigger("bs.navigationRendered");},getItemsHtml:function(){var a="";for(var b=0;b<this.items.length-1;b++){a+=this._writeItem(this.items[b]);}if(this.items.length>0){a+=this._writeItem(this.items[this.items.length-1],"last");}return a;},_writeItem:function(c,f){function e(){var i=$j(window).width();if(i>1600){return 120;}else{if(i>1400){return 100;}else{if(i>1200){return 80;}else{if(i>1000){return 70;}else{return 50;}}}}}function b(k,i){var j=k.substr(i);var l=$j(j).text();var m=e();if(l.length>m){if(j.indexOf("<script")>-1||j.indexOf("<a")>-1){return j;}l=BS.trimText(l,m);j="<small>"+l+"</small>";}return j;}var g=c.title,a=g.indexOf("<small>");var h=[],d=[];h.push(f);if(c.selected){h.push("selected");}if(c.itemClass){h.push(c.itemClass);}if(c.url){if(a>=0){g='<a href="'+c.url+'">'+$j.trim(c.title.substr(0,a))+"</a>"+"&nbsp;"+b(g,a);}else{g='<a href="'+c.url+'">'+$j.trim(c.title)+"</a>";}}else{if(a>=0){g=g.substr(0,a)+b(g,a);}}if(c.siblingsTree){this._addSiblingsTreeNav(c);}else{if(c.siblings){this._prepareSiblingsNav(c);}}if(c.projectId){d.push('data-projectId="'+c.projectId+'"');}if(c.buildTypeId){d.push('data-buildTypeId="'+c.buildTypeId+'"');}h=h.join(" ");d=d.join(" ");return'<li class="'+$j.trim(h)+'"'+d+'><div class="contentWrapper">'+g+"</div></li>";},_addSiblingsTreeNav:function(a){if(!this.siblingsTreeNav){this.siblingsTreeNav=[];}this.siblingsTreeNav.push(a);},_prepareSiblingsNav:function(a){this.siblingsNav=a;},_renderSiblingsNav:function(){var b=$j("#mainNavigation"),e=null;if(this.siblingsTreeNav){for(var c=0;c<this.siblingsTreeNav.length;++c){var d=this.siblingsTreeNav[c];var a=null;if(d.projectId){a=b.find("[data-projectId='"+d.projectId+"'] .contentWrapper");}else{if(d.buildTypeId){a=b.find("[data-buildTypeId='"+d.buildTypeId+"'] .contentWrapper");}}if(!a||!a.length){continue;}(function(h){var g="";if(h.projectId){g="projectIcon";}else{if(h.itemClass=="buildTypeTemplate"){g="buildTypeTemplateIcon";}else{g="buildTypeIcon";}}var f=$j("<i/>",{"class":["icon",g].join(" "),prependTo:a});if(h.siblingsTree.parentId){function i(){var j=h.siblingsTree;BS.SiblingsTreePopup.show(f,{showArchived:false,markedId:h.projectId||h.buildTypeId,projectId:j.parentId,projectUrlFormat:j.projectUrlFormat,buildTypeUrlFormat:j.buildTypeUrlFormat});return false;}f.click(i);$j(document).off("keydown.j").on("keydown.j",function(k){if(k.keyCode==74&&!BS.Util.isModifierKey(k)){var j=$j(k.target);if(j.is("input")||j.is("textarea")||j.is("select")){return;}i();}});}else{f.css({cursor:"auto"});}})(d);}}if(this.siblingsNav){if(this.siblingsNav.siblings.type=="buildType"){e=b.find(".buildType");if(e.length==0){e=b.find("li").last();}$j(".siblingBuildTypes").appendTo(e).css("display","");BS.SiblingsPopup.install(this.siblingsNav.siblings);}}},_selectHeaderTabIfNeeded:function(){var a=this.items[0];if(a.url&&a.url.endsWith("/admin/admin.html")){this.selectAdminTab();}if(a.itemClass&&a.itemClass=="project"){this.selectProjectsTab();}},selectProjectsTab:function(){jQuery("#overview_Tab").addClass("selected");},selectAdminTab:function(){jQuery("#userPanel .info:nth-child(2)").addClass("selected");},selectMySettingsTab:function(){jQuery("#userPanel .info:nth-child(1)").addClass("selected");},fromUrl:function(c,b){var a=document.location.href;if(!a.include(c)&&a.include(encodeURIComponent(c))){c=encodeURIComponent(c);}return a.replace("="+c,"="+(b||"{id}"));}};BS.Highlight=function(b,a){new Effect.Highlight(b,_.extend(a||{},{startcolor:"#ffffcc",duration:1,keepBackgroundImage:true}));};BS.Logout=function(a){BS.ajaxRequest(a,{onComplete:function(b){BS.XMLResponse.processRedirect(b.responseXML);}});};BS.XMLResponse={processModified:function(b,c){if(!c){return;}var a=c.documentElement;b.setModified(a.firstChild&&a.firstChild.nodeValue=="modified");},processRedirect:function(b){if(!b){return false;}var a=b.documentElement;var c=a.getElementsByTagName("redirect")[0];if(c&&!c.firstChild.nodeValue.startsWith("javascript:")){document.location.href=c.firstChild.nodeValue;return true;}return false;},processErrors:function(h,f,b){var j=this._getErrorNodes(h);if(!j||j.length==0){return false;}var e=false;for(var d=0;d<j.length;d++){var c=j.item(d);var a=c.getAttribute("id");var g="on"+a.charAt(0).toUpperCase()+a.substring(1)+"Error";var k=f[g]||f[a];if(k&&typeof(k)=="function"){if(c){k.apply(f,[c]);}e=true;}else{if(b){b(a,c);e=true;}}}return e;},_xmlErrorsXml:function(f){var b=f.getElementsByTagName("errors");if(!b||b.length==0||b[0].getElementsByTagName("error").length==0){return[];}var g=b[0].getElementsByTagName("error");var a=[];for(var c=0;c<g.length;c++){var d=g[c];a.push([d.getAttribute("id"),d.firstChild.nodeValue]);}return a;},_getErrorNodes:function(d){var a=d.documentElement;if(a==null){return null;}var c=a.getElementsByTagName("errors");if(!c||c.length==0){return null;}var b=c.item(0);return b.getElementsByTagName("error");}};BS.StopBuild=function(b,c,a){if(a){Form.disable(a);}BS.ajaxRequest(b+"?kill="+c,{onComplete:function(){setTimeout(function(){BS.reload(true);},3000);}});return false;};BS.TableHighlighting={};BS.TableHighlighting.createInitElementFunction=function(){var a=this;var b=function(c){c=$(c);c.on("mouseover",function(){if(typeof(BS)=="undefined"){return;}BS.Util.changeChildrenColor(this.parentNode,{color:"#254193",backgroundColor:"#ffffcc",filter:function(d){return d.nodeType==1&&d.className.indexOf("highlight")>=0;}});}.bind(c));c.on("mouseout",function(){if(typeof(BS)=="undefined"){return;}BS.Util.changeChildrenColor(this.parentNode,{color:"",backgroundColor:"",filter:function(d){return d.nodeType==1&&d.className.indexOf("highlight")>=0;}});}.bind(c));};if(!a.nodeType){return b;}else{return b(a);}};BS.Refreshable={createRefreshFunction:function(b,d,c){var a=$(b);if(!a){return Prototype.emptyFunction;}return function(i,h,g){if(BS.ServerLink&&!BS.ServerLink.isConnectionAvailable()){BS.Log.info("Connection to server is not available. Refresh is not called.");return;}if(!h){h="";}if(i&&$(i)){BS.Util.show(i);}var f=a.refreshUrl;if(!f){f=d;}var e=c?"jsp="+c:"__fragmentId="+b+"Inner";BS.ajaxRequest(f,{method:"get",parameters:e+(h?"&"+h:""),onFailure:function(){BS.Log.warn("Failure while refreshing "+b);
},onComplete:function(k){var j=k.request.getStatus();var l=!j||(j>=200&&j<300);if(!l){return;}BS.stopObservingInContainers(a);BS.Refreshable.destroySortables(a);a.update(k.responseText);BS.loadRetinaImages(a);BS.Util.hide(i);_.isFunction(g)&&g();}});};},destroySortables:function(b){if(typeof(Sortable)=="undefined"){return;}if(!_.isEmpty(Sortable.sortables)){Sortable.destroy(b);var d=b.getElementsByTagName("*"),a=d.length;for(var c=0;c<a;c++){if(Sortable.sortables[d[c].id]){Sortable.destroy(d[c]);BS.Log.debug("Destroying sortable under "+d[c].id);if(_.isEmpty(Sortable.sortables)){return;}}}}}};BS.WaitFor=function(f,e,c){if(!c){c=10;}var d=c*1000/50;var a=0;var b=function(){if(!f()&&d>a++){setTimeout(b,50);}else{e();}};b();};Event.observe(window,"unload",function(){BS.PeriodicalRefresh.stop();});BS.PeriodicalRefresh=Class.create();BS.PeriodicalRefresh._removeIntervalUpdate=function(){if(this._timeoutId){clearTimeout(this._timeoutId);}};BS.PeriodicalRefresh.start=function(a,c){this._removeIntervalUpdate();this._timeoutId=null;var d=this;var b=function(){d._timeoutId=setTimeout(function(){BS.reload(false,c);b();},a*1000);};if(a>0){b();}};BS.PeriodicalRefresh.stop=function(){this._removeIntervalUpdate();};(function(a){BS.InPlaceFilter={applyFilter:function(d,b,f){var c=d instanceof a?d:a(BS.Util.escapeId(d));var e=b.value.toUpperCase();if(e==this.prevKeyword){return;}var i=this.prevKeyword!=null&&e.indexOf(this.prevKeyword)!=-1;this.prevKeyword=e;var h=c.find(".inplaceFiltered");var g=this;h.each(function(j){var k=this;if(i&&!g.isVisible(k)){return;}if(!e){g.showElement(k,j);}else{g.performSearch(k,e,j);}});this.toggleOptgroups(e,c,h);if(f){f.call(this,b);}},performSearch:function(d,c,b){var f=this.getContent(d);var e=f.indexOf(c)>-1;if(!e){this.hideElement(d,b);}else{this.showElement(d,b);}return e;},hideElement:function(c,b){if(c.tagName.toUpperCase()=="OPTION"){if(c.className.indexOf("optgroup")==-1){this.hideOption(c,b);}}else{if(c.tagName.toUpperCase()!="OPTGROUP"){BS.Util.hide(c);$j(c).data("visibleElem",false);}}},showElement:function(c,b){if(this.isHiddenOption(c)){this.showOption(c,b);}else{BS.Util.show(c);$j(c).data("visibleElem",true);}},isVisible:function(b){return b.style.display!="none";},getContent:function(e){var d=e._cachedContent;if(d!=null){return d;}d="";if(e.getAttribute("data-title")){d=e.getAttribute("data-title");}else{for(var b=0;b<e.childNodes.length;b++){var c=e.childNodes[b];if(c.nodeType==1&&c.className.indexOf("noSearch")==-1){d+=this.getContent(c);}if(c.nodeType==3){d+=c.nodeValue;}}}e._cachedContent=d.replace(/[\s]+/g," ").strip().toUpperCase();return e._cachedContent;},isHiddenOption:function(b){return b.className&&b.className.indexOf("hiddenOption")!=-1;},hideOption:function(e,b){var c=e.parentNode;if(!c._hiddenOptions){c._hiddenOptions={};}c._hiddenOptions[b]=e;var d=document.createElement("SPAN");d.className="inplaceFiltered hiddenOption";d._cachedContent=this.getContent(e);if(e.disabled){d.disabled=true;}if(e.className.indexOf("optgroup")>-1){d.className+=" optgroup";}d.setAttribute("data-filter-data",e.getAttribute("data-filter-data"));c.insertBefore(d,e);c.removeChild(e);},showOption:function(d,b){var c=d.parentNode;if(c&&c._hiddenOptions[b]){c.insertBefore(c._hiddenOptions[b],d);c.removeChild(d);c._hiddenOptions[b]=null;}},toggleOptgroups:function(d,c,f){if(c.prop("tagName").toUpperCase()=="SELECT"){function b(h){var g=h.tagName.toUpperCase();return g=="OPTION"||g=="SPAN";}var e=this;f.each(function(i){var j=this.className;if(!j.include("optgroup")||!b(this)){return;}var h=e.getContent(this).include(d),l=this.nextSibling,k=parseInt(this.getAttribute("data-filter-data")||"0");while(l&&!h){if(l.nodeType==1&&b(l)){var g=l.getAttribute("data-filter-data");if(g){if(k>=parseInt(g)){break;}}else{if(l.disabled){break;}}h=e.isVisible(l)&&e.getContent(l).include(d);}l=l.nextSibling;}if(h){j.include("hiddenOption")&&e.showOption(this,i);}else{!j.include("hiddenOption")&&e.hideOption(this,i);}});}},prepareFilter:function(d){var c=a(BS.Util.escapeId(d));function e(j){var f=(j instanceof a)?j.attr("data-filter-data"):j.getAttribute("data-filter-data");if(!f){return"";}var k=parseInt(f);var g=[];for(var h=0;h<4*k;++h){g.push("&nbsp;");}return g.join("");}if(c.length>0&&c.prop("tagName").toUpperCase()=="SELECT"){var b=null;c.children("option").each(function(){var f=this;f.innerHTML=e(f)+f.innerHTML;if(b&&parseInt(f.getAttribute("data-filter-data")||"0")>parseInt(b.getAttribute("data-filter-data")||"0")){a(b).addClass("optgroup");}b=f;});c.children("optgroup").each(function(){var g=a(this),f=this.getElementsByTagName("option");if(f.length==0){g.remove();return;}for(var h=f.length-1;h>=0;h--){var j=f[h];g.after(j);j.innerHTML=e(j)+j.innerHTML;}j=a('<option class="inplaceFiltered optgroup" disabled="disabled">'+e(g)+g.attr("label").escapeHTML()+"</option>");j.attr("data-filter-data",g.attr("data-filter-data"));g.replaceWith(j);});}}};a.fn.inplaceFilter=function(c,e){var d=this;var b=a(BS.Util.escapeId(c));d.on("keyup",_.throttle(function(){BS.InPlaceFilter.applyFilter(b,d.get(0),e);},100));};})(jQuery);BS.VisibilityHandlers={_emptyHandler:{updateVisibility:function(){}},_handlers:{},attachTo:function(d,a){var b=$(d).id;var c=this._handlers[b];if(c==null){c=[];this._handlers[b]=c;}c.push(a);},detachFrom:function(a){this._handlers[a]=null;},_visibilityHandler:function(a){if(!a||!a.id){return this._emptyHandler;}var b=this._handlers[a.id];if(b==null){return this._emptyHandler;}return{updateVisibility:function(){for(var c=0;c<b.length;c++){b[c].updateVisibility();}}};},_collectElements:function(b){var a=[];if(b==null){return a;}if(b.id){a.push(b);}if(b.id=="mainContent"){for(var d in this._handlers){if(!this._handlers.hasOwnProperty(d)){continue;}a.push($(d));}}else{for(var d in this._handlers){if(!this._handlers.hasOwnProperty(d)){continue;}var c=$(d);if(BS.Util.descendantOf(c,b)){a.push(c);}}}return a;},updateVisibility:function(c){if(c==null){return;}var a=this._collectElements($(c));for(var b=0;b<a.length;b++){this._visibilityHandler(a[b]).updateVisibility();}}};BS.User={setProperty:function(b,c,a){this._setProperty(b,c,a,"setUserProperty");},deleteProperty:function(b,a){this._beforeChange(a);BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"deleteUserProperty="+b,onComplete:function(){BS.User._afterChange(a);}});},setBooleanProperty:function(b,c,a){if(c){this.setProperty(b,c,a);}else{this.deleteProperty(b,a);}},setSessionProperty:function(b,c,a){this._setProperty(b,c,a,"setSessionProperty");},_setProperty:function(c,d,b,a){if(!b){b={};}this._beforeChange(b);BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:a+"="+c+"&value="+d,onComplete:function(){BS.User._afterChange(b);}});},_beforeChange:function(a){if(a&&a.progress){BS.Util.show(a.progress);}},_afterChange:function(a){a=a||{};if(a.afterComplete){a.afterComplete();}if(a.progress){BS.Util.hide(a.progress);}}};BS.DelayedAction=function(a,c,b){if(!b){b=300;}this.delay=b;this.action=a;this.stop_action=c;};BS.DelayedAction.prototype.start=function(){this.timeout=setTimeout(this.action,this.delay);};BS.DelayedAction.prototype.stop=function(){clearTimeout(this.timeout);this.stop_action.call(this);};BS.DelayedShow=function(a){BS.DelayedAction.call(this,function(){if($(a)){$(a).show();}},function(){if($(a)){$(a).hide();}});};BS.DelayedShow.prototype=new BS.DelayedAction();BS.DelayedShow.prototype.show=BS.DelayedShow.prototype.start;BS.DelayedShow.prototype.hide=BS.DelayedShow.prototype.stop;Ajax.Responders.register({onException:function(a,b){BS.Log.error(b);}});BS.jQueryDropdown=function(a,d){var g=jQuery(a);var i=g.attr("id");if($(BS.jQueryDropdown.namePrefix+i)){try{jQuery($(i)).ufd("destroy");}catch(h){BS.Log.warn(h);}}var c=g.get(0);var b=c.name;i=c.id;var f="ufd";if(g.attr("class")){f+=" "+g.attr("class");}g.ufd(jQuery.extend(true,d||{},{css:{button:BS.jQueryDropdown.namePrefix+(b?b:i),wrapper:f},calculateZIndex:true,zIndexPopup:BS.Hider._currentZindex()}));return g;
};BS.jQueryDropdown.namePrefix="-ufd-teamcity-ui-";BS.jQueryDropdown.setJQueryOptions=function(a){if(a.ui&&a.ui.ufd){a.ui.ufd.defaults.skin="default";a.ui.ufd.defaults.prefix=BS.jQueryDropdown.namePrefix;a.ui.ufd.prototype.options=a.ui.ufd.defaults;}};BS.jQueryDropdown.setJQueryOptions(jQuery);BS.deleteRedundantOptions=function(a){$j("option.user-delete",a||"select").remove();};BS.openUrl=function(b,a){if(Event.element(b)&&Event.element(b).tagName.toUpperCase()=="A"){return true;}else{if(Event.isLeftClick(b)){if(b.ctrlKey||b.metaKey){window.open(a);}else{document.location.href=a;}}else{if(Event.isMiddleClick(b)){window.open(a);}else{if(!Event.isRightClick(b)){document.location.href=a;}}}}return false;};BS.goBack=function(c,a){var b=window.location.protocol+"//"+window.location.host;BS.openUrl(c,b+a);return false;};BS.fixCancel=function(){$j(function(){var a=window.location.protocol+"//"+window.location.host;$j(".btn.cancel").each(function(){var c=$j(this),b=c.attr("href");if(b&&b!="#"&&!b.startsWith(a)){b=a+b;c.attr("href",b);}});});};BS.LoadStyleSheetDynamically=function(a,g){var c=document.getElementsByTagName("head")[0];var f=null;var b;jQuery('link[type="text/css"], style').each(function(){if(this.tagName.toLowerCase()=="link"&&this.href==a||this.getAttribute("data-href")==a){f=this;return false;}});var d;var e=function(h,i){if(h.getAttribute("data-loaded")){clearInterval(d);i();}};if(!g){if(f){return;}b=document.createElement("link");b.type="text/css";b.rel="stylesheet";b.title="dynamicLoadedSheet";b.href=a;if(!BS.Browser.msie){c.appendChild(b);}else{c.insertBefore(b,c.firstChild);}}else{if(!f){b=document.createElement("style");b.type="text/css";b.setAttribute("data-href",a);if(!BS.Browser.msie){c.appendChild(b);}else{c.insertBefore(b,c.firstChild);}jQuery.get(a,function(h){if(BS.Browser.msie&&parseInt(BS.Browser.version,10)<9){b.styleSheet.cssText=h;}else{b.textContent=h;}b.setAttribute("data-loaded",true);g();});}else{if(f.tagName.toLowerCase()=="style"){d=setInterval(function(){e(f,g);},50);}else{g();}}}};BS.loadRetinaImages=function(a){if(Retina.isRetina()){jQuery(a).find("img").each(function(){if(!this.getAttributeNode("data-no-retina")){if(this.src.indexOf("/empty.png")<0){new RetinaImage(this);}}});}};BS.updateRetinaImage=function(a){if(Retina.isRetina()&&!a.getAttributeNode("data-no-retina")){new RetinaImage(a);}};(function(){var e=navigator.userAgent.toLowerCase(),c=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],a=c[1]||"",d=c[2]||0,f=a==="msie";BS.Browser={version:d,msie:f,msie6:f&&d==6,mozilla:a==="mozilla",opera:a==="opera",webkit:a==="chrome"||a==="webkit"};})();BS.stopPropagation=function(a){if(BS.Browser.msie){a.cancelBubble=true;}else{a.stopPropagation();}};(function(a){BS.MultiSelect={init:function(d,e){var c=a(d);if(!c.length){return;}c.find("input").each(function(){var f=a(this);if(f.hasClass("group")){f.on("change",function(){var g=f.parent().parent(),i=parseInt(g.attr("data-depth")||"0"),h=this.checked;g.nextAll().each(function(j,l){l=a(l);var k=parseInt(l.attr("data-depth")||"0");if(k>i){l.find("input").prop("checked",h);return true;}else{return false;}});e&&e();});}else{f.on("change",function(){e&&e();});}});var b=[];c.find(".inplaceFiltered").each(function(){var f=a(this);var i=parseInt(f.attr("data-depth"));if(!b.length){b.push(f);return;}while(b.length){var h=b[b.length-1];var g=parseInt(h.attr("data-depth"));if(g==i){f.data("parent",h.data("parent"));b[b.length-1]=f;break;}else{if(i>g){f.data("parent",h);b.push(f);break;}else{b.pop();}}}});},update:function(c,b){if(!b.value){return;}a(c).find(".inplaceFiltered:visible").each(function(){var d=a(this);var g=parseInt(d.attr("data-depth"));var f=d;while(g>0){g--;var e=f.data("parent");if(!e){e=f.prevAll(".user-depth-"+g+":first");f.data("parent",e);}e.show();f=e;}});}};})(jQuery);function fixErrorMessage(a){return a.escapeHTML().replace(/(\w{40})/g,"$1<wbr>");}BS.ScrollUtil={win:$j(window),doc:$j(document),body:function(){return $j("#bodyWrapper");},getVerticalScroll:function(){return this.win.scrollTop();},getHorizontalScroll:function(){return this.win.scrollLeft();},getContentHeight:function(){return this.body().height();},getWindowHeight:function(){return this.win.height();},isScrollAtBottom:function(c){var b=this.getContentHeight();var a=this.getVerticalScroll();var d=this.getWindowHeight();if(c==undefined){c=20;}return Math.abs(d+a-b)<c;},scrollToBottom:function(){this.win.scrollTop(this.getContentHeight());}};;
/*---
/js/bs/cookie.js
---*/
BS.Cookie={};BS.Cookie.set=function(a,d,c,f){var e=a+"="+encodeURIComponent(d);if(c!=null){var b=new Date();b.setTime(new Date().getTime()+1000*60*60*24*c);e+="; EXPIRES="+b.toGMTString();}if(f==null){f="/";}e+="; PATH="+f;document.cookie=e;};BS.Cookie.get=function(c){var d=document.cookie;var a=null;if(d){var e=d.indexOf(c+"=");if(e>=0){e+=c.length+1;var b=d.indexOf(";",e);if(b<0){b=d.length;}a=decodeURIComponent(d.substring(e,b));}}return a;};BS.Cookie.remove=function(a){this.set(a,"Deleted",-1);};;
/*---
/js/bs/resize.js
---*/
(function(c){var d=[800,1000,1200];var b;var a=function(){b=b&&b.length>0?b:c(document).find("body");if(b.length==0){return;}var g=b.get(0).className.split(" ");var f=b.width();c.each(d,function(h,j){g=_.without(g,"lt"+j);g=_.without(g,"gt"+j);if(f<j){g.push("lt"+j);}else{g.push("gt"+j);}});b.attr("class",_.compact(g).join(" "));};var e=_.throttle(a,500);c(document).ready(a);Event.observe(window,"resize",e);Event.observe(window,"unload",function(){Event.stopObserving(window,"resize",e);});})(jQuery);;
/*---
/js/bs/position.js
---*/
BS.getPosition=function(c){c=$(c);var k=c.ownerDocument;var e=BS.Browser.mozilla&&k.getBoxObjectFor&&c.getStyle("position")=="absolute"&&(c.style.top==""||c.style.left=="");var i=[];var l=null;var f;var j=document.viewport.getScrollOffsets();var g=document.documentElement||document.body;if(c.getBoundingClientRect){f=c.getBoundingClientRect();var b=j.top;var d=j.left;i.x=f.left+d;i.y=f.top+b;}else{if(k.getBoxObjectFor&&!e){f=k.getBoxObjectFor(c);var a=k.getBoxObjectFor(g);i.x=f.screenX-a.screenX;i.y=f.screenY-a.screenY;}else{i.x=c.offsetLeft;i.y=c.offsetTop;l=c.offsetParent;if(l!=c){while(l){i.x+=l.offsetLeft;i.y+=l.offsetTop;l=l.offsetParent;}}if(BS.Browser.opera||(BS.Browser.webkit&&c.getStyle("position")=="absolute")){i.y-=k.body.offsetTop;}l=c.offsetParent;while(l&&l!=k.body){i.x-=l.scrollLeft;if(!BS.Browser.opera||l.tagName!="TR"){i.y-=l.scrollTop;}l=l.offsetParent;}}}var h=[i.x,i.y];h.left=i.x;h.top=i.y;return h;};;
/*---
/js/bs/refresh.js
---*/
(function(){function b(){var d=document.location;return BS.Crypto.hex_md5((d.href.substring(d.href.lastIndexOf("/")+1)+d.search).replace(/[?=&\.]/g,""));}function c(){var e=$j(window).scrollTop();var d="sp"+b();if(e>0){BS.Cookie.set(d,e,1/24);}else{BS.Cookie.remove(d);}}function a(){setTimeout(function(){var d=BS.Cookie.get("sp"+b());if(d!=null){window.scrollTo(0,d);}},20);}window.rememberScrolling=c;window.restoreScrolling=a;})();;
/*---
/js/bs/tabs.js
---*/
function TabbedPane(a){this.level=a;this.myTabs=[];}_.extend(TabbedPane.prototype,{dispose:function(){if(this.container){BS.stopObservingInContainers(this.container);}},getContainer:function(){return this.container;},clearTabs:function(){this.myTabs=[];},getNumberOfTabs:function(){return this.myTabs.length;},addTab:function(b,a){var c=new TabbedPane.Tab(this,b,a);this.myTabs.push(c);this.myTabs[this._makeId(b)]=c;},getTabs:function(){return this.myTabs;},_makeId:function(a){return"id:"+a;},setFirstActive:function(){this.setActiveTab(this.myTabs[0].getId());},setActiveTab:function(a){this.setActiveCaption(a);var b=this.myTabs[this._makeId(a)];if(b){b.activate();return true;}},gotoTextTab:function(a){for(var b=0;b<this.myTabs.length;b++){var d=this.myTabs[b];if(d.isSelected()){var c=b+a;if(c>=0&&c<this.myTabs.length){this.setActiveTab(this.myTabs[c].getId());return;}}}},setActiveCaption:function(a){for(var b=0;b<this.myTabs.length;b++){var c=this.myTabs[b];c.setSelected(c.getId()==a);}},getActiveTab:function(){for(var a=0;a<this.myTabs.length;a++){var b=this.myTabs[a];if(b.isSelected()){return b;}}return null;},getTab:function(a){return this.myTabs[this._makeId(a)];},showIn:function(a){a=$(a);try{if(!a){BS.Log.warn("Unable to show tabbed pane in "+a);return;}this.dispose();this.container=a;BS.stopObservingInContainers(a);if(this.myTabs.length==0){a.menuFilled=true;return;}var d=document.createElement("ul");d.className="tabs";for(var c=0;c<this.myTabs.length;c++){var b=document.createElement("li");var h=(c==0);var f=(c==this.myTabs.length-1);this.myTabs[c].fillTabContent(b);d.appendChild(b);if(h){$(b).addClassName("first");}if(f){$(b).addClassName("last");}}a.style.display="block";a.innerHTML="";a.appendChild(d);a.menuFilled=true;$j(document).trigger("bs.breadcrumbRendered");}catch(g){alert(g);}},showSidebarIn:function(a){this.showIn(a);}});TabbedPane.Tab=function(c,b,a){this.myPane=c;this.myTabId=b;this.myOptions=_.extend({postLink:""},a||{});this.eventHandlerBound=false;};_.extend(TabbedPane.Tab.prototype,{activate:function(){if(!this.myOptions.onselect||this.myOptions.onselect(this)){var a=$j($(this.myElement)).find("a.tabs").attr("href");if(a&&a!="#"){document.location.href=a;}else{if(this.myOptions.url){document.location.href=this.myOptions.url;}}}},setSelected:function(b,a){this.mySelected=b;a=a?$(a):$(this.myElement);if(a){if(b){a.addClassName("selected");}else{a.removeClassName("selected");}}},isSelected:function(){return this.mySelected;},getId:function(){return this.myTabId;},getDomId:function(){return this.myTabId+"_Tab";},fillTabContent:function(a){a.setAttribute("id",this.getDomId());this.myElement=a.id;this.fillWithText(a);if(this.myOptions.width){a.style.width=this.myOptions.width;}this.setSelected(this.mySelected,a);},fillWithText:function(c){var e="",b="";if(this.myOptions.caption){e=this.myOptions.caption;}if(this.myOptions.captionFrom&&$(this.myOptions.captionFrom)){e=$(this.myOptions.captionFrom).innerHTML;}if(this.myOptions.captionAddin){b=this.myOptions.captionAddin;}e=jQuery.trim(e);var d=this.extractCount(e);if(d&&d.text){e=jQuery.trim(e.substring(0,d.pos-1));b+='<span class="tabCounter">'+d.text+"</span>";}var a="#";if(this.myOptions.url){a=this.myOptions.url;}this.bindEventHandler(c);c.innerHTML="<p>"+'<a class="tabs" showdiscardchangesmessage="false" href="'+a+'">'+e+"</a>"+b+this.myOptions.postLink+"</p>";this.setSelected(this.mySelected);},extractCount:function(c){var a=/\((\d+)\)$/;var b=c.match(a);if(b){return{text:b[1].toString(),pos:c.indexOf(b[0])};}},bindEventHandler:function(a){if(a.hasHandler){return;}if(!this.eventHandlerBound){this.eventHandlerBound=function(b){if(!b.ctrlKey&&!b.altKey&&!b.metaKey&&b.button!=1){this.myPane.setActiveTab(this.getId());Event.stop(b);}return true;}.bindAsEventListener(this);}$(a).on("click",this.eventHandlerBound);a.hasHandler=true;},setCaption:function(a){this.myOptions.caption=a;this.fillTabContent($(this.getDomId()));},setPostLinkContent:function(a){this.myOptions.postLink=a;},extractCountForElements:function(a){var b=this;jQuery(a).each(function(){var c=jQuery(this),e=c.text();var d=b.extractCount(e);if(d&&d.text){e=jQuery.trim(e.substring(0,d.pos-1));c.html(e).append('<span class="tabCounter">'+d.text+"</span>");}});}});;
/*---
/js/bs/forms.js
---*/
BS.AbstractWebForm={formElement:function(){return document.forms[0];},disable:function(a){if(this._formDisabled){return;}var b=BS.Util.disableFormTemp(this.formElement(),a);this._formDisabled=true;return b;},enable:function(a){if(this._formDisabled){BS.Util.reenableForm(this.formElement(),a);}var b=this._modifiedMessageForm();if(b){BS.Util.reenableForm(b);}this._formDisabled=false;},savingIndicator:function(){return $("saving");},setSaving:function(b){var a=this.savingIndicator();if(a){if(!this.progress_saving){this.progress_saving=new BS.DelayedShow(a);}if(b){this.progress_saving.start();}else{this.progress_saving.stop();}}},clearErrors:function(){var a=this;$j("#errorMessage").html("&nbsp;").hide();$j(".errorField").removeClass("errorField");$j(".error").each(function(){a.clearTextInsideElement(this);});BS.VisibilityHandlers.updateVisibility(this.formElement());},trimSpacesInTextFields:function(){var a=Form.getInputs(this.formElement(),"text");for(var b=0;b<a.length;b++){a[b].value=BS.Util.trimSpaces(a[b].value);}},serializeParameters:function(){return BS.Util.serializeForm(this.formElement());},_modifiedMessageForm:function(){return $("modifiedMessageForm");},setModified:function(b){if(b){BS.Util.show("modifiedMessage");this.hideSuccessMessages();var a=this._modifiedMessageForm();if(a){if(this._modifiedHandlers&&this._modifiedHandlers.saveState){a.style.display="inline";}else{BS.Util.hide("modifiedMessage");}}}else{BS.Util.hide("modifiedMessage");}this.modified=b;},hideSuccessMessages:function(){BS.Util.hideSuccessMessages();},clearTextInsideElement:function(a){if(!a||!a.firstChild){return;}a.normalize();if(!a.firstChild||!a.firstChild.nodeType==3){return;}a.firstChild.nodeValue="";},highlightErrorField:function(a){$(a).addClassName("errorField");if(BS.MultilineProperties){BS.MultilineProperties.updateVisible();}},focusFirstErrorField:function(){$j(".errorField").each(function(){if(BS.Util.visible(this)){this.focus();return false;}});},_clearIdleHandler:function(){if(!this._idleHandlerInfo){return;}Event.stopObserving(this._idleHandlerInfo._object,"keyup",this._idleHandler);Event.stopObserving(this._idleHandlerInfo._object,"click",this._idleHandler);this._idleHandlerInfo=null;this._idleHandler=null;},_setupIdleHandler:function(b,a){this._clearIdleHandler();if(a==undefined){a=1000;}var c=this;this._idleHandlerInfo={_delay:a,_object:c.formElement(),_func:b};this._idleHandler=function(){if(!c._idleHandlerInfo){return;}if(c._idleHandlerInfo._timeout){clearTimeout(c._idleHandlerInfo._timeout);}var e=c._idleHandlerInfo._func;var d=c._idleHandlerInfo._object;c._idleHandlerInfo._timeout=setTimeout(function(f){e();},a);}.bindAsEventListener(this);$(this.formElement()).on("keyup",this._idleHandler);$(this.formElement()).on("click",this._idleHandler);},_setupExitHandler:function(){this._exitHandler=function(a){if(this.modified){if(!this._shouldCheckForExit(a)){return;}if(!Event.isLeftClick(a)||a.ctrlKey||a.altKey||a.shiftKey||a.metaKey){return;}if(!confirm("Discard your changes?")){Event.stop(a);}}}.bindAsEventListener(this);$j(document.body).on("click",this._exitHandler);},_shouldCheckForExit:function(b){var a=Event.element(b);if("true"==a.getAttribute("showdiscardchangesmessage")){return true;}if(a.tagName!="A"){a=Event.findElement(b,"A");}if(!a||a.nodeType!=1){return false;}if("false"==a.getAttribute("showdiscardchangesmessage")){return false;}return a&&a.href&&a.href!="#"&&a.href!=document.location.href+"#";},setUpdateStateHandlers:function(a){_.once(this.doSetUpdateStateHandlers(a));},doSetUpdateStateHandlers:function(a){this._modifiedHandlers=a;this._setupIdleHandler(a.updateState);if(a.saveState){var b=this._modifiedMessageForm();if(b&&b.save){$j(b.save).on("click",a.saveState);}this.bindCtrlEnterHandler(a.saveState.bind(this));}this._setupExitHandler();},checkStateModified:function(){if(this._idleHanlder){this._idleHanlder();}},removeUpdateStateHandlers:function(){this._clearIdleHandler();if(this._modifiedHandlers&&this._modifiedHandlers.saveState){var a=this._modifiedMessageForm();if(a&&a.save){$j(a.save).off("click");}}$j(document.body).off("click");this._modifiedHandlers=null;this._exitHandler=null;},bindCtrlEnterHandler:function(a){var b=function(){this._ctrlEnterHandler=function(c){if(c.ctrlKey&&c.keyCode==Event.KEY_RETURN){a&&a();}}.bindAsEventListener(this);$j(document).off("keydown.formCtrlEnter").on("keydown.formCtrlEnter",this._ctrlEnterHandler);}.bind(this);b.defer();}};BS.SimpleListener={onBeginSave:function(a){},onCompleteSave:function(b,d,a,c){},onException:function(a,b){BS.Util.processError(b);},onFailure:function(a){alert("Error accessing server");}};BS.ErrorsAwareListener=OO.extend(BS.SimpleListener,{onBeginSave:function(a){a.trimSpacesInTextFields();a.clearErrors();a.hideSuccessMessages();a.disable();a.setSaving(true);},onCompleteSave:function(b,c,a){var d=$j(".advancedSetting .errorField");if(d.length>0){d.parents().each(function(){if(this._advancedOptions){this._advancedOptions.showAdvanced(true,false);}});}b.setSaving(false);if(a){b.enable();b.focusFirstErrorField();}else{this.onSuccessfulSave(c);}},onSuccessfulSave:function(a){}});BS.StoreInSessionListener=OO.extend(BS.SimpleListener,{onCompleteSave:function(b,c,a){if(!a){BS.XMLResponse.processModified(b,c);}},onException:function(a,b){},onFailure:function(a){}});BS.AbstractPasswordForm=OO.extend(BS.AbstractWebForm,{publicKey:function(){return $F("publicKey");},serializeParameters:function(){var e=BS.AbstractWebForm.serializeParameters.bind(this)();var f=Form.getInputs(this.formElement(),"password");if(!f){return e;}for(var c=0;c<f.length;c++){if(BS.Util.isParameterIgnored(f[c])){continue;}var b=f[c].name;var a="encrypted"+b.charAt(0).toUpperCase()+b.substring(1);e+="&"+a+"=";if(f[c].value.length==0){continue;}var d="";if(f[c].getEncryptedPassword!=null){d=f[c].getEncryptedPassword(this.publicKey());}else{d=BS.Encrypt.encryptData(f[c].value,this.publicKey());}e+=d;}return e;}});BS.FormSaver={AbstractSaveListener:{onBeginSave:function(a){},onException:function(a,b){},onFailure:function(a){},onCompleteSave:function(b,a,d,c){}},save:function(b,g,c,a){try{c.onBeginSave(b);var f=b.serializeParameters();if(a){alert(f);}BS.ajaxRequest(g,{method:"post",parameters:f,onComplete:function(i){if(a){alert(i.responseText);}if(!i.responseXML){c.onCompleteSave(b,null,null,i.responseText);}else{var h=i.responseXML;var e=BS.XMLResponse.processErrors(h,c);c.onCompleteSave(b,h,e,i.responseText);}},onFailure:function(){c.onFailure(b);},onException:function(i,h){c.onException(b,h);}});}catch(d){c.onException(b,d);}}};BS.PasswordFormSaver=OO.extend(BS.FormSaver,{save:function(c,e,d,a){var b=this;if(!d.onPublicKeyExpiredError){d.onPublicKeyExpiredError=function(f){$("publicKey").value=f.firstChild.nodeValue;setTimeout(function(){b.save(c,e,d,a);},100);};}BS.FormSaver.save(c,e,d,a);}});if(!BS.CustomCheckbox){$j(document).ready(function(){new BS.CustomCheckbox();});}BS.CustomCheckbox=Class.create({initialize:function(){var a=$j(document);a.find(".custom-checkbox_input").each(function(){if(this.disabled){$j(this).parent().addClass("custom-checkbox_disabled");}if(this.checked){$j(this).parent().addClass("custom-checkbox_checked");}});a.on("change",".custom-checkbox",function(){var d=$j(this);if(d.hasClass("custom-checkbox_disabled")){return false;}var b=d.find(".custom-checkbox_input"),c=b.prop("checked");d.toggleClass("custom-checkbox_checked custom-checkbox_focused",c);});}});;
/*---
/js/bs/basePopup.js
---*/
BS.Popup=Class.create({initialize:function(a,b){this._name=a;b=b||{};var c=b.shift||{};delete b.shift;this.options=_.extend({delay:300,hideDelay:600,width:null,shift:{x:-200,y:15},loadingText:"Loading...",fitWithinWindowHeight:false,fitWithinWindowBottomMargin:0,fitWithinWindowTopMargin:5,doScroll:true,forceReload:false,innerText:null,innerHTML:null,url:null,parameters:null,textProvider:null,htmlProvider:null,afterShowFunc:function(d){},afterHideFunc:function(){}},b);_.extend(this.options.shift,c);this._timer=null;}},{element:function(){return $(this._name);},showPopup:function(c,d){_.extend(this.options,d||{});var b=Event.element(c);if(!this.options.forceReload&&this.isShown()&&this.isLoaded()&&b.getAttribute("data-popup")==this._name){BS.Hider.stopHidingDiv(this._name);return;}var a=Event.pointerX(c)+this.options.shift.x;var f=Event.pointerY(c)+this.options.shift.y;var e=function(){b.setAttribute("data-popup",this._name);}.bind(this);this._showWithDelay(a,f,e);return this;},showPopupNearElement:function(b,c){_.extend(this.options,c||{});b=$j($(b));if(!this.options.forceReload&&this.isShown()&&this.isLoaded()&&b.attr("data-popup")==this._name){BS.Hider.stopHidingDiv(this._name);return;}var f=b.offset();var a=f.left+this.options.shift.x;var e=f.top+this.options.shift.y;var d=function(){b.attr("data-popup",this._name);}.bind(this);this._showWithDelay(a,e,d);return this;},isLoaded:function(){return this._loaded===undefined||this._loaded;},hidePopup:function(a,b){this._clearPopupTimer();if(a===undefined){a=this.options.hideDelay;}if(this.isShown()&&(this.isLoaded()||b)){if(a>0){BS.Hider.startHidingDiv(this._name,a);}else{BS.Hider.stopHidingDiv(this._name);BS.Hider.hideDivSingle(this._name);}}},stopHidingPopup:function(){if(this.isShown()){BS.Hider.stopHidingDiv(this._name);}},isShown:function(){return BS.Util.visible(this.element());},_getMaxHeight:function(){if(this.options.fitWithinWindowHeight){var b=$(this.element()).cumulativeOffset();var a=BS.Util.windowSize()[1]-this.options.fitWithinWindowBottomMargin;a=a-(b[1]-BS.Util._scrollTop());return a>100?a:100;}return -1;},_showWithDelay:function(a,d,c){if(this.isShown()&&!this.isLoaded()){_.isFunction(c)&&c();return;}var b=this.options.delay;this._clearPopupTimer();if(b==0){this._showPopupNow(a,d,c);}else{this._timer=setTimeout(function(){this._showPopupNow(a,d,c);}.bind(this),b);}},_clearPopupTimer:function(){if(this._timer){clearTimeout(this._timer);delete this._timer;}},_showPopupNow:function(a,e,c){var d=this.element();if(!d){d=document.createElement("div");d.id=this._name;d.className="popupDiv";document.body.appendChild(d);}else{this._removeDuplicates();if(d.parentNode!=document.body){d.remove();document.body.appendChild(d);}}d=$(d);if(this.options.className){d.addClassName(this.options.className);}if(!this.options.backgroundColor){this.options.backgroundColor=d.getStyle("backgroundColor");}if(this.options.innerText){$j(d).text(this.options.innerText);}else{if(this.options.innerHTML){d.innerHTML=this.options.innerHTML;}else{if(this.options.url||this.options.textProvider){var b="&nbsp;"+jQuery.trim(this.options.loadingText);d.addClassName("popupLoading");d.innerHTML=BS.loadingIcon+b;}}}if(this.options.beforeShow){this.options.beforeShow(d);}BS.Util.place(d,a,e);if(this._getMaxHeight()!=-1){d.style.overflow="hidden";d.style.height="auto";}this._loaded=false;BS.Hider.showDivWithTimeout(d.id,_.extend({hideOnMouseOut:function(){return this.options.hideDelay>=0&&this._loaded;}.bind(this)},this.options));if(this.options.url){BS.ajaxUpdater(this._name,this.options.url,{method:"get",evalScripts:true,parameters:this.options.parameters,onComplete:function(){d.removeClassName("popupLoading");this._onComplete(c);}.bind(this)});}else{d.removeClassName("popupLoading");if(this.options.textProvider){d.innerHTML=this.options.textProvider(this);}if(this.options.htmlProvider){$j(d).append(this.options.htmlProvider(this));}this._initEvents();this._onComplete(c);}},_removeDuplicates:function(){var b=this.element(),a;b.id="_"+this._name;a=$(this._name);while(a){a.parentNode.removeChild(a);a=$(this._name);}b.id=this._name;},_onComplete:function(a){this.element().style.backgroundColor=this.options.backgroundColor;if(this.options.width){this.element().style.width=this.options.width;}this._fixHeight();this.updatePopup();BS.loadRetinaImages(this.element());this.options.afterShowFunc(this);_.isFunction(a)&&a();this._loaded=true;},_fixHeight:function(){var a=this.element();var b=this._getMaxHeight(a);if(b>0&&a.offsetHeight>b){if(this.options.doScroll){window.scrollTo(0,a.cumulativeOffset()[1]-this.options.fitWithinWindowTopMargin);}a.style.height=this._getMaxHeight(a)+"px";a.style.overflowY="auto";}},updatePopup:function(){BS.Util.shiftToFitPage(this.element());BS.Util.moveDialogIFrame(this.element());},_initEvents:function(){var b=this;if(_.isString(this.options.className)&&this.options.className.indexOf("quickLinksMenuPopup")>-1){var a=jQuery(this.element());a.on("mouseup","a",function(d){var c;if(d.which){c=(d.which==1);}else{if(d.button){c=(d.button==0);}}if(!c){return;}if(d.ctrlKey||d.metaKey){return;}setTimeout(function(){BS.Hider.hideDivSingle(b._name);},0);});this._initKeyboardEvents(a);}},_initKeyboardEvents:function(a){function b(g){var f=jQuery(g).closest(".menuItem"),e=f.next();if(e.length>0&&e.hasClass("menuItem")){f.removeClass("menuItemSelected");e.addClass("menuItemSelected");e.find("a").focus();}}function d(g){var f=jQuery(g).closest(".menuItem"),e=f.prev();if(e.length>0&&e.hasClass("menuItem")){f.removeClass("menuItemSelected");e.addClass("menuItemSelected");e.find("a").focus();}}var c=a.find(".menuItem");c.removeClass("menuItemSelected").first().addClass("menuItemSelected");c.first().find("a").focus();c.off("keydown");c.keydown(function(f){switch(f.keyCode){case 38:d(f.target);return false;case 40:b(f.target);return false;default:return true;}});}});BS.ChangesPopup=new BS.Popup("changesPopup",{url:window["base_uri"]+"/changesPopup.html?limit=25",method:"get"});BS.ChangesPopup._switchTab=function(b,a,c){b.style.overflow="hidden";b.style.height="auto";b.innerHTML=BS.loadingIcon+"&nbsp;Loading...";this.updatePopup();var d=this;setTimeout(function(){new BS.ajaxUpdater(b,window["base_uri"]+"/changesPopupTab.html",{method:"get",evalScripts:true,parameters:"limit=25&promoId="+a+"&tab="+c,onComplete:function(){d.updatePopup();}});},500);};BS.ChangesPopup.showCurrentBuild=function(b,a){this._switchTab(b,a,"");};BS.ChangesPopup.showSinceLastSuccessful=function(b,a){this._switchTab(b,a,"sinceLastSuccessful");};BS.ChangesPopup.showBuildChangesPopup=function(b,a,c){this.options.parameters="promoId="+a+(c!=null?"&tab="+c:"");this.showPopupNearElement(b);};BS.ChangesPopup.showPendingChangesPopup=function(c,b,a,d){this.options.parameters="buildTypeId="+b;if(a){this.options.parameters+="&allBranches=true";}if(d!=null){this.options.parameters+="&branch="+encodeURIComponent(d);}this.showPopupNearElement(c);};BS.ChangesPopup.expandComment=function(a){$j(a).parent().hide().next().show();return false;};BS.ChangesPopup.initArtifactChangesBlocks=function(){var a=$j(".artifactsChangeHeader");a.click(function(){var b=$j(this);b.toggleClass("expanded").toggleClass("collapsed");b.parent().find(".artifactChange").toggleClass("hidden");});a.mousedown(function(){return false;});};BS.FilesPopup=new BS.Popup("filesPopup",{url:window["base_uri"]+"/filesPopup.html",shift:{x:-300,y:10},afterShowFunc:function(){var a=window.location.pathname+"?";if(a.include("/diff.html?")||a.include("/diffView.html?")){$j("a","#filesPopup .changedFiles").each(function(){var b=$j(this);b.attr("href",b.attr("href").replace(/\/.*\?/,a));});}}});BS.BuildResultsPopupTracker=(function(){var a={};return function(b){return{getPopup:function(){return a[b];},showPopup:function(c,g,f,e,d){if(!a[b]){a[b]=new BS.BuildResultsSummary(b,c,g,f);d=d||{};d.afterHideFunc=this._removePopup;}a[b].showPopupNearElement(e,d);},_removePopup:function(){if(a[b]&&!a[b].isShown()){delete a[b];
BS.Log.info("Cleanup build results popup "+b+"; remains "+$H(a).keys().length);}},hidePopup:function(){if(a[b]){a[b].hidePopup();this._removePopup();}},stopHidingPopup:function(){if(a[b]){a[b].stopHidingPopup();}}};};})();BS.BuildResultsSummary=function(b,a,d,c){BS.Popup.call(this,"popupRes"+b,{buildId:b,skipChangesArtifacts:c,buildTypeId:a,shift:{x:-80},textProvider:function(e){var f=$("buildResultsSummaryTemplate");if(!f){return;}var g=f.innerHTML;g=g.replace(/##BUILD_ID##/g,e.options.buildId);g=g.replace(/##BUILD_TYPE_ID##/g,e.options.buildTypeId);setTimeout(function(){this.showDetailedInfo();}.bind(e),20);return g;}});};_.extend(BS.BuildResultsSummary.prototype,BS.Popup.prototype);BS.BuildResultsSummary.prototype.showDetailedInfo=function(){this._loaded=false;var b=this.options.buildId;$("summaryProgress:"+b).innerHTML=BS.loadingIcon+" Loading details...";var a={evalScripts:true,onComplete:function(){if($("summaryProgress:"+b)){$("summaryProgress:"+b).innerHTML="";}this.updatePopup();this._loaded=true;}.bind(this)};BS.ajaxUpdater($("detailedSummary:"+b),window["base_uri"]+"/buildResultsSummary.html?buildId="+b+"&skipChangesArtifacts="+this.options.skipChangesArtifacts,a);};BS.BuildTypeSummary=new BS.Popup("buildTypeSummary");BS.BuildTypeSummary.showSummaryPopup=function(d,c,g,b,e,a,f){this.showPopupNearElement(d,{shift:{x:5,y:20},url:window["base_uri"]+"/buildTypePopup.html",parameters:{buildTypeId:c,branch:BS.Branch.getBranchFromUrl(g),withSelf:b?"true":"false",withProject:e?"true":"false",withAdmin:a?"true":"false",withResponsibility:f?"true":"false"}});};BS.AgentInfoPopup=new BS.Popup("agentInfoPopup",{url:window["base_uri"]+"/showCompatibleAgents.html",shift:{x:-150}});BS.AgentInfoPopup.showAgentsPopup=function(a,b){this.options.parameters="itemId="+b;this.showPopupNearElement(a);};BS.DependentArtifactsPopup=new BS.Popup("dependentArtifactsPopup",{shift:{x:-60},url:window["base_uri"]+"/viewDependentArtifactsPopup.html"});BS.DependentArtifactsPopup.showPopup=function(b,c,a,d){this.options.parameters="buildId="+c+"&targetBuildId="+a+"&mode="+d;this.showPopupNearElement(b);};BS.BuildTypeSettingsPopup={};BS.BuildTypeSettingsPopup.showMultilineValue=function(a,c,b){BS.Util.center("valuePopup");$("valueContainer").value=b;$("valuePopupTitle").innerHTML=c;BS.Hider.showDivWithTimeout("valuePopup",{hideOnMouseOut:false,draggable:true,dragHandle:$("valuePopupHeader")});$("valueContainer").focus();};BS.BuildTypeSettingsPopup.closeMultilineValuePopup=function(){BS.Hider.hideDiv("valuePopup");};BS.ProgressPopup=new BS.Popup("progressPopup",{delay:0,hideDelay:0});BS.ProgressPopup.showProgress=function(a,c,b){c=jQuery.trim(c);this.options.innerHTML='<span style="white-space: nowrap;">'+BS.loadingIcon+"&nbsp;"+c+"</span>";if(this.options.delay===undefined){this.options.delay=0;}_.extend(this.options,b);this.showPopupNearElement(a);};BS.WarningPopup=new BS.Popup("warningPopup",{delay:0,hideOnMouseOut:false});BS.WarningPopup.showWarning=function(a,b,c,d){this.options.innerText=c;this.options.shift=b;setTimeout(function(){this.showPopupNearElement(a,d);}.bind(this),50);};BS.Tooltip={_id:1,getId:function(){return"messagePopup_"+this._id++;}};BS.Tooltip.create=function(a,b){if(BS.Tooltip.popup){return null;}a=_.extend({delay:a.delay||400,shift:a.shift,hideOnMouseOut:true,hideOnMouseClickOutside:false,innerHTML:b},a);BS.Tooltip.popup=new BS.Popup(BS.Tooltip.getId(),a);return BS.Tooltip.popup;};BS.Tooltip.showMessage=function(a,c,d){var e=$(a);var b=BS.Tooltip.create(c,d);if(b){b.showPopupNearElement(e);}BS.Tooltip.popupToggle=e;BS.Tooltip.deleteTitles(e);};BS.Tooltip.showMessageFromContainer=function(a,c,b){BS.Tooltip.showMessage(a,c,$(b).innerHTML);};BS.Tooltip.showMessageAtCursor=function(d,b,c){var e=$(d.target);var a=BS.Tooltip.create(b,c);if(a){a.showPopup(d);}BS.Tooltip.popupToggle=e;BS.Tooltip.deleteTitles(e);};BS.Tooltip.hidePopup=function(){if(BS.Tooltip.popup){BS.Tooltip.popup.hidePopup(BS.Tooltip.popup.options.delay,true);BS.Tooltip.popup=null;}if(BS.Tooltip.popupToggle){BS.Tooltip.recreateTitles(BS.Tooltip.popupToggle);BS.Tooltip.popupToggle=null;}};BS.Tooltip.deleteTitles=function(b){if(!b){return;}b=b.up();for(var a=0;a<3;++a){if(!b){return;}if(b.getAttribute("title")){b.setAttribute("data-original-title",b.getAttribute("title"));b.removeAttribute("title");}b=b.up();}};BS.Tooltip.recreateTitles=function(b){if(!b){return;}b=b.up();for(var a=0;a<3;++a){if(!b){return;}if(b.getAttribute("data-original-title")){b.setAttribute("title",b.getAttribute("data-original-title"));}b=b.up();}};BS.QueuedBuildsPopup=new BS.Popup("queuedBuildsPopup",{url:window["base_uri"]+"/queue.html",method:"get"});BS.QueuedBuildsPopup.showQueuedBuilds=function(a,b,c,e){var d="forBuildTypeId="+b;if(c!=null){d+="&branch="+encodeURIComponent(c);}if(e!=null){d+="&itemId="+encodeURIComponent(e);}this.showPopupNearElement(a,{parameters:d,shift:{x:-600,y:15}});};BS.RunningBuildsPopup=new BS.Popup("runningBuildsPopup");BS.RunningBuildsPopup.showBuilds=function(a,c){var b=$j(BS.Util.escapeId("btb"+c));this.showPopupNearElement(a,{shift:{x:-800,y:15},afterShowFunc:function(){var d=$j("#runningBuildsPopup");if(!d.is(":empty")){var e=d.attr("bt-id");if(e==c){return;}d.children("table").appendTo(BS.Util.escapeId("btb"+e));}d.append(b.children("table")).attr("bt-id",c);},afterHideFunc:function(){$j("#runningBuildsPopup").children("table").appendTo(b);}});};BS.ClickPopupSupport={clickPopups:{},togglePopup:function(id,showPopupCommand){var popup=BS.ClickPopupSupport.clickPopups[id];if(!popup||!popup.isShown()){popup=eval(showPopupCommand);BS.ClickPopupSupport.clickPopups[id]=popup;var linkPos=$(this).cumulativeOffset();var linkDim=$(this).getDimensions();var elDim=popup.element().getDimensions();BS.Util.place(popup.element(),linkPos[0]+linkDim.width-elDim.width,linkPos[1]+linkDim.height-1);popup.updatePopup();BS.Hider.addHideFunction(popup._name,function(){delete BS.ClickPopupSupport.clickPopups[id];}.bind(this));}else{popup.hidePopup(0,true);}}};BS.PromoDetailsPopup=new BS.Popup("promoDetailsPopup",{url:window["base_uri"]+"/promoDetailsPopup.html",method:"get",shift:{x:-50}});BS.PromoDetailsPopup.showDetailsPopup=function(b,a){BS.PromoDetailsPopup.options.parameters="promoId="+a;BS.PromoDetailsPopup.showPopupNearElement(b);};BS.AuthorityRolesPopup={};BS.AuthorityRolesPopup=new BS.Popup("authorityRolesPopup",{url:window["base_uri"]+"/admin/authorityRolesPopup.html",method:"get"});BS.AuthorityRolesPopup.showPopup=function(a,b){this.options.parameters="rolesHolderId="+b;this.showPopupNearElement(a);};BS.GroupUsersPopup={};BS.GroupUsersPopup=new BS.Popup("groupUsersPopup",{url:window["base_uri"]+"/admin/groupUsersPopup.html",method:"get"});BS.GroupUsersPopup.showPopup=function(b,a){this.options.parameters="groupCode="+encodeURIComponent(a);this.showPopupNearElement(b);};BS.ParentGroupsPopup={};BS.ParentGroupsPopup=new BS.Popup("parentGroupsPopup",{url:window["base_uri"]+"/admin/parentGroupsPopup.html",method:"get"});BS.ParentGroupsPopup.showUserParentGroups=function(a,b){this.options.parameters="userId="+b;this.showPopupNearElement(a);};BS.ParentGroupsPopup.showGroupParentGroups=function(b,a){this.options.parameters="groupCode="+encodeURIComponent(a);this.showPopupNearElement(b);};BS.TemplateUsagesPopup=new BS.Popup("templateUsagesPopup",{url:window["base_uri"]+"/admin/templateUsagesPopup.html",method:"get"});BS.TemplateUsagesPopup.showPopup=function(a,b,c){this.options.parameters="templateId="+encodeURIComponent(b)+"&selectedStep="+c;this.showPopupNearElement(a);};BS.ShowBuildTypesPopup=new BS.Popup("showBuildTypesPopup",{hideDelay:0,shift:{x:-230,y:20},className:"flatView"});BS.ShowBuildTypesPopup.showPopup=function(a,c){var b={projectId:c};BS.Branch.addBranchToParams(b,c);this.options.url=window["base_uri"]+"/showBuildTupesPopup.html?"+Object.toQueryString(b);this.showPopupNearElement(a);};BS.InstallAgentsPopup={showNearElement:function(a){$("installAgents").style.position="absolute";BS.Util.placeNearElement("installAgents",a,{x:-180,y:21});
BS.Hider.showDivWithTimeout("installAgents",{hideOnMouseOut:false});}};BS.TogglePopup=new BS.Popup("togglePopup",{delay:0,hideDelay:-1,shift:{x:0}});BS.TogglePopup.toggle=function(a){if(this.isShown()){this.hidePopup();}else{this.options.innerHTML=a.nextSibling.innerHTML;this.showPopupNearElement(a);}return false;};BS.JumpTo=new BS.Popup("jumpToPopup",{delay:0,hideDelay:-1,shift:{x:-209,y:20}});BS.JumpTo.jump=function(a){BS.HistoryTable.update("jumpTo="+a);this.hidePopup();};BS.PopupDialog={_popups:{},show:function(d,a,c,e,f){if(this._popups[a]){this.hide(a,false);}var g=OO.extend({method:"get",url:window["base_uri"]+"/popupDialog.html",parameters:"init=1&typeId="+encodeURIComponent(a)+"&contextId="+c,hideOnMouseOut:false,hideOnMouseClickOutside:false,width:"25em",delay:0,shift:{x:0,y:d?d.offsetHeight+5:16},hideDelay:-1},f||{});var b=new BS.Popup("popupDialog_"+a,g);b._afterApply=e;this._popups[a]=b;b.showPopupNearElement(d);},hide:function(a,c){var b=this._popups[a];this._popups[a]=null;if(b){b.hidePopup();if(c&&b._afterApply){b._afterApply();}}}};window._tc_es=function(a){Event.element(a).setAttribute("data-pinned","true");Event.stop(a);};window._pc_over=function(){};window._pc_out=function(){};BS.ProjectDataPopup=new BS.Popup("projectDataPopup",{url:window["base_uri"]+"/projectData.html",method:"get",hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:0,y:20}});BS.ProjectDataPopup.showPopup=function(d,e,c,b,a){this.options.parameters="type="+e+"&projectFilePath="+$(c).value+"&sourceFieldId="+c+"&targetFieldId="+b+"&popupTitle="+a+"&retrieveData=true";this.showPopupNearElement(d);};BS.ProjectDataPopup.insertSelectedValue=function(d,b){var a=$(d);if(a&&a.selectedIndex!=-1){var c=a.options[a.selectedIndex];$(b).value=c.value;this.hidePopup(0);}};BS.ProjectDataPopup.appendSelectedValues=function(f,a){var c=Form.getElements(f);c=c.filter(function(g){return g.type=="checkbox"&&g.name.startsWith("dataItem_")&&g.checked;});var d=" ";if($(a).tagName=="TEXTAREA"){d="\n";}var e=$(a).value+d;for(var b=0;b<c.length;b++){e+=c[b].value+d;}e=$j.trim(e);if(e.length>0){$(a).value=e;this.hidePopup(0);}};BS.ProjectDataPopup.attachHandler=function(g,d,c,b){var a="handle_"+d+c;var f=document.createElement("span");f.id=a;f.className="handle icon-magic";f.style.position="absolute";f.style.display="none";f.title=b;f.onclick=function(){BS.ProjectDataPopup.showPopup(this,g,d,c,b);};$(c).parentNode.appendChild(f);var e={updateVisibility:function(){var m=$(c);var i=$(a);if(m.disabled||m.readOnly){BS.Util.hide(i);}else{if(i!=null){var l=m.getDimensions(),k=m.getLayout();var j=l.width+20;var o=m.positionedOffset();var h=o[0]+j+k.get("margin-left");var n=o[1]+3+k.get("margin-top");BS.Util.show(i);BS.Util.place(i,h,n);}}}};BS.VisibilityHandlers.attachTo(c,e);};(function(){var c={};function b(i,f,e,h){var g=["show","hide","stopHiding"],e=e||{},d=new f(i,e.options,h);if(e.handlers){d.handlers=e.handlers;}g.forEach(function(j){if(e[j]){d[j+"Popup"]=e[j];}});if(!e.show){d.showPopup=function(j,k){this.showPopupNearElement(j,k);};}return d;}function a(e){var d=c[e];if(!d){BS.Log.error("no popup type",e);throw new Error("no popup type",e);}return d;}BS.registerPopupType=function(d,f){var e;f=f||{};if(!f.live){e=b(d,f.__base||BS.Popup,f);}else{e=function(i,h,g){h=h||{};return b(i,f.live,OO.extend(f,{options:h}),g);};}c[d]=e;};BS.bindPopup=function(g,j,m){var f=$j(typeof g==="string"?BS.Util.escapeId(g):g),d=f.find(".toggle"),l=m&&m.show||[],i=m&&m.hide||[],h=m&&m.stopHiding||[],k=m&&m.create||{},e=f.length?a(j):null;if(e){if("function"===typeof e){e=e(f.attr("id"),k,g);}f.removeAttr("onmouseover");e._showOptions=l;e._$toggle=d;f.on("mouseover",function(){e.stopHidingPopup.apply(e,h);}).on("mouseout",function(){e.hidePopup.apply(e,i);});if(d.length){d.on("mouseover",function(n){if(e.__showNearEvent){e.showPopup.apply(e,[n].concat(l));}else{e.showPopup.apply(e,[d[0]].concat(l));}}).on("click",function(n){_tc_es(n);});if(window.event&&(window.event.target||window.event.srcElement)===d[0]){d.trigger("mouseover");}}if(e.handlers){e.handlers.forEach(function(n){f.on(n.event,n.delegate,n.getHandler(e));});}}else{BS.Log.warn("bind "+j+": Cannot find element with id "+g);}};BS.registerPopupType("projectSummary",{show:function(g,f,e,d){this.showPopupNearElement(g,{shift:{x:5,y:20},url:window["base_uri"]+"/projectPopup.html",parameters:{projectId:f,branch:BS.Branch.getBranchFromUrl(f),withSelf:e?"true":"false",withAdmin:d?"true":"false"}});}});BS.ProjectSummary=a("projectSummary");BS.ProjectSummary.showSummaryPopup=BS.ProjectSummary.showPopup;BS.registerPopupType("simplePopup",{live:function(d,e){var f=$j(BS.Util.escapeId(d||""));if(f.length==0){BS.Log.warn("bind simplePopup: Cannot find element with id "+d);return;}return new BS.Popup(d+"Content",OO.extend(e,{hideDelay:300}));},handlers:[{event:"click",delegate:".popupLink",getHandler:function(d){return function(){var f=$j(d._$toggle.length?d._$toggle:this),e=f.parents(".popupDiv:last")[0];BS.Hider.hideAll(e);d.showPopupNearElement(f,OO.extend(d._showOptions[0],{delay:0}));};}}]});BS.registerPopupType("artifactsPopup",{show:function(e,d,f){return this.showPopupNearElement(e,{parameters:"buildId="+f,shift:{x:-60,y:15},url:window["base_uri"]+"/viewArtifactsPopup.html"});}});BS.ArtifactsPopup=a("artifactsPopup");BS.ArtifactsPopup.showArtifactsPopup=BS.ArtifactsPopup.showPopup;BS.install_simple_popup=function(d,e){e=e||{};BS.bindPopup(d,"simplePopup",{create:e});};})();;
/*---
/js/bs/menuList.js
---*/
(function(a){a(function(){var b=a(document);b.on("mouseover mouseout",".menuList .menuItem",function(c){a(this).toggleClass("menuItemSelected",c.type=="mouseover");});b.on("click",".menuList .menuItem",function(d){if(!_.isFunction(this.onclick)){var c=a(this).children("a").get(0);if(c&&d.target!=c){if(_.isFunction(c.onclick)){c.onclick();}else{return BS.openUrl(d,c.href);}}}});});})(jQuery);;
/*---
/js/bs/modalDialog.js
---*/
BS.AbstractModalDialog={_attachedToRoot:false,hideOnMouseClickOutside:false,getContainer:function(){},beforeShow:function(){},afterClose:function(){},getDragHandle:function(){return $(this.getContainer()).getElementsBySelector(".dialogHandle")[0];},bindCtrlEnterHandler:function(a){var b=function(){this._ctrlEnterHandler=function(c){if(c.ctrlKey&&c.keyCode==Event.KEY_RETURN){a&&a();}}.bindAsEventListener(this);$j(document).off("keydown.formCtrlEnter keydown.dialogCtrlEnter").on("keydown.dialogCtrlEnter",this._ctrlEnterHandler);}.bind(this);b.defer();},bindEnterHandler:function(a){var b=function(){this._enterHandler=function(c){if(c.keyCode==Event.KEY_RETURN){a&&a();}}.bindAsEventListener(this);$j(document).on("keydown.dialogEnter",this._enterHandler);}.bind(this);b.defer();},unbindCtrlEnterHandler:function(){if(!this._ctrlEnterHandler){return;}$j(document).off("keydown.dialogCtrlEnter");this._ctrlEnterHandler=null;},_getDialogForm:function(a){return a.parentNode.tagName.toLowerCase()=="form"&&a.parentNode.getAttribute("id")+"Dialog"==a.getAttribute("id")?a.parentNode:a;},_removeDuplicateElements:function(){var c=$(this.getContainer());var a=c.id;c.id="_"+a;var b=$(a);while(b){var d=this._getDialogForm(b);d.parentNode.removeChild(d);b=$(a);}c.id=a;},_fixElementPlacement:function(){this._removeDuplicateElements();if(this._attachedToRoot){return;}var b=$(this.getContainer());var c=this._getDialogForm(b);var a=$("mainContent");if(c.parentNode!=a){a.appendChild(c);this._attachedToRoot=true;}},showAt:function(a,c){this._fixElementPlacement();var b=$(this.getContainer());this.beforeShow();BS.Util.place(b,a,c);this._showDialog(b);},showAtFixed:function(a){this._fixElementPlacement();this.beforeShow();a.addClassName("modalDialogFixed");this._showDialog(a);this.positionAtFixed(a);this.recenterDialog();$j(window).off("resize.modalDialog scroll.modalDialog").on("resize.modalDialog scroll.modalDialog",function(){this.positionAtFixed(a);}.bind(this));},positionAtFixed:function(a){if(!a){return;}var b=$j(a);function c(){b.position({my:"center",at:"center",of:window,using:function(d){var e;if(b.height()>document.body.offsetHeight){e=Math.max(document.body.scrollTop,d.top);e=Math.min(e,document.body.offsetHeight);}else{e=d.top;}b.css({top:parseInt(e),left:parseInt(d.left),visibility:"visible"});}});}if(BS.Browser.opera){b.css("visibility","hidden");setTimeout(c,0);}else{c();}},_showDialog:function(a){var b=function(){this.removeOverlappingDiv(a);this.resetPosition(a);this.afterClose();this.unbindCtrlEnterHandler();this._attachedToRoot=false;}.bind(this);BS.Hider.showDivWithTimeout(a.id,{hideOnMouseOut:false,hideOnMouseClickOutside:this.hideOnMouseClickOutside,afterHideFunc:b,draggable:true,dragHandle:this.getDragHandle(),zIndex:this.zIndex});a.setAttribute("data-modal",true);this.showOverlappingDiv(a);},isVisible:function(){return BS.Util.visible(this.getContainer());},showCentered:function(){var a=$(this.getContainer());a&&this.showAtFixed(a);},recenterDialog:function(){this._fixElementPlacement();var a=$(this.getContainer());var b=a.getDimensions();if(b.height>a.getAttribute("data-height")||0){this.positionAtFixed(a);this.updateDialog();}},close:function(){this.doClose();},doClose:function(){if(this.getContainer()){BS.Hider.hideDiv(this.getContainer().id);}},_overlappingDivId:function(){return"overlappingDiv";},getOverlappingDiv:function(){var c=this._overlappingDivId();var b=$(c);if(b){return b;}var a=$j("<div/>").attr("id",c).hide().appendTo($j("#mainContent"));return a.get(0);},showOverlappingDiv:function(a){var c=this.getOverlappingDiv();var b=a.style.zIndex;c.style.zIndex=""+(parseInt(b,10)-1);if(!BS.Util.visible(c)){BS.Util.show(c);}},removeOverlappingDiv:function(d){var e=$(this._overlappingDivId());var c=false;var a;for(var b in BS.Hider.allDivs){a=$(BS.Hider.allDivs[b]);if(a&&a.getAttribute("data-modal")){c=true;}}if(e){if(!c){$("mainContent").removeChild(e);}else{if(a){e.style.zIndex=""+(parseInt(a.style.zIndex,10)-1);}}}},resetPosition:function(a){$j(window).off("resize.modalDialog scroll.modalDialog");a.style.cssText="";},updateDialog:function(){BS.Util.moveDialogIFrame(this.getContainer());}};BS.DialogWithProgress=OO.extend(BS.AbstractModalDialog,{loaderDisplayTimeout:300,showProgress:function(a){this._loadingTimeoutId=setTimeout(function(){BS.LoadingDialog.showCentered();this._loadingTimeoutId=null;}.bind(this),this.loaderDisplayTimeout);},hideProgress:function(){this._loadingTimeoutId?clearTimeout(this._loadingTimeoutId):BS.LoadingDialog.close();this._loadingTimeoutId=null;},showCentered:function(){this.hideProgress();BS.AbstractModalDialog.showCentered.apply(this,arguments);}});BS.LoadingDialog=OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("abstractLoadingDialog");},showCentered:function(){$j("#abstractProgress").show();BS.AbstractModalDialog.showCentered.call(this);}});BS.AbstractCopyMoveDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{savingElemId:function(){return this._savingElemId||this.__baseId+"Progress";},containerId:function(){return this._containerId||this.__baseId+"FormDialog";},formElementId:function(){return this._formElementId||this.__baseId+"Form";},fetchUrl:function(){return this._fetchUrl||"/admin/%%.html".replace(/%%/,this.__baseId);},copyButtonId:function(){return this._copyButtonId||this.__baseId+"Button";},loaderDisplayTimeout:300,fetchParamName:null,getContainer:function(){return $(this.containerId());},formElement:function(){return $(this.formElementId());},setSaving:function(a){BS.Util[a?"show":"hide"](this.savingElemId());},showDialog:function(b){var a=this;this._loadingTimeoutId=setTimeout(function(){BS.LoadingDialog.showCentered();this._loadingTimeoutId=null;}.bind(this),this.loaderDisplayTimeout);$j(BS.Util.escapeId(this.formElementId())).remove();BS.ajaxRequest(window["base_uri"]+this.fetchUrl(),{method:"GET",parameters:this._prepareRequestParameters.apply(this,[].slice.apply(arguments)),onComplete:function(c){a._loadingTimeoutId?clearTimeout(a._loadingTimeoutId):BS.LoadingDialog.close();a._loadingTimeoutId=null;a._onFetchDialogComplete(c);}});return false;},_prepareRequestParameters:function(b){var a={};a[this.fetchParamName]=b;return a;},_onFetchDialogComplete:function(a){$j("body").append(a.responseText);this.showCentered();$j(this.formElement().projectId).trigger("change").focus();this.bindCtrlEnterHandler(this.submitMove.bind(this));},cancelDialog:function(){this.close();},afterClose:function(){this.clearErrors();}}));;
/*---
/js/bs/investigation.js
---*/
BS.ResponsibilityCommon={checkUserPermissionsOnChange:function(a,b,c){b.change(function(){var e=this.options[this.selectedIndex];var d=e?e.value:0;if(d){a.html("");var f=$j(BS.loadingIcon).appendTo("body").css({zIndex:100}).position({my:"left",at:"right",of:b.parent(),offset:"2 0"});BS.ajaxRequest(window["base_uri"]+"/investigationWarning.html",{method:"get",parameters:{projectId:c,userId:d},onComplete:function(g){a.html(g.responseText);f.remove();}});}});}};BS.ResponsibilityDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("investigationForm");},getContainer:function(){return $("investigationFormDialog");},getUrl:function(){return window["base_uri"]+"/buildTypeInvestigationDialog.html";},showDialog:function(d,a,h){var g='Investigate "'+a.escapeHTML()+'"'+(a.length>20?"":" build configuration");$j("#investigationFormTitle").html(g);var f=$j("#investigationForm .modalDialogBody");f.html(BS.loadingIcon+"&nbsp;Loading...");this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));function c(i){i=$j(i);if(!i.prop("checked")){i.click().trigger("change");new Effect.Highlight(i.next("label")[0]);}}function b(){if($j("#currentBuildType img").attr("src").indexOf("success")!=-1){var i=$j("#bt-remove-investigation");i.prop("selectedIndex",1).trigger("change");new Effect.Highlight(i.parent().parent().find("label")[0]);}}var e=this;BS.ajaxUpdater(f[0],this.getUrl(),{method:"get",evalScripts:true,parameters:{buildTypeId:d},onComplete:function(){e.showCentered();e._handleDefaults(jQuery);e.hideMoreLinkIfNeeded();if(h){c("#bt-fix-investigate");}else{if($j("#bt-responsible option:selected").text()=="me"&&$j("#bt-giveup-investigate").is(":checked")){c("#bt-assign-investigate");b();}}}});return false;},_handleDefaults:function(g){var h=g("#do-bt-investigate"),o=g("#bt-investigate-section input[name=investigate]"),p=g("#bt-assign-investigate"),e=g("#bt-responsible"),n=g("#bt-remove-investigation");o.change(function(){b(h);});h.change(function(){if(!g(this).is(":checked")){c(o);}else{b(p);}});e.add(n).change(function(){b(p);b(h);});function b(q){return q.prop("checked",true);}function c(q){return q.prop("checked",false);}function i(q){q.prop("disabled",false);}function f(q){q.prop("disabled",true);}function a(){if(h.is(":checked")){i(g("#bt-submit"));}else{f(g("#bt-submit"));}}var l={};var k=g("#bt-investigate-section");function d(r,q){q.find("select, input[type=text]").each(function(){r[this.id]=g(this).val();});q.find("input[type=radio], input[type=checkbox]").each(function(){r[this.id]=g(this).is(":checked");});}function j(r,q){q.find("select, input[type=text]").each(function(){g(this).val(r[this.id]).trigger("change");});q.find("input[type=radio], input[type=checkbox]").each(function(){if(r[this.id]){b(g(this));}else{c(g(this));}});}d(l,k);var m=g("#bt-reset-investigate");o.add(e).add(n).change(function(){m.show().parent().addClass("modifiedParam");});m.click(function(){j(l,k);m.hide().parent().removeClass("modifiedParam");c(h);a();return false;});o.add(e).add(n).change(function(){a();});},moreConfigurations:function(){$j("#allBuildTypes").show();$j("#moreBuildTypes, #currentBuildType").hide();this._fixElementPlacement();return false;},hideMoreLinkIfNeeded:function(){var a=$j("#allBuildTypes input[type=checkbox]").length;if(a<=1){$j("#moreBuildTypes").hide();}},checkUserPermissionsOnChange:function(a){BS.ResponsibilityCommon.checkUserPermissionsOnChange($j("#bt-investigation-warning"),$j("#bt-responsible"),a);},submit:function(){$j("#moreBuildTypes").hide();var a=$j("#responsibilityProgressIcon").show();BS.FormSaver.save(this,this.getUrl(),OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(){a.hide();BS.reload(true);},onFailure:function(){a.hide();alert("Problem accessing server");}}));return false;},setButtonsEnabling:function(){var a=$j("#allBuildTypes input[type=checkbox]:checked").length>0;$j("#bt-submit").prop("disabled",!a);}}));BS.Responsibilities=OO.extend(BS.AbstractWebForm,{formElement:function(){return $("responsibilitiesFilter");},savingIndicator:function(){return $("respRefreshProgress");},submitFilter:function(){var a=this;this.setSaving(true);this.disable();BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.SimpleListener,{onCompleteSave:function(){if($("responsibilitiesTable")){$("responsibilitiesTable").refresh("respRefreshProgress",null,function(){a.setSaving(false);a.enable();});}}}));return false;}});BS.BulkInvestigateDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{_submitUrl:null,getContainer:function(){return $("muteTestsFormDialog");},formElement:function(){return $("muteTestsForm");},getInnerContainer:function(){return $("mute-dialog-container");},getLoadingElement:function(){return $("mute-dialog-inner-progress")||$("mute-dialog-progress");},prepareOnShow:function(b,a){(function(i){function y(A){return A.prop("checked",true);}function x(A){return A.prop("checked",false);}function p(A){A.prop("disabled",false);}function f(A){A.prop("disabled",true);}var e=i("#do-investigate"),r=i("#muteTestsForm input[name=investigate]"),u=i("#assign-investigate"),w=i("#investigator"),d=i("#remove-investigation");r.change(function(){y(e);});e.change(function(){if(!i(this).is(":checked")){x(r);}else{y(u);}});w.add(d).change(function(){y(u);y(e);});var t=i("#do-mute"),z=i("#muteTestsForm input[name=mute]"),k=i("#mute-mute"),v=i("#mute-scope, #unmute, #unmute-time, #mute-in-bt-list input");z.change(function(){y(t);});t.change(function(){if(!i(this).is(":checked")){x(z);}else{y(k);}});v.change(function(){y(k);y(t);});var c=i("#commentOrScopeChanged");i("#investigate-comment").on("keydown",function(){y(c);l();});i("#unmute-time").placeholder({text:"Click to select the date"});i("#unmute-time").focus(function(){i("#unmute-time").placeholder("hide");});i("#mute-scope").change(function(){if(this.selectedIndex==1){i("#mute-in-bt-list").show();if(a){var A=i("#mute-in-bt-"+a);if(!A.is(":checked")){y(A);i("#mute-in-bt-list").animate({scrollTop:A.position().top},function(){new Effect.Highlight(A.parent()[0]);});}}}else{i("#mute-in-bt-list").hide();}i("#unmute-time").placeholder("refresh");});i("#unmute").change(function(){if(this.selectedIndex==2){i("#unmute-row").show();}else{i("#unmute-row").hide();}i("#unmute-time").datepicker(this.selectedIndex==2?"show":"hide");i("#unmute-time").placeholder("refresh");});i("#unmute-time").datepicker({minDate:+1,dateFormat:"dd.mm.yy",defaultDate:+7}).css({marginTop:4});var s={},o={};var g=i("#investigate-section"),n=i("#mute-section");function h(B,A){A.find("select, input[type=text]").each(function(){B[this.id]=i(this).val();});A.find("input[type=radio], input[type=checkbox]").each(function(){B[this.id]=i(this).is(":checked");});}function q(B,A){A.find("select, input[type=text]").each(function(){i(this).val(B[this.id]).trigger("change");});A.find("input[type=radio], input[type=checkbox]").each(function(){if(B[this.id]){y(i(this));}else{x(i(this));}});}h(s,g);h(o,n);var j=i("#reset-investigate"),m=i("#reset-mute");r.add(w).add(d).change(function(){j.show().parent().addClass("modifiedParam");});j.click(function(){q(s,g);j.hide().parent().removeClass("modifiedParam");x(e);l();return false;});z.add(v).change(function(){m.show().parent().addClass("modifiedParam");});m.click(function(){q(o,n);m.hide().parent().removeClass("modifiedParam");x(t);l();return false;});if(b){y(e);y(u);j.show().parent().addClass("modifiedParam");}function l(){if(i(".investigate-no-permission").length>0){f(i("#submit"));return;}if(e.is(":checked")||t.is(":checked")||c.is(":checked")){p(i("#submit"));}else{f(i("#submit"));}}r.add(w).add(d).add(z).add(v).change(function(){l();});l();})(jQuery);},_doShow:function(d,c,b,a){this._reenable(d);this._dialogClass(true,"wideDialog");this.showAtFixed($(this.getContainer()));this.bindCtrlEnterHandler(this.submit.bind(this));this._lastShowArgs={title:d,params:c,fixMode:b};if(!a){c=Object.extend({},c);c["init"]=1;}this._loadContent(window["base_uri"]+this._submitUrl,c,b);
return false;},submit:function(){if(this.validate()){return this._submit(window["base_uri"]+this._submitUrl+"?post=true");}return false;},validate:function(){var b=jQuery("#mute-scope").val(),a=jQuery("#unmute").val(),d=jQuery("#investigate-comment").val();jQuery("#mute-dialog-container div.error-msg").html("");if(jQuery("#mute-mute").is(":checked")){if(b=="C"){if(jQuery("#mute-in-bt-list input:checked").length==0){return this.validationError("#bt-list-error","Please choose the build type");}}if(a=="T"){var c=jQuery("#unmute-time").val();if(c.length==0){return this.validationError("#unmute-time-error","Please specify the unmute date");}else{if(!/^\d{1,2}\.\d{1,2}\.\d{4}$/.match(c)){return this.validationError("#unmute-time-error","Please specify the correct unmute date");}}}}if(d.length>2000){return this.validationError("#comment-error","The comment is too long, only 2000 characters are possible.");}return true;},validationError:function(a,b){jQuery(a).html(b);return false;},_reenable:function(a){BS.Util.reenableForm(this.formElement());this.setTitle(a);if(!$j($(this.getContainer())).is(":visible")){this.getInnerContainer().innerHTML="";}},_loadContent:function(a,d,c){var b=this;BS.Util.show(this.getLoadingElement());BS.ajaxRequest(a,{method:"POST",parameters:d,onComplete:function(e){BS.Util.hide(b.getLoadingElement());$j(b.getInnerContainer()).html(e.responseText);b.showCentered();if(b._savedState){b._restoreForm();return;}if(c){setTimeout(function(){b._updateToFixedState();},500);}}});},_updateToFixedState:function(){var a=function(c){var e=$j(c).prop("checked");if(!e){$j(c).click();$j(c).trigger("change");var d=$j(c).next("label")[0];d&&new Effect.Highlight(d);}};a("#fix-investigate");a("#unmute-mute");var b=$j("#investigate-comment");b.val("I've fixed this!");b.focus();$("submit").enable();},_submit:function(a){var b=this,c=$j("#investigate-saving");c.show();BS.FormSaver.save(this,a,OO.extend(BS.ErrorsAwareListener,{onSuccessfulSave:function(){c.hide();b.close();b.smartReload();},onGeneralError:function(d){alert(d.firstChild.nodeValue);}}));return false;},_dialogClass:function(c,b){var a=jQuery(this.getContainer());if(c){a.addClass(b);}else{a.removeClass(b);}},setTitle:function(a){$j("#muteTestsFormTitle").html(a);},getQuery:function(){var b=window.location.search.substring(1),d=b.split("&"),c={};for(var a=0;a<d.length;a++){var e=d[a].split("=");c[e[0]]=e[1];}return c;},reopenBuildResultsPopup:function(){var d=jQuery("div.summaryContainer").filter(":visible").parent();if(!d.length){return false;}var c=d.attr("id");var a=d.position();if(!c||!a){return false;}var b=BS.BuildResultsPopupTracker(c.substr("popupRes".length)).getPopup();if(!b){return false;}BS.Hider.hideAll();b._showWithDelay(a.left,a.top);return true;},smartReload:function(){var a=window.location.href,d=window["base_uri"];if(!a.startsWith(d)){return this.fallbackReload();}a=a.substr(d.length);var e=this.getQuery(),c=e["tab"];if(a=="/"||a.startsWith("/overview.html")||(a.startsWith("/project.html")&&(!c||c=="projectOverview"))||(a.startsWith("/viewType.html"))){if(this.reopenBuildResultsPopup()){return;}return this.fallbackReload();}if(a.startsWith("/viewLog.html")){return this.reloadSubtree("buildResults");}if(a.startsWith("/project.html")){return this.reloadSubtree("projectContainer");}if(a.startsWith("/changes.html")){if(this._lastTestId){var b=$("testNameId"+this._lastTestId).up(".refreshable");return this.reloadSubtree(b);}return this.fallbackReload();}return this.fallbackReload();},reloadSubtree:function(c){var a=$(c),b=$("loadingWarning");if(b){b.style.display="block";}a.refresh(null,null,function(){b.style.display="none";});BS.Hider.hideAll();},fallbackReload:function(){BS.reload(true);},checkUserPermissionsOnChange:function(a){BS.ResponsibilityCommon.checkUserPermissionsOnChange($j("#test-investigation-warning"),$j("#investigator"),a);}}));BS.BulkInvestigateMuteTestDialog=OO.extend(BS.BulkInvestigateDialog,{_submitUrl:"/tests/bulkInvestigate.html",show:function(b,d){var a=_.size(b);if(b["projectId"]){--a;}var c=(d?"Fix ":"Investigate / Mute ")+a+" Test"+(a==1?"":"s");return this._doShow(c,b,d);},showForTest:function(a,b,c,g,f){var e=f?"Fix 1 Test":"Investigate / Mute 1 Test";var d={};d[a]=b;d["projectId"]=g||BS.TestGroup.findProjectIdByGroupId(c);this._lastTestId=a;return this._doShow(e,d,f);},showForBuildProblem:function(b,a,e){var d=e?"Fix 1 Build Problem":"Investigate / Mute 1 Build Problem";var c={};c["BuiPro"+b]=a;return this._doShow(d,c,e);},reloadDialog:function(){var a=this._lastShowArgs;if(!a.params["originalScope"]){a.params["originalScope"]=a.params["projectId"];}a.params["projectId"]=$j("#scopeProjectId").val();this._saveForm();return this._doShow(a.title,a.params,a.fixMode,true);},_saveForm:function(){var b={};var a=$j("#mute-dialog-container");$j("select, textarea",a).not("#scopeProjectId").add("#unmute-time").each(function(){b[this.id]=$j(this).val();});$j("input[type=radio]",a).each(function(){b[this.id]=$j(this).is(":checked");});this._savedState=b;},_restoreForm:function(){var b=this._savedState;var a=$j("#mute-dialog-container");$j("select, textarea",a).not("#scopeProjectId").add("#unmute-time").each(function(){var c=$j(this),d=c.val(),e=b[this.id];if(d!=e){c.val(e).trigger("change");}});$j("input[type=radio]",a).each(function(){var c=$j(this),d=c.is(":checked"),e=b[this.id];if(d!=e){c.prop("checked",e).trigger("change");}});this._savedState=null;}});;
/*---
/js/bs/changeBuildStatus.js
---*/
BS.ChangeBuildStatusDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("changeBuildStatus");},getContainer:function(){return $("changeBuildStatusDialog");},showDialog:function(b,a,d){var c=(a?"successful":"failed");$("changeBuildStatusTitle").innerHTML="Mark build "+c+$$(".changeBuildStatus-why")[0].innerHTML;$("changeBuildStatusSubmitButton").value="Mark "+c;this.formElement().changeBuildStatus.value=b;this.formElement().status.value=a?"NORMAL":"FAILURE";this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));this._activateComment();this.clearErrors();this.formElement().down(".changeBuildStatus-errorText").innerHTML="";this.formElement().down(".changeBuildStatus-warningText").innerHTML=!d?"Running build may overwrite the status change later":"";return false;},_activateComment:function(){var a=this.formElement().comment;a.disabled=false;a.focus();a.select();},submit:function(){var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onStatusError:function(b){this._processError(b);},onBuildError:function(b){this._processError(b);},onCommentError:function(b){a.highlightErrorField(a.formElement().comment);this._processError(b);a._activateComment();},_processError:function(b){a.formElement().down(".changeBuildStatus-errorText").innerHTML=b.firstChild.nodeValue;},onSuccessfulSave:function(){BS.reload(true);},onFailure:function(){alert("Problem accessing server");}}));return false;},_f:null}));;
/*---
/js/bs/tree.js
---*/
(function(){function a(){$j("ul.tree").each(function(){d(this);this.className=this.className.replace(/ ?unformatted ?/," ");});}function d(f){var l,k;var o,n,m;var h,q,g;for(l=0;l<f.childNodes.length;l++){if(f.childNodes[l].tagName&&f.childNodes[l].tagName.toLowerCase()=="li"){var p=f.childNodes[l];o=document.createElement("span");n=document.createElement("span");m=document.createElement("span");o.appendChild(n);n.appendChild(m);o.className="a "+p.className.replace("closed","spanClosed");o.onmouseover=function(){};n.className="b";n.onclick=e;m.className="c";q=p.childNodes.length;h=0;g=null;for(k=0;k<p.childNodes.length;k++){if(p.childNodes[k].tagName&&p.childNodes[k].tagName.toLowerCase()=="div"){h=k+1;continue;}if(p.childNodes[k].tagName&&p.childNodes[k].tagName.toLowerCase()=="ul"){g=p.childNodes[k];q=k;break;}}for(k=h;k<q;k++){m.appendChild(p.childNodes[h]);}if(p.childNodes.length>h){p.insertBefore(o,p.childNodes[h]);}else{p.appendChild(o);}if(g!=null){if(d(g)){$j(p).addClass("children");$j(o).addClass("children");}}}}if(p){$j(p).addClass("last");$j(o).addClass("last");return true;}else{return false;}}function e(i,j){i=this;while(i!=null&&(!i.tagName||i.tagName.toLowerCase()!="li")){i=i.parentNode;}var h=$j(i);var f=h.children("ul").get(0);var g=h.children("span").get(0);if(j!=null){if(j=="open"){c(g,i);}else{if(j=="close"){b(g,i);}}}else{if(f!=null){if(!i.className.match(/(^| )closed($| )/)){b(g,i);}else{c(g,i);}}}}function c(g,f){$j(g).removeClass("spanClosed");$j(f).removeClass("closed");}function b(g,f){$j(g).addClass("spanClosed");$j(f).addClass("closed");}window.autoInit_trees=a;})();BS.VCS={_vcsTreeHandlers:[],_vcsTreeCallbacks:[],registerTreePopup:function(a,e,h,d,i,f){var c=this;var g=this._getCallbackName(a,h,d);this._vcsTreeHandlers[a]=function(){BS.LazyTree.ignoreHashes=true;var k=window["base_uri"]+"/buildTypeVcsBrowser.html?lazy-tree-update=true&id="+e+"&treeId="+a+"&callback="+g;BS.LazyTree.treeUrl=c._applyAdditionalOptions(k,f);var j=new BS.Popup("vcsTreePopup",{hideOnMouseOut:false,hideOnMouseClickOutside:true,shift:{x:0,y:20},url:BS.LazyTree.treeUrl});j.showPopupNearElement($(i));};if(d){var b={updateVisibility:function(){if($j(BS.Util.escapeId(d)).is(":disabled")){$j(BS.Util.escapeId(i)).hide();}else{$j(BS.Util.escapeId(i)).show();}}};BS.VisibilityHandlers.attachTo(d,b);}},showTree:function(a){(this._vcsTreeHandlers[a])();},registerTree:function(a,b,d,g,c){var e=this;var f=this._getCallbackName(b,g);this._vcsTreeHandlers[b]=function(){BS.LazyTree.ignoreHashes=true;BS.LazyTree.treeUrl=window["base_uri"]+"/buildTypeVcsBrowser.html?lazy-tree-update=true&id="+d+"&treeId="+b+"&callback="+f;BS.LazyTree.treeUrl=e._applyAdditionalOptions(BS.LazyTree.treeUrl,c);BS.LazyTree.loadTree(a);};},_applyAdditionalOptions:function(b,a){if(a.vcsRootId){b+="&vcsRootId="+a.vcsRootId;}if(a.dirsOnly){b+="&dirsOnly="+a.dirsOnly;}if(a.rootDirName){b+="&rootDirName="+encodeURIComponent(a.rootDirName);}return b;},fileChosen:function(b,a,d){var c=this._vcsTreeCallbacks[a];if(c){c(b,d);}},_getCallbackName:function(b,c,a){if(a){this._vcsTreeCallbacks[b]=function(d,e){$j(BS.Util.escapeId(a)).val(d);BS.Highlight(e,{restorecolor:"#ffffff"});};return"BS.VCS.fileChosen";}return c;}};BS.LazyTree={treeUrl:null,ignoreHashes:false,options:{},getUrl:function(){var b=(this.treeUrl)?this.treeUrl:document.location.href;var a=b.indexOf("#");if(a>=0){b=b.substring(0,a);}return b;},getHash:function(){var a=window.location.hash;if(a){if(this.ignoreHashes||!a.startsWith("#!")){return"";}a=a.substring(2);}return a;},setHash:function(a){if(!this.ignoreHashes){window.location.hash="#!"+a;}},loadTree:function(a){a=$(a);this.initNavigation(a);$j("<span>",{css:{display:"none"},html:BS.loadingIcon+"&nbsp;Loading...",appendTo:a}).fadeIn("slow");var b=this;BS.ajaxRequest(b.getUrl(),{parameters:"lazy-tree-update=1&lazy-tree-open="+b.getHash(),method:"get",onComplete:function(c){a.innerHTML="";a.insert(c.responseText);$j(document).trigger("bs.treeLoaded",[a,b.options]);}});},toggleShow:function(b){var a=$("U"+b);if(a){if(a.visible()){a.hide();this.updateClass(b,"open","closed");this.removeHash(b);if(this.isErrorNode(a)){a.remove();}}else{a.show();this.updateClass(b,"closed","open");this.addHash(b);}}else{if(this.updateClass(b,"closed","open")){this.loadSubtree(b);this.addHash(b);}}},updateClass:function(d,c,b){d=$(d);var a=d.className.split(" ");if(a.indexOf(c)==-1&&a.indexOf(b)!=-1){return false;}a.splice(a.indexOf(c),1);a.push(b);d.className=a.join(" ");return true;},addHash:function(b){var a=this.getHash();if(!a){this.setHash(b);}else{this.setHash(a+","+b);}},removeHash:function(d){var c=this.getHash();if(!c){return;}var b=c.split(",");var a=b.indexOf(d);if(a>=0){b.splice(a,1);}this.setHash(b.join(","));},loadSubtree:function(e){var b=$(e);var d=$j("<i/>").css({marginLeft:"16px",display:"none"}).append(BS.loadingIcon).append("&nbsp;Loading...").appendTo(b);setTimeout(function(){d.show();},200);var c=[];while(b&&b.className.lastIndexOf("lazy-tree")==-1){if(b.className.lastIndexOf("lazy-subtree")==-1){c.push(b.id);}b=b.parentNode;}c.reverse();var a=this;BS.ajaxRequest(this.getUrl(),{parameters:"lazy-tree-update=1&lazy-tree-root="+e+"&lazy-tree-path="+c.join(","),method:"get",onComplete:function(f){d.remove();$(e).insert(f.responseText);$j(document).trigger("bs.subtreeLoaded",[$(e),a.options]);}});},isErrorNode:function(b){var a=b.childNodes;return a&&a.length==1&&a[0].className=="tree-error";},initNavigation:function(c){c=$j(c);var b=c.attr("id");function f(i){return i.hasClass("open");}function d(i){return i.hasClass("leaf");}function h(k,j){if(k.attr("id")==b){return null;}var i;if(j&&f(k)){i=k.children("div:visible:first");if(i.length){return i;}}i=k.next();if(i.length){return i;}return h(k.parents("div:visible:first"),false);}function a(k){var i=k.prev();if(i.length){var j=i.find("div:visible:last");if(j.length){return j;}return i;}i=k.parents("div.open:visible:first");if(i.length){return i;}return null;}function e(j){if(!f(j)&&!d(j)){var i=j.attr("id");if(i){BS.LazyTree.toggleShow(i);}}return null;}function g(j){if(f(j)&&!d(j)){var i=j.attr("id");if(i){BS.LazyTree.toggleShow(i);}}return null;}c.on("keydown",function(l){var k=l.keyCode;if(k!=Event.KEY_DOWN&&k!=Event.KEY_UP&&k!=Event.KEY_RIGHT&&k!=Event.KEY_LEFT){return true;}var j=c.find(":focus");if(!j.length){return true;}var m=j.closest("div");var i;switch(k){case Event.KEY_DOWN:i=h(m,true);break;case Event.KEY_UP:i=a(m);break;case Event.KEY_RIGHT:i=e(m);break;case Event.KEY_LEFT:i=g(m);break;}if(i){i.find("a:first").focus();}return false;});$j(document).on("bs.treeLoaded",function(){c.find("a:first").focus();});}};BS.FileBrowse={error:function(a){this.setSaving(false);$j("#uploadError").text(a).show();},clear:function(){var a=$j(this.getContainer());a.find("input[type=file]").val("");$j("#uploadError").hide();},show:function(){this.clear();this.showCentered();return false;},validate:function(){var c=$j("#fileName").val(),b=$j("#file\\:fileToUpload").val();if(c==""){this.error("Please set the file name");return false;}var a=$j("#destination");if((!a.length||a.val()==a.attr("default"))&&!this.checkFileNotExists(c)){return false;}if(b==""){this.error("Please select a file to upload");return false;}this.setSaving(true);return true;},deleteFile:function(c,d,b,e){var a=(!b)?'Delete "'+e+'"?':b+"\n"+"Delete anyway?";if(!confirm(a)){return false;}BS.ajaxRequest(c,{method:"post",parameters:{action:"delete",fileName:e},onComplete:function(){document.location.href=d;}});return false;},startEdit:function(){var a=this._toggleEdit();a.focus();return false;},_toggleEdit:function(){var a=$j("#edit-area").toggle().siblings(".fileContent").toggle().end();$j(".fileOperations").toggle();$j("#modifiedMessage").toggle();return a;},cancelEdit:function(){this._toggleEdit();},save:function(a,b){BS.ajaxRequest(a,{method:"post",parameters:{action:"edit",fileName:b,content:$j("#edit-area").val()},onComplete:function(){BS.reload();}});},setFiles:function(a){this.files=a;
},prepareFileUpload:function(){var a=$j(this.getContainer()),c=false,b="";$j("#fileName").on("input",function(){b=this.value;c=!!this.value.length;return false;});if(window.attachEvent){$j("#fileName").on("keyup change",function(){if(!this.value.length){c=false;}else{if(this.value!==b){c=true;b=this.value;}}});}a.find("input[type=file]").change(function(){var e=$j(this).val();if(e&&!c){var f=(e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/"));var d=e.substring(f);if(d.indexOf("\\")===0||d.indexOf("/")===0){d=d.substring(1);}$j("#fileName").val(d);}});},checkFileNotExists:function(b){for(var a=0;a<this.files.length;++a){if(b==this.files[a]){return confirm('File "'+b+'" already exists. Replace it?');}}return true;},closeAndRefresh:function(){this.setSaving(false);this.close();$j("#refreshing").show();this.refresh();},autoRunOperation:function(){var b=window.location.hash;if(b&&!b.startsWith("#!")){var a=this;$j(function(){if(b.startsWith("#edit")){a.startEdit&&a.startEdit();}if(b.startsWith("#upload")){var c=$j("#destination");var d=b.substr(7);if(d.startsWith(":")){d=d.substr(1);}if(d.include("!")){d=d.substr(0,d.indexOf("!"));}if(d){var e=c.val();if(!e.endsWith("/")){e+="/";}e+=d;c.val(e);}a.show&&a.show();}});if(b.include("!")){window.location.hash="#"+b.substr(b.indexOf("!"));}else{window.location.hash="";}}}};;
/*---
/js/bs/issues.js
---*/
BS.IssueDetails=function(b,c,a,d){BS.Popup.call(this,b,{issueId:c,providerId:a,projectExternalId:d,shift:{x:-80},zIndex:200,textProvider:function(e){if(!$("issueDetailsTemplate")){return"";}var f=$("issueDetailsTemplate").innerHTML;f=f.replace(/##ISSUE_ID##/g,e.options.issueId);f=f.replace(/##PROJECT_ID##/g,e.options.projectExternalId);setTimeout(function(){this.showDetailedInfo();}.bind(e),50);return f;}});};_.extend(BS.IssueDetails.prototype,BS.Popup.prototype);BS.IssueDetails.prototype.showDetailedInfo=function(){this._loaded=false;var d=this.options.issueId;var a=this.options.providerId;var b=this.options.projectExternalId;var c=window["base_uri"]+"/issueDetailsPopup.html";BS.ajaxUpdater($("detailedSummary:"+d+"_"+b),c,{evalScripts:true,method:"GET",parameters:{issueId:d,providerId:a,projectId:b},onComplete:function(){this.updatePopup();this._loaded=true;}.bind(this)});};;
/*---
/js/bs/pluginProperties.js
---*/
BS.PluginPropertiesForm=OO.extend(BS.AbstractWebForm,{serializeParameters:function(){var e=BS.Util.serializeForm(this.formElement());var f=Form.getInputs(this.formElement(),"password");if(!f){return e;}for(var c=0;c<f.length;c++){var b=f[c].name;if(b.indexOf("prop:")!=0){continue;}var a="prop:encrypted:"+f[c].id;e+="&"+a+"=";var d=$(a).value;if(d==""||f[c].value!=f[c].defaultValue){d=BS.Encrypt.encryptData(f[c].value,this.formElement().publicKey.value);}e+=d;}return e;},propertiesErrorsHandler:function(b,a){BS.PluginPropertiesForm.showError(b,a.firstChild.nodeValue);},showError:function(d,c){var a=$(d),b=$("error_"+d);if(b){b.innerHTML=c.escapeHTML();}if(a&&a.type&&(a.type=="text"||a.type=="password")){a.addClassName("errorField");}}});BS.MultilineProperties={init:function(a){BS.MultilineProperties.addProperty(a,function(){var c=$(a),b=$(a+"_Container"),d=$(a+"_DragCorner");d.draw=function(e){this.style.left=(e.offsetWidth-this.width-4)+"px";this.style.top=(e.offsetHeight-this.height-4)+"px";};b.recalculateOffset=function(){this._offset=$(this).positionedOffset();};b.getOffset=function(){return this._offset;};$j(c).off("keypress paste").on("keypress paste",function(){BS.MultilineProperties.sanitize(this);});new Draggable(d,{change:function(e){var i=$(a),h=$(a+"_Container"),l=$(a+"_DragCorner");var g=i.cumulativeOffset();var k=l.cumulativeOffset();var j=(k[0]-g[0]);var f=(k[1]-g[1]);if(j>=150&&f>=40){h.style.width=(j+4)+"px";h.style.height=(f+6)+"px";i.style.width=j+"px";i.style.height=(f-l.height-1)+"px";h.recalculateOffset();}l.draw(h);BS.MultilineProperties.updateVisible();}});});},_init:function(){if(!this._properties){this._properties=[];}},_findProperty:function(a){for(var b=0;b<this._properties.length;b++){var c=this._properties[b];if(c.name==a){return c;}}return null;},clearProperties:function(){this._properties=null;},addProperty:function(a,d){this._init();var b=this._findProperty(a);if(b){b.visible=false;b.initFunc=d;}else{var c={};this._properties.push(c);c.visible=false;c.name=a;c.initFunc=d;}},setVisible:function(a,c){var b=this._findProperty(a);if(b){b.visible=c;}},isVisible:function(a){var b=this._findProperty(a);if(b){return b.visible;}return false;},updateVisible:function(){var a=this;if(this._properties){this._properties.forEach(function(b){b.visible&&a.doShow(b.name,false);});}BS.VisibilityHandlers.updateVisibility("mainContent");},show:function(b,a){this.doShow(b,a);BS.MultilineProperties.setVisible(b,true);BS.MultilineProperties.updateVisible();},doShow:function(d,c){var f=this._findProperty(d);if(!f){return;}var b=$(d+"_Container");if(!b){return;}if(f.initFunc){f.initFunc();}var g=$(d+"_LinkContainer");if(g){BS.Util.hide(g);}BS.Util.show(d+"_NoteContainer");var a=$(d);var e=$(d+"_DragCorner");if(!b){return;}BS.Util.show(b);BS.Util.show(e);b.style.width=a.offsetWidth+"px";b.style.height=a.offsetHeight+"px";b.recalculateOffset();e.draw(b);if(c&&!a.disabled){a.focus();}},sanitize:function(a){if(a.value.match(/\u00A0/)){a.value=a.value.replace(/\u00A0/g," ");}}};Event.observe(window,"resize",function(){BS.MultilineProperties.updateVisible();});;
/*---
/js/bs/serverLink.js
---*/
BS.ServerUnavailableModalDialog=OO.extend(BS.AbstractModalDialog,{zIndex:1000,_wasClosed:false,getContainer:function(){return $("shutdownDialog");},displayShutdownNote:function(){if(this.isVisible()||this._wasClosed){return;}BS.Util.hide("onCommunicationFailure");BS.Util.hide("onAuthFailure");BS.Util.show("onServerShutdown");$("shutdownDetails").innerHTML="Server is unavailable since "+new Date().toLocaleString();this.showCentered();},displayFailureNote:function(){if(this.isVisible()||this._wasClosed){return;}BS.Util.hide("onServerShutdown");BS.Util.hide("onAuthFailure");BS.Util.show("onCommunicationFailure");$("shutdownDetails").innerHTML="Server is unavailable since "+new Date().toLocaleString();this.showCentered();},displayAuthFailureNote:function(){if(this.isVisible()||this._wasClosed){return;}BS.Util.hide("onServerShutdown");BS.Util.hide("onCommunicationFailure");BS.Util.show("onAuthFailure");$("shutdownDetails").innerHTML="You are logged out since "+new Date().toLocaleString();this.showCentered();},afterClose:function(){this._wasClosed=true;},reset:function(){this._wasClosed=false;}});BS.ServerLink=OO.extend(BS.AbstractModalDialog,{_shutdown:false,_failuresNum:0,_scheduleReloadAfterUpgrade:function(a,c){if(!this._reloadTimeout){var b=Math.floor((Math.random()*30)+30);BS.Log.info("Server was upgraded ("+a+" -> "+c+"), page will be reloaded in "+b+" seconds.");this._reloadTimeout=setTimeout(function(){BS.reload(true);},b*1000);}},_onFailure:function(){if(++this._failuresNum>1){if(this._shutdown){BS.ServerUnavailableModalDialog.displayShutdownNote();}else{BS.ServerUnavailableModalDialog.displayFailureNote();}}},_onAuthFailure:function(){if((this._shutdown||!this.isConnectionAvailable())&&BS.Util.isPageVisible()){window.location.reload();}else{BS.ServerUnavailableModalDialog.displayAuthFailureNote();}},_onSuccess:function(){this._shutdown=false;this._failuresNum=0;BS.ServerUnavailableModalDialog.close();BS.ServerUnavailableModalDialog.reset();},onShutdown:function(){this._shutdown=true;},isConnectionAvailable:function(){return this._failuresNum==0;},waitUntilServerIsAvailable:function(c){var b=this;var a=function(){BS.ajaxRequest(window["base_uri"]+"/ajax.html?getServerVersion=true",{method:"GET",onComplete:function(d){if(d.status==200){var e=d.responseXML.documentElement.firstChild.nodeValue;if(!e){BS.Log.error("Successful connection from the server with unknown version");setTimeout(a,BS.internalProperty("teamcity.ui.serverAvailability.pollInterval")*1000);return;}if(e!=b._initialServerBuildNumber){b._scheduleReloadAfterUpgrade(b._initialServerBuildNumber,e);return;}b._onSuccess();c();}else{if(d.status==401){b._onAuthFailure();}else{b._onFailure();}setTimeout(a,BS.internalProperty("teamcity.ui.serverAvailability.pollInterval")*1000);}}});};a();},init:function(a){this._initialServerBuildNumber=a;}});;
/*---
/js/bs/activation.js
---*/
(function(){function a(e,d){this.id=e;this.url=d+"&noCache="+(new Date()).getTime()+"&server="+window["base_uri"];}a.prototype.done=function(d){this.indicator.style.backgroundColor=d;if(this.oncomplete){this.oncomplete(this.status);}};a.prototype.doneR=function(){if(window.opera||/loaded|complete/.test(this.transport.readyState)){this.status=1;this.doneL();}};a.prototype.doneL=function(){this.status=this.status|this.transport.width;if(this.status>0){this.done("green");}else{this.done("orange");}};a.prototype.doneE=function(){this.status=-1;this.done("silver");};a.prototype.go=function(){this.transport=document.getElementById(this.id);this.parent=document.getElementById(b.PANELID);if(this.transport){this.dispose();}this.transport=new Image();this.transport.id=this.id;if(BS.Browser.opera||BS.Browser.msie){this.transport.onreadystatechange=this.doneR.bind(this);}else{this.transport.onload=this.doneL.bind(this);}this.transport.onerror=this.doneE.bind(this);this.transport.onabort=this.doneE.bind(this);this.transport.style.display="none";this.indicator=document.createElement("div");this.indicator.className="activationIndicator";this.indicator.appendChild(this.transport);this.parent.appendChild(this.indicator);this.transport.src=this.url;};a.prototype.dispose=function(){if(BS.Browser.opera||BS.Browser.msie){this.transport.onreadystatechange=function(){};}else{this.transport.onload=function(){};}this.transport.onerror=function(){};this.transport.onabort=function(){};if(this.transport.parentNode){this.transport.parentNode.removeChild(this.transport);}if(this.indicator&&this.indicator.parentNode){this.indicator.parentNode.removeChild(this.indicator);}};function c(k){this.panel=document.getElementById(b.PANELID);if(!this.panel){this.parent=document.getElementsByTagName("body").item(0);this.panel=document.createElement("div");this.panel.className=b.PANELID;this.panel.setAttribute("id",b.PANELID);this.parent.appendChild(this.panel);this.panel.style.display="block";}this.sequential=BS.Browser.webkit;this.id="id_"+Math.random();var j=63330;var e=j+9;var d="http://127.0.0.1";this.responseCount=0;this.successes=0;this.connects=0;this.requests=new Array(e-j);var g=this.done.bind(this);for(var f=j;f<=e;f++){var h=d+":"+f+"/"+k;var i=new a("r_"+this.id+"_"+f,h);i.oncomplete=g;this.requests[f-j]=i;if(!this.sequential){i.go();}}this.index=0;if(this.sequential){this.go();}}c.prototype.go=function(){this.requests[this.index++].go();};c.prototype.done=function(d){this._processingResponse=true;if(this._timeout){clearTimeout(this._timeout);}this.responseCount++;if(d>=0){this.connects++;}if(d>0){this.successes++;}if(this.responseCount>=this.requests.length){this._timeout=setTimeout(this.notify.bind(this),2000);}this._processingResponse=false;if(this.sequential&&(this.index<this.requests.length)){this.go();}};c.prototype.notify=function(){if(this._processingResponse){return;}if(this.successes==0){if(this.connects==0){BS.ErrorDialog.showNoIdeRespondedError();}else{BS.ErrorDialog.showCanNotFindFileError();}}if(this.panel&&this.panel.parentNode){this.panel.parentNode.removeChild(this.panel);}this._timeout=null;for(var d=0;d<this.requests.length;d++){this.requests[d].oncomplete=function(){};this.requests[d].dispose();}};var b={};b.PANELID="activationPanel";b.doOpen=function(d){new c(d);};BS.Activator=b;})();BS.ErrorDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{getTitle:function(){return $("errorFormTitle");},getContainer:function(){return $("errorFormDialog");},formElement:function(){return $("errorForm");},getBody:function(){return $j("#errorFormDialog").find("div.modalDialogBody").get(0);},show:function(b,a){this.getTitle().innerHTML=b;this.getBody().innerHTML=a;this.showCentered();},showNoIdeRespondedError:function(){var a="<div>"+"<div>Make sure TeamCity plugin is installed, and you are logged in to TeamCity from within the IDE.</div>"+"<br>"+"<div>"+"You can download the plugin using one of these links:"+"<ul>"+"<li><a title='Download plugin for IntelliJ Platform IDEs' "+"href='"+window["base_uri"]+"/update/TeamCity-IDEAplugin.zip'>IntelliJ Platform plugin</a></li>"+"<li><a title='Download Addin for Visual Studio' "+"href='"+window["base_uri"]+"/update/vsAddinInstallerv4.msi'>Addin for Visual Studio</a></li>"+"<li><a title='Copy the link location and use it as the Eclipse update site' "+"href='"+window["base_uri"]+"/update/eclipse/'>Eclipse Plugin (update link)</a></li>"+"</ul>"+"</div>";if(window.opera){a+="<div>You seem to be using the Opera browser. Please <a href='#' id='allowOperaXSS'>click here</a> to allow Opera to connect to TeamCity and try again.</div>";}a+="</div>";this.show("No IDE responded",a);$j("#allowOperaXSS").click(function(){$j('<iframe src="http://127.0.0.1:63330/file" style="position: fixed; width: 100%; height: 300px; top: 0; z-index: 1000"/>').appendTo(document.body);return false;});},showCanNotFindFileError:function(){var a="<div>IDE cannot locate the requested file.</div>";this.show("Error",a);}}));;
/*---
/js/bs/datepicker.js
---*/
(function(b){var a=b.datepicker._gotoToday;b.datepicker._gotoToday=function(c){var e=b(c);var d=this._getInst(e.get(0));a.call(this,c);b.datepicker._selectDate(c,b.datepicker._formatDate(d,d.selectedDay,d.selectedMonth,d.selectedYear));};})(jQuery);;
/*---
/js/bs/tags.js
---*/
BS.Tags=OO.extend(BS.AbstractModalDialog,{formId:"editBuildTagsForm",getContainer:function(){return $(this.formId+"Dialog");},showEditDialog:function(a,c,g,b,f){var d=$(this.formId);d.editTagsForPromotion.value=a;d.buildTagsInfo.value=c;var e=d.buildPrivateTagsInfo;if(e){e.value=g;}$(this.formId+"_availableTags").innerHTML="";if(f){$(this.formId+"_availableTags").innerHTML=$(f).innerHTML;}this.showCentered();if(b){$j(BS.Util.escapeId(this.formId)+" .tagsApplyAll").show();}this.bindCtrlEnterHandler(this.submitTags.bind(this));return false;},appendTag:function(a){BS.Util.addWordToTextArea($j(BS.Util.escapeId(this.formId)+" textarea")[0],a);},submitTags:function(){var a=$(this.formId);Form.disable(a);BS.Util.show("savingTags");BS.ajaxRequest(a.action,{parameters:BS.Util.serializeForm(a),onComplete:function(){BS.Util.hide("savingTags");BS.Tags.close();BS.reload(true);Form.enable(a);}});return false;}});BS.FavoriteBuilds={loadingMore:false,tagBuild:function(f,e,c,b){var a=$j("#"+c).hasClass("addToFavorite");var d=document.createElement("form");d.innerHTML="<input type='hidden' value='"+e+"' name='favoriteBuild'/><input type='hidden' value='"+a+"' name='makeFavorite'/>";BS.ajaxRequest(f,{parameters:BS.Util.serializeForm(d),onComplete:function(){if(b){BS.reload(true);}else{if(a){$j("#"+c).removeClass("addToFavorite");$j("#"+c).html('<i class="icon-star"></i>');}else{$j("#"+c).addClass("addToFavorite");$j("#"+c).html('<i class="icon-star-empty"></i>');}}}});},loadMore:function(){console.log("loading more: "+this.loadingMore);if(this.loadingMore){return;}this.loadingMore=true;$j("#showMoreFavoriteBuildsProgress").css("visibility","visible");$j("#count").val(parseInt($j("#count").val())+50);$j("#favoriteBuildsForm").submit();}};;
/*---
/js/bs/allProjects.js
---*/
BS.projectMap={};BS.typeVisibilityMap={};BS.visibilityList=[];BS.BuildTypesPopup=function(a){this.projectId=a;this.buildTypes=BS.projectMap[a];BS.Popup.call(this,a+"btPopup",{shift:{x:30,y:-5},delay:0,className:"buildTypesPopup quickLinksMenuPopup custom-scroll",hideOnMouseOut:true,fitWithinWindowHeight:true,fitWithinWindowBottomMargin:100,doScroll:false,textProvider:function(d){var e=BS.typeVisibilityMap;var k=false;function f(n){if(e&&e[a]){for(var i in e[a]){if(e[a][i]===1){k=true;}}if(k&&e[a][n]===0){return false;}}return true;}var m=true;for(var g=0;g<d.buildTypes.length;g++){m=m&&d.buildTypes[g].visible;}var h=$j("#buildTypeUrlFormat").attr("url")||window["base_uri"]+"/viewType.html?buildTypeId={id}";var j='<ul class="menuList menuListFilterable">';for(g=0;g<d.buildTypes.length;g++){var l=d.buildTypes[g];var b=l.id;var c=h.replace("{id}",l.extId);j+='<li class="menuItem btItem_'+b+(!m&&l.visible?" visible":"")+'" '+'title="'+l.description+'" data-bt-id="'+b+'"';if(f(b)===false){j+='style="display: none"';}j+=">";j+='<a href="'+c+'" showdiscardchangesmessage="false" title="Open build configuration page" class="buildTypeIcon">'+l.name+"</a>";j+="</li>";}j+="</ul>";return j;}});this.install();};_.extend(BS.BuildTypesPopup.prototype,BS.Popup.prototype);_.extend(BS.BuildTypesPopup.prototype,{install:function(){var a=$("buildTypesPopup"+this.projectId);if(!a){return;}this.handle=a;var b=function(){if(BS.BuildTypesPopup.current){BS.BuildTypesPopup.current.hidePopup(0,true);}this.showPopupNearElement(this.handle);BS.BuildTypesPopup.current=this;}.bind(this);a.on("mouseover",b);},uninstall:function(){if(this.handle){Event.stopObserving(this.handle);this.handle=null;}}});BS.AllProjectsPopup=function(c,b,a){BS.Popup.call(this,c,{url:b,shift:{x:0,y:21},delay:0,hideOnMouseOut:false,afterShowFunc:function(){prepareBtPopups();}.bind(this),afterHideFunc:function(){this.btPopups=this.btPopups||[];for(var e=0;e<this.btPopups.length;e++){var d=this.btPopups[e];d.hidePopup(0,true);d.uninstall();}this.btPopups=[];BS.projectMap={};BS.typeVisibilityMap={};BS.visibilityList=[];$j(this.element()).html("");a&&a();}.bind(this)});};_.extend(BS.AllProjectsPopup.prototype,BS.Popup.prototype);BS.AllProjectsPopup.showAll=function(f){BS.SiblingsTreePopup.hideAll();if(BS.AllProjectsPopup.globalInstance){var g=$("overview_Tab");var c=$("allPopupImg");var d=c.getDimensions();var b=c.cumulativeOffset();var a=g.cumulativeOffset();BS.AllProjectsPopup.globalInstance.showPopupNearElement(c,{shift:{x:a[0]-b[0],y:d.height},hideOnMouseOut:true,overrideHideIfActive:"allProjectsPopupTable_filter",delay:f.type=="mouseover"?300:0,fitWithinWindowHeight:true,fitWithinWindowBottomMargin:100,doScroll:false});Event.stop(f);}};BS.AllProjectsPopup.install=function(){var b=BS.topNavPane.getTab("overview");b.setPostLinkContent("<div id='allPopupImg' title='View all projects'>&nbsp;</div>");b.setCaption("Projects");BS.AllProjectsPopup.globalInstance=new BS.AllProjectsPopup("allProjectsPopup",window["base_uri"]+"/allProjects.html");var a=$("allPopupImg");a.on("mouseover",function(c){a.addClassName("hovered");if(BS.AllProjectsPopup.globalInstance&&!BS.AllProjectsPopup.globalInstance.isShown()){BS.AllProjectsPopup.showAll(c);}else{BS.AllProjectsPopup.globalInstance.stopHidingPopup();}}.bindAsEventListener());a.on("mouseout",function(){a.removeClassName("hovered");if(BS.AllProjectsPopup.globalInstance.options.hideOnMouseOut){BS.AllProjectsPopup.globalInstance.hidePopup(1000);}});a.on("click",function(c){BS.AllProjectsPopup.globalInstance.hidePopup(0);BS.AllProjectsPopup.showAll(c);}.bindAsEventListener());jQuery(document).keydown(function(d){if(d.keyCode==80&&!BS.Util.isModifierKey(d)){var c=jQuery(d.target);if(c.is("input")||c.is("textarea")||c.is("select")){return;}BS.AllProjectsPopup.showAll(d);}});};BS.AllProjectsPopup.Navigation={projects:[],selectedProjectIdx:-1,selectedProject:null,popup:null,buildTypes:null,selectedBuildTypeIdx:-1,selectedBuildType:null,init:function(){var a=this;jQuery("#allProjectsPopupTable_filter").on("keydown",function(b){if(b.keyCode==Event.KEY_DOWN){a.activate();return false;}});jQuery("#allProjectsPopupTable tr").on("keydown",function(b){if(a.isActive()){switch(b.keyCode){case Event.KEY_DOWN:a.nextProject();break;case Event.KEY_UP:a.prevProject();break;case Event.KEY_RIGHT:a.toBuildTypes();break;case Event.KEY_RETURN:return true;default:return false;}return false;}});},activate:function(){this.projects=jQuery("#allProjectsPopupTable tr").filter(":visible");if(this.projects.length==0){return;}jQuery("#allProjectsPopupTable_filter").blur();this.selectProjectRow(0);},deactivate:function(){if(this.selectedProject){this.unselectProjectRow();}this.projects=[];this.selectedProjectIdx=-1;this.selectedProject=null;},isActive:function(){return this.projects.length>0;},selectProjectRow:function(a){this.selectedProjectIdx=a;this.selectedProject=jQuery(this.projects[a]);this.selectedProject.addClass("selected");this.selectedProject.find("a.projectLink").focus();},unselectProjectRow:function(){this.selectedProject.removeClass("selected");},selectBuildTypeItem:function(a){this.selectedBuildTypeIdx=a;this.selectedBuildType=jQuery(this.buildTypes[a]);this.selectedBuildType.addClass("selected");this.selectedBuildType.find("a").focus();},unselectBuildTypeItem:function(){this.selectedBuildType.removeClass("selected");},nextProject:function(){if(this.selectedProjectIdx<this.projects.length-1){this.unselectProjectRow();this.selectProjectRow(this.selectedProjectIdx+1);}},prevProject:function(){if(this.selectedProjectIdx>0){this.unselectProjectRow();this.selectProjectRow(this.selectedProjectIdx-1);}else{this.deactivate();jQuery("#allProjectsPopupTable_filter").focus();}},toBuildTypes:function(){var a=this.selectedProject.attr("data-filter-data");if(BS.projectMap[a].length==0){return;}this.popup=new BS.BuildTypesPopup(a);this.popup.showPopupNearElement(this.popup.handle);this.buildTypes=jQuery(BS.Util.escapeId(a+"btPopup")).find("li.menuItem").filter(":visible");this.unselectProjectRow();this.selectBuildTypeItem(0);var b=this;this.buildTypes.on("keydown",function(c){switch(c.keyCode){case Event.KEY_DOWN:b.nextBuildType();break;case Event.KEY_UP:b.prevBuildType();break;case Event.KEY_LEFT:b.toProjects();break;case Event.KEY_RETURN:return true;case Event.KEY_ESC:b.toProjects(true);break;case Event.KEY_RIGHT:default:return false;}return false;});},toProjects:function(a){this.unselectBuildTypeItem();if(!a){this.popup.hidePopup(0,true);}this.selectProjectRow(this.selectedProjectIdx);},nextBuildType:function(){if(this.selectedBuildTypeIdx<this.buildTypes.length-1){this.unselectBuildTypeItem();this.selectBuildTypeItem(this.selectedBuildTypeIdx+1);}},prevBuildType:function(){if(this.selectedBuildTypeIdx>0){this.unselectBuildTypeItem();this.selectBuildTypeItem(this.selectedBuildTypeIdx-1);}}};BS.AllProjectsPopup.populateVisibilityMap=function(h){var a=BS.typeVisibilityMap,b=BS.visibilityList||[],f=BS.AllProjectsPopup.globalInstance.btPopups||[],k,l,g,m,n;function e(p,o,q){var j=q["projectName"].toUpperCase();var i=0;p=p.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#034;/g,'"').replace(/&#039;/g,"'").toUpperCase();if(o==""||(p.indexOf(o)>-1&&j.indexOf(o)==-1)){i=1;}return i;}for(var d=0;d<f.length;d++){n=0;k=f[d].projectId;l=f[d].buildTypes;a[k]=a[k]||{};a[k]["_domCache"]=a[k]["_domCache"]||{};g=BS.projectMap[k][0];for(var c=0;c<l.length;c++){m=e(l[c].name,h,g);a[k][l[c].id]=m;n+=m;}if(n){b.push(k);}}return a;};BS.AllProjectsPopup.searchBuildTypes=function(b){var a=b.value.toUpperCase(),e=$j("#allProjectsPopupTable"),d=BS.AllProjectsPopup.populateVisibilityMap(a);function c(){var j=BS.visibilityList,n=j.length,q;for(var m=0;m<n;m++){q=j[m];var f=0;var r=[];var s=d[q]["_domCache"];var h=s["projectRowEl"]||(s["projectRowEl"]=e.find("#inplaceFiltered_"+q));var l=s["countEl"]||(s["countEl"]=h.find(".btCount"));if(l.data("originalCount")){l.text(l.data("originalCount"));}l.removeClass("btCountHighlighted");
for(var o in d[q]){if(o=="_domCache"){continue;}var g=d[q]["_domCache"]["typeRowEl"+o];var t=g||(g=$j("#"+q+"btPopup").find(".btItem_"+o));t.show();if(a.length>0){if(d[q][o]===1){f++;}if(d[q][o]===0){r.push(t);}}}if(f>0){$j.each(r,function(v,u){u.hide();});if(!l.data("originalCount")){l.data("originalCount",l.html());}l.text(f).addClass("btCountHighlighted");h.data("visibleElem",true).show();}if(h.data("visibleElem")){var k=parseInt(h.attr("data-depth"));while(k>0){k--;var p=h.data("parent");if(!p){p=h.prevAll("[data-depth="+k+"]").first();h.data("parent",p);}p.data("visibleElem",true).show();h=p;}}}}c();};BS.AllProjectsPopup.toggleOverview=function(i,f,k){k=$j.extend({loadingTop:0,loadingLeft:-20,updateParent:true},k||{});var e=$j(i),c=e.children(".icon16_watched"),j="icon16_watched_no",g=!c.hasClass(j),b=g?"hideProject":"addProject",h;var d=e.offset(),a=$j(BS.loadingIcon);a.css({position:"absolute",top:d.top+k.loadingTop+"px",left:d.left+k.loadingLeft+"px",zIndex:1000}).appendTo(document.body);BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:b+"="+f,onComplete:function(){a.remove();},onSuccess:function(){var l,n;if(g){h="addClass";n="Click to show project on the overview page";}else{h="removeClass";n="Project is shown on the overview page. Click to hide";}c[h](j);c.attr("title",n);if(k.updateParent){e.toggleClass("pinLink");e.parents("tr.inplaceFiltered").toggleClass("visibleProject");}if(BS.AllProjectsPopup.isOverviewPage===true){var m=$j("#overview-projects");if(m.length==0){m=$j('<div id="overview-projects">'+"Overview configuration has been changed, "+'<a href="#" onclick="BS.reload(true)">refresh the page</a> to see the changes.'+'<a href="#" class="dismiss-link" onclick="BS.Util.hide(this.parentNode)">Dismiss</a>'+"</div>");$j("#toolbar").append(m);}else{m.show();}}}});return false;};BS.SiblingsTreePopup={hideAll:function(){var b=BS.AllProjectsPopup,c=b.breadcrumbsInstance,a=b.globalInstance;if(c&&c.isShown()){c.hidePopup(0,true);}if(a&&a.isShown()){a.hidePopup(0,true);}},show:function(b,d){this.hideAll();var c=window["base_uri"]+"/allProjects.html?"+Object.toQueryString(d);var a=new BS.AllProjectsPopup("siblingsTreePopup",c,function(){BS.AllProjectsPopup.breadcrumbsInstance=null;});BS.AllProjectsPopup.breadcrumbsInstance=a;prepareBtPopups();a.showPopupNearElement(b[0],{fitWithinWindowHeight:true,fitWithinWindowBottomMargin:100,doScroll:false});}};function prepareBtPopups(){setTimeout(function(){this.btPopups=[];for(var a in BS.projectMap){this.btPopups.push(new BS.BuildTypesPopup(a));}BS.AllProjectsPopup.populateVisibilityMap("");}.bind(BS.AllProjectsPopup.globalInstance),200);if($("allProjectsPopupTable_filter")){$("allProjectsPopupTable_filter").activate();}}BS.QuickNavigation={_items:[],setUp:function(){var a=this._items;for(var b=0;b<a.length;++b){a[b].normName=a[b].name.toLowerCase();}this._projectDivider=$j(".project.divider");this._buildTypeDivider=$j(".build-type.divider");this._noResults=$j("#no-results");this._notAllResults=$j("#not-all-results");this.initNavigation();},applyFilter:function(n,p){n=n||$("quickNavList_filter");var k=this._items,f=n.value.toLowerCase(),q=f.length<2||f.blank();var o=new RegExp(f.replace(/([().?*])/g,"\\$1"),"gi"),j=0,l=false;var e=this._projectDivider.hide(),m=this._buildTypeDivider.hide(),h=this._noResults.hide(),g=this._notAllResults.hide();for(var d=0;d<k.length;++d){var r=k[d],b=r.name;var a=r.div||(r.div=document.getElementById(r.id)),c=r.val||(r.val=a.getElementsByClassName("val")[0]);if(!q&&!l&&r.normName.include(f)){if(a.className.lastIndexOf("match")==-1){if(!a.className.endsWith(" ")){a.className+=" ";}a.className+="match";}b=r.name.replace(o,function(i){return"<span class='hl'>"+i+"</span>";});c.innerHTML=b;if(r.type=="p"){e.show();}else{m.show();}j++;if(!p&&j>15){l=true;}}else{if(a.className.lastIndexOf("match")>=0){a.className=a.className.replace("match","");}}}if(!q&&j==0){h.show();}if(l){g.show();}},initNavigation:function(){var b=$j("#quickNavList_filter"),c=$j("#quickNavList");function a(d){if(d.is("input")||d.is("a")){d.focus();}else{d.find(".nav").focus();}return false;}b.on("keydown",function(g){var f=g.keyCode;if(f==Event.KEY_DOWN){var d=c.children(".entry:visible:first");if(d.length){return a(d);}}return true;});c.on("keydown",function(h){var g=h.keyCode;var i=$j(":focus");if((g!=Event.KEY_DOWN&&g!=Event.KEY_UP)||!i.length){return true;}var d=i.parent(),f;if(g==Event.KEY_DOWN){f=d.nextAll(".entry:visible:first");}else{f=d.prevAll(".entry:visible:first");if(!f.length){f=b;}}return a(f);});},clear:function(){this._items=[];this._projectDivider=null;this._buildTypeDivider=null;this._noResults=null;}};BS.QuickNavigationPopup=new BS.Popup("quickNav",{shift:{x:0},url:window["base_uri"]+"/quickNav.html",delay:0,afterHideFunc:function(){BS.QuickNavigation.clear();}});(function(a){a(document).keydown(function(c){if(c.keyCode==81&&!BS.Util.isModifierKey(c)){var b=a(c.target);if(b.is("input")||b.is("textarea")||b.is("select")){return;}BS.QuickNavigationPopup._showWithDelay(-500,-500,function(){$j("#quickNav").position({my:"center",at:"center",of:window,offset:"0 -200"});});}});})(jQuery);BS.ArchivedProjectsPopup={highlightMatchIfNeeded:function(){var b=$j("#allProjectsPopupTable_filter");var a=b.val();if(!a){return;}var c=new RegExp(a.replace(/([().?*])/g,"\\$1"),"gi");$j("#archivedProjectsPopupTable td.projectName a").each(function(){var e=$j(this);var f=e.html().trim();var d=f.replace(c,function(g){return"<span class='hl'>"+g+"</span>";});e.html(d);});}};;
/*---
/js/bs/adminActions.js
---*/
BS.SaveConfigurationListener=OO.extend(BS.ErrorsAwareListener,{onSaveProjectErrorError:function(a){alert(a.firstChild.nodeValue);},onProjectNotFoundError:function(a){BS.reload(true);},onBuildTypeNotFoundError:function(a){BS.reload(true);},onMaxNumberOfBuildTypesReachedError:function(a){alert(a.firstChild.nodeValue);}});BS.AdminActions={url:window["base_uri"]+"/admin/action.html",deleteBuildType:function(b,a,c){if(!a&&!confirm("Are you sure you want to delete this build configuration and all related data?")){return false;}BS.ajaxRequest(this.url,{parameters:"buildTypeId="+b+"&removeBuildType=1"+(a?"&forceDelete=1":"")+(c?"&cameFromUrl="+encodeURIComponent(c):""),onComplete:function(e){var d=BS.XMLResponse.processErrors(e.responseXML,{onReferencesExistError:function(f){var g=f.firstChild.nodeValue+"\nAre you sure you want to delete this build configuration?";if(confirm(g)){BS.AdminActions.deleteBuildType(b,true,c);}},onUndeletableReferencesExistError:function(f){alert(f.firstChild.nodeValue);},onRunningBuildsExistError:function(f){alert(f.firstChild.nodeValue);}});if(!d){BS.XMLResponse.processRedirect(e.responseXML);}}});return false;},deleteBuildTypeTemplate:function(a){if(!confirm("Are you sure you want to delete this template?")){return false;}BS.ajaxRequest(this.url,{parameters:"templateId="+a+"&removeTemplate=1",onComplete:function(c){var b=BS.XMLResponse.processErrors(c.responseXML,{cannotBeRemovedError:function(d){alert(d.firstChild.nodeValue);}});if(!b){BS.XMLResponse.processRedirect(c.responseXML);}}});return false;},deleteProject:function(b,a){if(!a&&!confirm("Are you sure you want to delete this project and all related data (build history, artifacts, etc.)?")){return false;}BS.ajaxRequest(this.url,{parameters:"projectId="+b+"&removeProject=1"+(a?"&forceDelete=1":""),onComplete:function(d){var c=BS.XMLResponse.processErrors(d.responseXML,{onProjectRemoveFailedError:function(e){alert(e.firstChild.nodeValue);},onReferencesExistError:function(e){var f=e.firstChild.nodeValue+"\nAre you sure you want to delete this project?";if(confirm(f)){BS.AdminActions.deleteProject(b,true);}},onUndeletableReferencesExistError:function(e){alert(e.firstChild.nodeValue);},onRunningBuildsExistError:function(e){alert(e.firstChild.nodeValue);}});if(!c){BS.XMLResponse.processRedirect(d.responseXML);}}});return false;},deleteVcsRoot:function(b,a){if(!confirm("Are you sure you want to delete this VCS root?")){return false;}BS.Util.hideSuccessMessages();BS.Util.show("vcsRootProgress_"+b);BS.ajaxRequest(this.url,{parameters:"removeVcsRoot="+b,onComplete:function(d){var c=BS.XMLResponse.processErrors(d.responseXML,{onReferencesExistError:function(e){alert(e.firstChild.nodeValue);}});if(!c){if(a){a();}else{BS.AdminActions._refreshAllRoots();}}else{BS.Util.hide("vcsRootProgress_"+b);}}});return false;},detachVcsRoot:function(b,c,a){if(!confirm(a?a:"Are you sure you want to detach this VCS root?")){return false;}BS.Util.hideSuccessMessages();BS.ajaxRequest(this.url,{parameters:"detachVcsRoot="+b+"&settingsId="+c,onComplete:function(){BS.AdminActions._refreshVcsRoot(b);}});},deleteBuildTrigger:function(c,a,b){if(!confirm("Are you sure you want to delete this trigger?")){return false;}BS.Util.hideSuccessMessages();BS.ajaxRequest(this.url,{parameters:"removeBuildTrigger="+c+"&buildTypeExternalId="+a,onComplete:function(e){var d=BS.XMLResponse.processErrors(e.responseXML,{onBuildTypeNotFoundError:function(f){alert(f.firstChild.nodeValue);},onTriggerNotFoundError:function(f){alert(f.firstChild.nodeValue);}});if(!d){if(b){b();}}}});return false;},deleteUsers:function(d,c){var a="";for(var b=0;b<d.length;b++){a+=d[b]+":";}BS.ajaxRequest(this.url,{parameters:"removeUsers="+a,onComplete:function(){if(c){c();}}});return false;},toggleVcsRootUsages:function(b,c){$j("#"+c+"_usages").toggle();var a=$j(b).parent().toggleClass("usageHl");a.parent().find(".vcsRoot").toggleClass("bold");return false;},_refreshVcsRoot:function(a){$("vcsRootContainer_"+a).refresh("vcsRootProgress_"+a);},_refreshAllRoots:function(){BS.reload(true);},deleteIssueProvider:function(a,b){if(!confirm("Are you sure you want to remove an issue tracker connection?")){return false;}BS.Util.hideSuccessMessages();BS.ajaxRequest(this.url,{parameters:"deleteIssueProvider=1&providerId="+a+"&projectId="+b,onComplete:function(){BS.reload(true);}});},setParametersDescriptorEnabled:function(e,a,b,d,c){if(!b&&!confirm("Are you sure you want to disable the "+d.toLowerCase()+"?")){return;}BS.ajaxRequest(this.url,{parameters:"id="+e+"&setEnabled="+a+"&enabled="+b+"&descriptorName="+d,onSuccess:function(){if(c){c();}else{BS.reload(true);}}});},loadBuildTypes:function(b,d,a){var c=$j(b).closest("tr");BS.ajaxRequest(window["base_uri"]+"/admin/allBuildTypes.html",{parameters:"projectId="+d+"&maxBuildTypes="+a,onComplete:function(e){c.after(e.responseText);c.nextAll().find("td.highlight").each(function(g,f){BS.TableHighlighting.createInitElementFunction.call(this,f);});c.remove();}});return false;},setHealthItemVisibility:function(b,c,e,d,a){if(!d&&!confirm("Are you sure you want to hide this item for all users? It is possible to restore the visibility later under 'Administration > Server Health'.")){return false;}BS.ajaxRequest(this.url,{parameters:"setVisible="+d+"&type="+b+"&categoryId="+c+"&itemId="+e,onComplete:function(){if(a){a();}}});return false;},hideHealthItemFromPopup:function(a,b,c){return BS.AdminActions.setHealthItemVisibility(a,b,c,false,function(){BS.reload(true);});},regenerateAllIds:function(a){BS.RegenerateForm.showDialog(a);return false;},checkCanMove:function(b,c,a){BS.ajaxRequest(this.url,{parameters:"checkCanMove=true&targetId="+b+"&"+c,onComplete:function(h){var k=h.responseXML;var n=[];var o=[];var m=[];if(k){var d=k.getElementsByTagName("vcsRoot");var f=k.getElementsByTagName("template");var g=k.getElementsByTagName("reason");for(var j=0;j<d.length;j++){var l=d[j];n.push(l.getAttribute("name"));}for(j=0;j<f.length;j++){l=f[j];o.push(l.getAttribute("name"));}for(j=0;j<g.length;j++){l=g[j];m.push(l.firstChild.nodeValue);}}if(a){a(n,o,m);}}});return false;},listBranches:function(b,c){var a=b.indexOf("internal:")==0;BS.ajaxRequest(this.url,{parameters:"listBranches=true&"+(a?"internalBuildTypeId="+b.substring("internal:".length):"buildTypeId="+b),onComplete:function(k){var d=k.responseXML;if(d){var j=[];var g=d.getElementsByTagName("branch");for(var f=0;f<g.length;f++){var h=g[f];j.push(h.getAttribute("name"));}if(c){c(j);}}}});},prepareProjectIdGenerator:function(e,c,a,d,b){this._doPrepare("project",e,c,a,d,b);},prepareBuildTypeIdGenerator:function(e,c,a,d,b){this._doPrepare("buildType",e,c,a,d,b);},prepareTemplateIdGenerator:function(e,c,a,d,b){this._doPrepare("template",e,c,a,d,b);},prepareVcsRootIdGenerator:function(e,c,a,d,b){this._doPrepare("vcsRoot",e,c,a,d,b);},prepareCustomIdGenerator:function(a,f,d,b,e,c){this._doPrepare(a,f,d,b,e,c);},_doPrepare:function(g,f,d,a,e,b){var c=this;f=$(f);if(!f){return;}if(!e){f.setAttribute("generated",f.value);c._prepareIdGenerator(g,f,d,a);}else{c._prepareEdit(f,b);c._createRegenerateLink(g,f,d,a);}},_prepareEdit:function(c,b){b=$(b||"changeExternalIdWarning");b=$j(b||"");var a=c.value;$j(c).on("keyup change",function(){if(this.value!=a){b.show();}else{b.hide();}}).attr("originalId",a);},_createRegenerateLink:function(f,e,d,b){var c=this,a=$j(e);$j("<a>",{href:"#","class":"regenerate",title:"Regenerate the ID based on the current name and parent projects' names",click:function(){var g=a.attr("originalId");c._prepareIdGenerator(f,e,d,b,g,true,function(){a.trigger("keyup").focus();});return false;},html:"Regenerate ID",insertAfter:a});},_prepareIdGenerator:function(c,a,i,e,h,d,k){var b=0,j=0;i=$(i);function g(m){try{return m instanceof HTMLElement;}catch(l){return(typeof m==="object")&&(m.nodeType===1)&&(typeof m.style==="object")&&(typeof m.ownerDocument==="object");}}function f(){var n=a.value,m=a.getAttribute("generated"),l=i.value;if(!d){if(n&&n!=m){return;}}function o(p){a.value=p;
a.setAttribute("generated",p);$j(a).trigger("keyup");}if(l){(function(p){var q=g(e)?e.value:e;BS.ajaxRequest(window["base_uri"]+"/generateId.html",{parameters:{object:c,parentId:q,name:l,currentId:h},onComplete:function(r){if(p>=j){j=p;o(r.responseText);k&&k();}}});})(b++);}else{if(n==m){o("");}}}if(!d){$j(i).on("keyup",f);if(g(e)){$j(e).on("change",f);}}f();},prepareSubstitutor:function(e,a,b,c){e=$(e);b=$(b);if(!e||!b){return;}var d=this;d._setParsedData(e,a,c,{});d._fillTextarea(e,b,null);$j(e).on("keyup",function(){d.regenerateAll(a,b,e,true);});},_setParsedData:function(d,a,b){var e=[],c={};this._parsedData=e;e.clash=false;_.each(b,function(h){if(!h||!h.length){return;}var g=h[0],i=h[1],f=h[2];e.push([g,i,f]);if(c[i]){e.clash=true;}c[i]=true;});},_parseTextarea:function(c){var a={},b=c.value.split(/\n/);_.each(b,function(e){if(e&&e[0]!="#"){var d=e.indexOf("=>");if(d>=0){var g=$j.trim(e.substr(0,d)),f=$j.trim(e.substr(d+2));if(g.include(":")){g=g.replace(/:\s+/,":");}a[g]=f;}}});return a;},_fillTextarea:function(d,b,a){if(!a){this._prevFilled={};}var c=this._prevFilled,e=this._parsedData;var f=[];_.each(e,function(l){var j=l[0],m=l[1],g=l[2],i;var k=j+":"+m;var h=e.clash?j+":"+m:m;if(a&&c[k]!=a[h]){i=a[h];}else{i=m;c[k]=i;}f.push(indentString(g)+(e.clash?j+": ":"")+m+" => "+i);});b.value=f.join("\n");},createHiddenMappingIfNecessary:function(c){c=$j(c);var b=$j("textarea",c);var e=this._parsedData;if(!e||e.clash){b.attr("name","mapping");return;}var a=this._parseTextarea(b[0]);var d=[];_.each(e,function(h){var g=h[0],i=h[1],f=a[i];if(f){d.push(g+": "+i+" => "+f);}});$j("<input>",{type:"hidden",name:"mapping",value:d.join("\n"),insertAfter:c});},regenerateAll:function(b,a,g,e){var d=this._prevFilled,h=this._parsedData;var f={};if(e){var c=this._parseTextarea(a);_.each(h,function(l){var j=l[0],m=l[1];var k=j+":"+m;var i=h.clash?j+":"+m:m;if(c&&d[k]!=c[i]){f[i]=true;}});}BS.ajaxRequest(window["base_uri"]+"/admin/regenerate.html",{method:"GET",parameters:{projectId:b,returnDefaults:"true",currentId:$(g).value,forCopy:e},onComplete:function(p){var m=JSON.parse(p.responseText),l=m.project,o=m.vcsRoot,k=m.buildType;if(m.error){$j("#error_newProjectExternalId").html(m.error.escapeHTML());return;}else{$j("#error_newProjectExternalId").html("");}function n(s){if(f[s.trim()]){return null;}if(h.clash){var q=s.indexOf(":"),r=s.substr(0,q).trim(),t=s.substr(q+1).trim();if(r=="project"){return l[t];}else{if(r=="vcsRoot"){return o[t];}else{return k[t];}}}else{t=s.trim();return l[t]||k[t]||o[t];}}a=$(a);var i=[];if(e){var j=a.value.split(/\n/);_.each(j,function(r){var t,s;if(r&&r[0]!="#"){var q=r.indexOf("=>");if(q>=0){t=r.substr(0,q);}}if(t){s=n(t);}if(s){i.push(t+"=> "+s);}else{i.push(r);}});}else{_.each(h,function(t){var s=t[0],u=t[1],q=t[2],r=(s=="project")?l[u]:(s=="vcsRoot")?o[u]:k[u];i.push(indentString(q)+(h.clash?s+": ":"")+u+" => "+r);});}a.value=i.join("\n");_.each(h,function(r){var q=r[0],t=r[1];var s;if(r[0]=="project"){s=l[t];}else{if(r[0]=="vcsRoot"){s=o[t];}else{s=k[t];}}d[q+":"+t]=s;});}});return false;},showOrHideActions:function(a,b){var c=$j(a);c.change(function(){setTimeout(function(){if(c.filter(":checked").length>0){$j(b).show();}else{$j(b).hide();}},100);});}};function indentString(a){return(new Array((parseInt(a,10)||0)+1)).join("  ");}BS.AttachBuildTypeForm=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{setSaving:function(a){if(a){BS.Util.show("attachBuildTypeProgress");}else{BS.Util.hide("attachBuildTypeProgress");}},getContainer:function(){return $("attachBuildTypeFormDialog");},formElement:function(){return $("attachBuildTypeForm");},showDialog:function(a){this.formElement().vcsRootId.value=a;this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));$("chooseBuildTypeSelector").fill(a);BS.jQueryDropdown($("chooseBuildTypeSelector")).ufd("changeOptions");},submit:function(){var a=this.formElement().buildTypeId.selectedIndex;var b=this.formElement().buildTypeId.options[a].value;var c=this.formElement().vcsRootId.value;this.setSaving(true);BS.Util.hideSuccessMessages();BS.ajaxRequest(BS.AdminActions.url,{parameters:"attachVcsRoot="+c+"&buildTypeId="+b,onComplete:function(){BS.AdminActions._refreshVcsRoot(c);BS.AttachBuildTypeForm.setSaving(false);BS.AttachBuildTypeForm.close();}});return false;}}));BS.BaseAssignRoleDialog=OO.extend(BS.AbstractModalDialog,{getFormElement:function(){},getTitle:function(){},show:function(b,a){this.showCentered();this.bindCtrlEnterHandler(this.save.bind(this));this.getFormElement().role.onchange();this._rolesHolderIds=b;this._oncompletefunction=a;$(this.getFormElement().id+"Title").innerHTML=this.getTitle();},_clearAll:function(){var b=this.getFormElement();var a=$j(b.projectId);a.children().remove();$j(b).find(".inplaceFilterDiv").find("input").val("");},save:function(){BS.Util.hideSuccessMessages();if($j("#projectsRow").is(":visible")){var d=false;var b=this.getFormElement().projectId.options;for(var c=0;c<b.length;c++){if(b[c].selected){d=true;}}if(!d){alert("Please select at least one project.");return false;}}if(this.getFormElement().replaceRoles&&this.getFormElement().replaceRoles.checked&&!confirm("Are you sure you want to completely replace all of the current roles with newly selected roles?")){return false;}Form.disable(this.getFormElement());BS.Util.show("savingRole");var a="";for(c=0;c<this._rolesHolderIds.length;c++){a+="&rolesHolderId="+this._rolesHolderIds[c];}var e=this;BS.ajaxRequest(this.getFormElement().action,{parameters:BS.Util.serializeForm(this.getFormElement())+a,onComplete:function(){BS.Util.hide(e.getFormElement().id+"_savingRole");e._oncompletefunction();Form.enable(e.getFormElement());e.close();}});return false;},_projectBasedRoles:{},_roles:{},roleChanged:function(){var b=this.getFormElement().role;var a=b.selectedIndex;var c=b.options[a].value;this.loadProjects(c,this._projectBasedRoles[c]);$(this.getFormElement().id+"_roleName").innerHTML=b.options[a].text;},loadProjects:function(c,a){var e={};var b=this.getFormElement().projectId;while(b.options.length>0){var j=b.options[0].selected;if(j){e[b.options[0].value]=true;}b.options[0]=null;}if(c=="SYSTEM_ADMIN"){$j("#globalText").html("<b>&lt;Root&gt;</b> project");}else{$j("#globalText").html("Global (cannot be associated with any project)");}if(!a){$j("#globalScopeRow").show();$j("#projectsRow").hide();$j("#roleScopeInput").val("global");return;}else{$j("#globalScopeRow").hide();$j("#projectsRow").show();$j("#roleScopeInput").val("perProject");}this._clearAll();var f=this._roles[c].projects;var d=0;for(var g=0;g<f.length;g++){if(f[g].id==""){continue;}var h=new Option(f[g].name,f[g].id,false,e[f[g].id]);h.setAttribute("data-filter-data",f[g].data);h.setAttribute("data-title",f[g].fullName);b.options[d++]=h;b.options[b.options.length-1].className="inplaceFiltered";}BS.InPlaceFilter.prepareFilter(b.id);},showRolesDescription:function(){var a=this.getFormElement().role;var b=a.options[a.selectedIndex].value;var c=window["base_uri"]+"/rolesDescription.html?";for(var d=0;d<a.options.length;d++){c+="role="+a.options[d].value+"&";}c+="#"+b;BS.Util.popupWindow(c,"_blank",{width:550,height:600});}});BS.AssignRoleDialog=OO.extend(BS.BaseAssignRoleDialog,{getContainer:function(){return $("assignRoleDialog");},getFormElement:function(){return $("assignRole");},getProgressIndicator:function(){return $("assignRole_saving");},getTitle:function(){if(this._rolesHolderIds.length>1){return"Assign roles to "+this._rolesHolderIds.length+" users";}return"Assign roles";}});BS.UnassignRoleDialog=OO.extend(BS.BaseAssignRoleDialog,{getContainer:function(){return $("unassignRoleDialog");},getFormElement:function(){return $("unassignRole");},getProgressIndicator:function(){return $("unassignRole_saving");},getTitle:function(){if(this._rolesHolderIds.length>1){return"Unassign roles from "+this._rolesHolderIds.length+" users";}return"Unassign roles";}});BS.UnassignRolesForm=OO.extend(BS.AbstractWebForm,{getFormElement:function(){return $("unassignRolesForm");
},selectAll:function(a){if(a){BS.Util.selectAll(this.getFormElement(),"unassign");}else{BS.Util.unselectAll(this.getFormElement(),"unassign");}},selected:function(){var b=Form.getInputs(this.getFormElement(),"checkbox","unassign");for(var a=0;a<b.length;a++){if(b[a].checked){return true;}}return false;},setSaving:function(a){if(a){BS.Util.show("unassignInProgress");}else{BS.Util.hide("unassignInProgress");}},submit:function(){if(!this.selected()){alert("Please select at least one role.");return false;}if(!confirm("Are you sure you want to unassign selected roles?")){return false;}BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(b,c,a){$("authorityRolesContainer").refresh();}}));return false;}});BS.AvailableParams={url:window["base_uri"]+"/admin/parameterAutocompletion.html",attachPopups:function(d,c){var b=[],a;for(a=1;a<arguments.length;a++){b.push(arguments[a]);}if($j.inArray("buildTypeParams",b)===-1){b.push("buildTypeParams");}$j(document).ready(function(){$j(b).each(function(f,g){var e="."+g+":not(.disableBuildTypeParams):not([type=password])";BS.AvailableParams.attachPopupsTo(d,e);});});},attachPopupsTo:function(e,c){var b=BS.AvailableParams.url+"?"+e;var d=$j(c);var a=function(f){f=$j(f);f.autocomplete({minLength:0,insertItemWithFocus:false,source:BS.AvailableParams.sourceForElement(f,b),select:BS.AvailableParams.selectForElement(f),more:BS.AvailableParams.moreForElement(f,b),completeOnCtrlSpace:true});};d.each(function(){var g=this.parentNode.className;if(g.indexOf("completionIconWrapper")==-1&&g.indexOf("posRel")==-1){var f=$j(this);var h=BS.Util.wrapRelative(f);if(f.prop("style").width=="100%"){h.css("display","block");}}BS.AvailableParams.showCompletionAvailableImage(this);});d.on("focus",function(f){if(!this._autocompleteInited){a(this);this._autocompleteInited=true;}});},sourceForElement:function(b,a){return function(f,e){var d=BS.AvailableParams.sliceForCompletion(b);if(d){b.data("ctrlSpace",false);}else{if(b.data("ctrlSpace")){d=BS.AvailableParams.sliceForCtrlSpaceCompletion(b);}else{if(b.data("showAll")){d=BS.AvailableParams.sliceForShowAllCompletion(b);}}}b.data("sliced_text",d);if(d!==null){var c=BS.AvailableParams.showLoadingImage(b);$j.getJSON(a+"&term="+encodeURIComponent(d.term),null,function(g){BS.Util.fadeOutAndDelete(c);e(g);});}else{e(null);}};},selectForElement:function(a){return function(d,e){var c=a.data("sliced_text");var b=c.before_length+e.item.value.length+1;this.value=c.before+e.item.value+"%"+c.after;BS.AvailableParams.setCursorPosition(a[0],b);return false;};},moreForElement:function(b,a){return function(f,e){var d=b.data("sliced_text");if(d!==null){var c=BS.AvailableParams.showLoadingImage(b);$j.getJSON(a+"&term="+encodeURIComponent(d.term)+"&from="+encodeURIComponent(f),null,function(g){BS.Util.fadeOutAndDelete(c);e(g);});}else{e(null);}};},showCompletionAvailableImage:function(c){if(c.className&&c.className.indexOf("__popupAttached")!=-1){return;}var d=c.id;c.className+=" __popupAttached";c.style.marginRight="20px";var a=this.appendCompletitionImageTo(c.parentNode);var b={updateVisibility:function(){var i=$(d);if(i.disabled||i.readOnly){a.style.visibility="hidden";}else{var h=i.getDimensions(),g=i.getLayout();var f=h.width+5;var k=i.positionedOffset();var e=k[0]+f+g.get("margin-left");var j=k[1]+6+g.get("margin-top");a.style.visibility="visible";BS.Util.place(a,e,j);}}};b.updateVisibility();BS.VisibilityHandlers.attachTo(d,b);},_completionImage:null,appendCompletitionImageTo:function(b){function a(){var d=$j('<span class="paramsPopupHandle"></span>');d.attr({"title":"Parameter references are supported in this field, type % to see available parameters"});d.on("click",function(){$j(this).prevAll("input, textarea").focus().data("showAll",true).autocomplete("search");});return d;}this._completionImage=this._completionImage||a();var c=this._completionImage.clone(true);c.appendTo(b);return c[0];},showLoadingImage:function(c){c=$j(c);var a=c.position();var b=c.attr("id")+"_completion_img";return $j("<i>").attr({id:b,className:"icon-refresh icon-spin"}).css({width:16,height:16,position:"absolute",left:a.left+c.outerWidth(true)-40,top:a.top+2}).insertAfter(c);},getCursorPosition:function(e){var d=document.getElementById(e);var a=d.selectionStart;var f,b,g=0;if(a||a===0){return a;}else{if(document.selection&&document.selection.createRangeCollection){f=document.selection.createRange();if(f===null){return 0;}else{b=f.duplicate();if(d.tagName.toLowerCase()==="textarea"){b.moveToElementText(d);b.setEndPoint("EndToEnd",f);var j=b.text.length-f.text.length;var h=d.value;for(var c=0;c<j;c++){if(h.charAt(c)==="\n"){g++;}}return j-g;}else{a=0-b.moveStart("character",-100000);return a+f.text.length;}}}else{return 0;}}},setCursorPosition:function(c,a){if(c.setSelectionRange){c.focus();c.setSelectionRange(a,a);}else{if(c.createTextRange){var b=c.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",a);b.select();}}},sliceForCompletion:function(c){c=$j(c);var e=c.val(),d=BS.AvailableParams.getCursorPosition(c.attr("id")),g,b,f;f=0;b=-1;for(var a=0;a<d;a++){if(e.charAt(a)==="%"){b=a;f++;}}if(f%2===0){return null;}else{if(b===-1){return null;}else{g=b;return{before:e.slice(0,g+1),before_length:g+1,term:e.slice(g+1,d),after:e.slice(d,e.length)};}}},sliceForCtrlSpaceCompletion:function(b){b=$j(b);var e=b.val(),d=BS.AvailableParams.getCursorPosition(b.attr("id")),a,f;for(a=d-1;a>=0;a--){f=e.charAt(a);if(f===" "||f==="\n"||f==="\t"){a++;break;}}if(a===-1){a=0;}return{before:e.slice(0,a)+"%",before_length:a+1,term:e.slice(a,d),after:e.slice(d,e.length)};},sliceForShowAllCompletion:function(b){b=$j(b);var e=b.val(),d=BS.AvailableParams.getCursorPosition(b.attr("id")),a,f;for(a=d-1;a>=0;a--){f=e.charAt(a);if(f===" "||f==="\n"||f==="\t"){a++;break;}}if(a===-1){a=0;}return{before:e.slice(0,d)+"%",before_length:d,term:"",after:e.slice(d,e.length)};}};BS.ArchiveProjectDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("archiveProjectForm");},getContainer:function(){return $("archiveProjectFormDialog");},archiveText:"Archive",unarchiveText:"Unarchive",showArchiveProjectDialog:function(b,c){var a=this.archiveText;var d="Are you sure you want to archive this project (and its subprojects, if any)?";if(c){BS.Util.show("removeFromQueueDiv");this.formElement().archiveAction.value="archive";}else{BS.Util.hide("removeFromQueueDiv");this.formElement().archiveAction.value="unarchive";d="Are you sure you want to unarchive this project (and its subprojects, if any)?";a=this.unarchiveText;}this.formElement().projectId.value=b;this.formElement().ArchiveSubmitButton.value=a;$("archiveProjectFormTitle").innerHTML=a+" project";$("message").innerHTML=d;this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));},submit:function(){BS.Util.show("archiveProgressIcon");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(b,c,a){BS.Util.hide("archiveProgressIcon");BS.reload(true);},onFailure:function(){BS.Util.hide("archiveProgressIcon");alert("Problem accessing server");}}));return false;}}));;
/*---
/js/bs/runBuild.js
---*/
BS.RunBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{tabs:["general-tab","dependencies-tab","changes-tab","properties-tab","comment-tab"],sectionContent2Header:{customConfigParams:"configurationParametersHeader",customBuildSystemProps:"systemPropertiesHeader",customBuildEnvVars:"environmentVariablesHeader"},newParameterCounter:0,newParameterNumber:0,customControls:{},updateTimer:null,_parameterHighlightStatus:{},getRefreshUrl:function(){return window["base_uri"]+"/runCustomBuild.html";},_customParametersContainerId:"properties-tab",serializeParameters:function(b){b=OO.extend({tabsFilter:function(){return true;},customParameterFilter:function(){return true;},extra:{}},b||{});var e=[];e.push(BS.Util.serializeForm($("runCustomBuildHidden")));for(var c=0;c<this.tabs.length;c++){var a=this.tabs[c];if(!b.tabsFilter(a)){continue;}var d=$(a);if(!d){continue;}if(d.id==this._customParametersContainerId){e.push(this.serializeCustomParameters(b.customParameterFilter));}else{e.push(BS.Util.serializeForm(d));}}e.push(Object.toQueryString(b.extra));return e.filter(function(f){return f&&f.length>0;}).inject("",function(g,f){return g+(g.length>0?"&":"")+f;});},serializeCustomParameters:function(c){var b=this._customParametersContainerId;if(!$(b)){return"";}var a={};for(var i in this.customControls){if(c&&!c(i)){continue;}var g=this.customControls[i];var d=g.getFormSerializeName();try{var h=g.getControlValue();if(h){a[d]=h;}}catch(f){BS.Log.error("Failed to get value of control: "+d+". "+f);}}Form.getElements($(b)).filter(function(e){if(!e||!e.name){return false;}var j=e.name;return j=="name"||j=="value"||j.endsWith(".name")||j.endsWith(".value")||j=="customParameterNames"||j.startsWith("marker_");}).each(function(l){var k=$(l);if(!k){return;}var j=k.name;if(!j){return;}var m=k.getValue();if(m==null||m==undefined){return;}var e=a[j];if(!e){e=[];}e.push(m);a[j]=e;});return Object.toQueryString(a);},getAddControlFunction:function(a,b){var c={id:b,containerId:a,getFormSerializeName:function(){return b;},errorsProcessor:{}};c.getControlValue=function(){var d=$(c.id);if(d==null){return null;}return d.getValue();};BS.RunBuildDialog.customControls[b]=c;return function(d){if(d.getControlValue){c.getControlValue=d.getControlValue.bind(d);}if(d.errorsProcessor){for(var e in d.errorsProcessor){c.errorsProcessor[e]=d.errorsProcessor[e].bind(d.errorsProcessor);}}};},getContainer:function(){return $("runBuildDialog");},formElement:function(){return $("runBuild");},savingIndicator:function(){return $("runBuildProgress");},eachCustomControl:function(b){for(var c in this.customControls){var a=this.customControls[c];b(a);}},setupEventHandlers:function(){var a=this;this.setUpdateStateHandlers({updateState:function(){a.updateParametersState();},saveState:function(){a.submit();}});},updateParametersState:function(){var a=this;var b=this.serializeCustomParameters();if(!b||b.length==0){return;}BS.ajaxRequest(this.formElement().action,{method:"post",parameters:a.serializeParameters({extra:{checkChanged:"true"}}),onComplete:function(j){var c=j.responseXML;if(!c){return;}var h=c.getElementsByTagName("changes");if(h&&h.length==1&&h[0]){var g=h[0].getElementsByTagName("change");var f={};for(var e=0;e<g.length;e++){f[g[e].getAttribute("id")]=true;}for(var d in a.customControls){a.setParameterHighlightStatus(a.customControls[d].containerId,!!f[d]);}}}});},submit:function(){if($j("#customBuild-parameterName").val()){this.addParameter();}this.clearErrors();var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onNo_build_typeError:function(b){alert(b.firstChild.nodeValue);},onInvalid_agentError:function(b){alert(b.firstChild.nodeValue);},onRevisionsNotAvailableError:function(b){alert(b.firstChild.nodeValue);},onAddToQueueErrorError:function(b){alert(b.firstChild.nodeValue);},onInvalidSubmitParametersError:function(b){alert(b.firstChild.nodeValue);},onAutoGeneratedBranchNameError:function(b){if(confirm(b.firstChild.nodeValue)){a.formElement().forceAutoGeneratedBranch.value="true";a.submit();}},onCompleteSave:function(c,l,m){var b=BS.XMLResponse._xmlErrorsXml(l);var e=false;for(var h=0;h<b.length;h++){var n=b[h][0];var d=b[h][1];if(n.indexOf("parameter_")==0){if(n.indexOf("!")>0){e=true;var j=n.split("!");if(j==2){var o=j[0];var f=j[1];var g=a.customControls[o];var k="on"+f+"Error";if(g!=null&&g.errorsProcessor[k]){g.errorsProcessor[k](d);}else{if($(g)){BS.PluginPropertiesForm.showError(g,d);}else{BS.PluginPropertiesForm.showError(o,d);}}}}else{BS.PluginPropertiesForm.showError(n,d);e=true;}}}m=m||e;if(c.isVisible()){c.setSaving(false);c.enable();if(!m){c.close();}}if(e){BS.RunBuildDialog.showTab("properties-tab");}if(m){return;}BS.Hider.hideAll();if(c.formElement().redirectTo.value!=""){document.location.href=c.formElement().redirectTo.value;}}}));return false;},addParameter:function(){var g=$j("#customBuild-paramType").val(),a=$j("#customBuild-parameterName").val(),j=$j("#customBuild-parameterValue").val(),l,d;if(g==="system"){l=$("customBuildSystemProps");}else{if(g==="env"){l=$("customBuildEnvVars");}else{l=$("customConfigParams");g="config";}}d=$j(BS.Util.escapeId(this.sectionContent2Header[l.id]));var e=$("newParamTemplate").firstChild.nodeValue;e=this._replacePattern(e,{"\\[prefix\\]":g+"."});e=this._replacePattern(e,{"\\[id\\]":this.newParameterCounter++});l.insert({bottom:e});this.getTabByElement(l).addClass("modifiedParam");d.show();var b=this._childElements(l);var h=b[b.length-1];var f=this._childElements(h);var i=$(f[0]).firstDescendant();var k=$(f[1]).firstDescendant().firstDescendant();i.value=a;k.value=j;var c=function(m){if(m.keyCode==Event.KEY_RETURN){Event.stop(m);}};i.on("keypress",c.bindAsEventListener(this));BS.VisibilityHandlers.attachTo(k.id,{updateVisibility:function(){jQuery(k).textAreaExpander(0,100,"updateVisibility");}});$j("#customBuild-paramType").val("conf");$j("#customBuild-parameterName").val("").focus();$j("#customBuild-parameterValue").val("");this.newParameterNumber++;this.updateDialog();BS.AvailableParams.attachPopupsTo("settingsId=buildType:"+this.formElement().buildTypeId.value,$j(k));BS.VisibilityHandlers.updateVisibility(this.formElement());},_replacePattern:function(d,c){var a=d;for(var b in c){a=a.replace(new RegExp(b,"g"),c[b]);}return a;},removeParameter:function(a){var b=a.parentNode;b.removeChild(a);if(!$j(b).children().size()){$j(BS.Util.escapeId(this.sectionContent2Header[b.id])).hide();}this.newParameterNumber--;this._parameterHighlightStatus={};this.updateDialog();BS.VisibilityHandlers.updateVisibility(this.formElement());},resetParameter:function(b){var a=this.customControls[b];if(!a){return;}this.flipParameter(b);this.setParameterHighlightStatus(a.containerId,false);},flipParameter:function(e){var d=this.customControls[e];if(!d){return;}var b=this;var c=this.serializeParameters({tabsFilter:function(f){return f==b._customParametersContainerId;},customParameterFilter:function(f){return e==f;},extra:{reset:1,flipControl:e}});var a=$(e).hasClassName("__popupAttached");$("refresh_container_"+e+"_div").refresh(null,c,function(){if(a){BS.VisibilityHandlers.updateVisibility(b.formElement());BS.AvailableParams.attachPopupsTo("settingsId=buildType:"+b.formElement().buildTypeId.value,BS.Util.escapeId(e));}});},setParameterHighlightStatus:function(a,d){if(!a){return;}if(this._parameterHighlightStatus[a]==d){return;}this._parameterHighlightStatus[a]=d;var c=$(a).up("tr");if(d){c.addClassName("modifiedParam");}else{c.removeClassName("modifiedParam");}d|=this.newParameterNumber>0;if(!d){for(var b in this._parameterHighlightStatus){if(this._parameterHighlightStatus[b]){d=true;break;}}}if(d){this.getTabByElement(c).addClass("modifiedParam");}else{this.getTabByElement(c).removeClass("modifiedParam");}},_childElements:function(a){var b=[];for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];if(d.nodeType==1){b.push(d);}}return b;},updateChangesContainer:function(a){BS.RunBuildDialog.disable();
var b=this.serializeParameters({extra:{updateChanges:"true",userAction:"userAction"}});BS.ajaxRequest(this.formElement().action,{parameters:b,onComplete:function(){$("changesContainer").refresh($("changesProgress"),null,function(){BS.RunBuildDialog.enable();});}});},updateComment:function(a){if(a!=null&&a.length>0){this.formElement().buildComment.value=a;}},appendTag:function(a){BS.Util.addWordToTextArea(this.formElement().buildTagsInfo,a);},show:function(){this.propertiesTabInited=false;this._parameterHighlightStatus={};this.newParameterNumber=0;this.showCentered();this.bindCtrlEnterHandler(this.submit.bind(this));$j("#customBuild-parameterName").unbind("keyup").on("keyup",BS.EditParameterDialog.createParamNameChangeHandler($j("#customBuild-parameterName"),$j("#customBuild-paramType")));$j("#customBuild-parameterName").placeholder({text:"&lt;Name>"});$j("#customBuild-parameterValue").placeholder({text:"&lt;Value>"});BS.VisibilityHandlers.attachTo("customBuild-parameterName",{updateVisibility:function(){$j("#customBuild-parameterName").placeholder("refresh");}});BS.VisibilityHandlers.attachTo("customBuild-parameterValue",{updateVisibility:function(){$j("#customBuild-parameterValue").placeholder("refresh");}});var a=BS.EditParameterDialog.createParamTypeChangeHandler($j("#customBuild-paramType"),$j("#customBuild-parameterName"));var b=function(){a();$j("#customBuild-parameterName").placeholder("refresh");};$j("#customBuild-paramType").off("change").on("change",b).off("keyup").on("keyup",function(c){if(BS.EditParameterDialog.canChangeSelectValue(c)){b();}});this.setupEventHandlers();BS.VisibilityHandlers.updateVisibility(this.formElement());},highlightCustomAgent:function(a){var b=jQuery(a).parents("td");this._toggleHighlight(b,true);},highlightArtifactDep:function(a,c){var d=a.options[a.selectedIndex].value!=c;var b=jQuery(a).parent().parent("tr");this._toggleHighlight(b,d);},highlightChanges:function(a){var b=jQuery(a).parents("td");this._toggleHighlight(b,true);},_toggleHighlight:function(b,a){if(a){b.addClass("modifiedParam");}else{b.removeClass("modifiedParam");}},afterClose:function(){this._detachVisibilityHandlers();if(this.updateTimer){clearTimeout(this.updateTimer);}},_detachVisibilityHandlers:function(){$j(this.getContainer()).find("textarea").each(function(b,a){if(a.id){BS.VisibilityHandlers.detachFrom(a.id);}});BS.VisibilityHandlers.detachFrom("customBuild-parameterName");BS.VisibilityHandlers.detachFrom("customBuild-parameterValue");},showTab:function(c){var a=this.tabs.indexOf(c);if(a<0||!$(this.tabs[a])){return false;}for(var d=0;d<this.tabs.length;++d){if(this.tabs[d]!=c){jQuery(BS.Util.escapeId(this.tabs[d])).hide();}}jQuery(BS.Util.escapeId(c)).show();jQuery("#runCustomBuildDiv ul li").removeClass("selected");jQuery("#runCustomBuildDiv ul li#tab-"+a).addClass("selected");BS.VisibilityHandlers.updateVisibility("runCustomBuildDiv");this.recenterDialog();var b=this;window.setTimeout(function(){if(c=="properties-tab"&&!b.propertiesTabInited){BS.AvailableParams.attachPopups("settingsId=buildType:"+b.formElement().buildTypeId.value);b.propertiesTabInited=true;}},0);return false;},getTabByElement:function(b){var d=jQuery(b).parentsUntil("#runCustomBuildContentDiv .tabContent").parent();var c=d.attr("id");var a={"general-tab":"#tab-0","dependencies-tab":"#tab-1","changes-tab":"#tab-2","properties-tab":"#tab-3","comment-tab":"#tab-4"}[c];return jQuery(a);},highlightTabOnShow:function(){var a=this;jQuery("#runCustomBuildDiv .modifiedParam").each(function(){a.getTabByElement(this).addClass("modifiedParam");});}}));BS.RunBuild={progressMessage:"Adding to queue...",_options:function(a){var b={buildTypeId:null,redirectTo:"",redirectToQueuedBuild:"false",branchName:null,afterTrigger:null,modificationId:null,dependOnPromotionIds:null,isCustomRunDialogForRunButton:false,init:false,stateKey:"",queryString:function(){var c="";if(this.redirectTo!=null){c+="&redirectTo="+encodeURIComponent(this.redirectTo);}if(this.modificationId!=null){c+="&modificationId="+this.modificationId;}if(this.branchName!=null){c+="&branchName="+encodeURIComponent(this.branchName);if(this.branchName!="<default>"){this.stateKey=this.stateKey+"_"+encodeURIComponent(this.branchName);}}if(this.dependOnPromotionIds!=null){c+="&dependOnPromotionIds="+this.dependOnPromotionIds;}if(this.isCustomRunDialogForRunButton){c+="&customRunDialogForRunButton=true";}if(this.init){c+="&init=1";}if(this.stateKey!=""){c+="&stateKey="+this.stateKey;}return c;},afterShowDialog:function(){if(this.modificationId!=null&&this.modificationId>0){BS.RunBuildDialog.showTab("changes-tab");}else{BS.RunBuildDialog.showTab("properties-tab");}}};return OO.extend(b,a||{});},runOnAgent:function(c,a,b){var d=this._options(b);BS.ProgressPopup.showProgress(c,this.progressMessage,{shift:{x:-65,y:20},zIndex:100});BS.ajaxRequest(window["base_uri"]+"/ajax.html",{parameters:"add2Queue="+a+"&validate=true"+d.queryString(),onComplete:function(e){BS.RunBuild.onComplete(c,a,d,e);}});},runCustomBuild:function(a,b){var c=this._options(b);c.afterShowDialog=function(){};this._runCustomBuildImpl(a,c);},onComplete:function(c,i,j,b){BS.ProgressPopup.hidePopup(0,true);if(BS.EventTracker){BS.EventTracker.checkEvents();}var d=this;var f=BS.XMLResponse.processErrors(b.responseXML,{action_showRunCustomBuildDialog:function(){var k=d._options(j);k.isCustomRunDialogForRunButton=true;k.afterShowDialog=d._options().afterShowDialog;BS.RunBuild._runCustomBuildImpl(i,k);}},function(l,k){BS.WarningPopup.showWarning(c,{x:-250,y:20},k.firstChild.nodeValue);});var h=b.responseXML.documentElement;if(h!=null){var g=h.getElementsByTagName("queuedBuilds");if(g&&g.length>0){var a=g.item(0).getElementsByTagName("queuedBuild");if(a&&a.length==1){var e=a.item(0).getAttribute("itemId");}}}if(!f){if(j.redirectToQueuedBuild&&e){document.location.href=window["base_uri"]+"/viewQueued.html?itemId="+e;}else{if(j.redirectTo&&j.redirectTo.length>0){document.location.href=j.redirectTo;}else{if(j.afterTrigger){j.afterTrigger();}}}}},_runCustomBuildImpl:function(a,c){$j("#runBuildTitle").html("Run Custom Build");var b=$j("#runBuild .modalDialogBody");b.html(BS.loadingIcon+"&nbsp;Loading...");var d=BS.RunBuildDialog;d.showCentered();BS.ajaxUpdater(b[0],d.getRefreshUrl(),{method:"get",evalScripts:true,parameters:"buildTypeId="+a+c.queryString(),onComplete:function(){d.show();c.afterShowDialog();}});},setTitleSuffix:function(a){$("runBuildTitle").innerHTML+=a;}};BS.PromoteBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("promoteBuildDialog");},formElement:function(){return $("promoteBuild");},showDialog:function(a){$("promoteBuildDialogContent").innerHTML="";this.showCentered();BS.Util.show("promoteBuildDialogContentProgress");BS.ajaxUpdater("promoteBuildDialogContent",window["base_uri"]+"/promoteBuildDialog.html",{method:"get",evalScripts:true,parameters:"buildId="+a,onComplete:function(){BS.Util.hide("promoteBuildDialogContentProgress");BS.PromoteBuildDialog.recenterDialog();}});}}));;
/*---
/js/bs/stopBuild.js
---*/
if(BS.AbstractModalDialog&&BS.AbstractWebForm){BS.StopBuildDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{operationKind:0,formElement:function(){return $("stopBuildForm");},getContainer:function(){return $("stopBuildFormDialog");},handleBuildNotFound:function(){$j("#removeQueuedBuildComment").hide();$j("#submitRemoveQueuedBuild").hide();this.refreshPageAfterClose=true;},afterClose:function(){if(this.refreshPageAfterClose){this.refreshPageAfterClose=false;$j("#removeQueuedBuildComment").show();$j("#submitRemoveQueuedBuild").show();$j("#moreToStopFragment").hide();BS.reload(true);}},showStopBuildDialog:function(d,b,a,e){if(d.length==0){alert("Please select at least one build.");return;}this.enable();this.operationKind=a;this.formElement().operationKind.value=a;this.formElement().kill.value=d.join(",");if(!!e&&$(e)){$("moreToStopRetryNotice").innerHTML=$(e).innerHTML;BS.Util.show($("moreToStopRetryNotice"));}else{$("moreToStopRetryNotice").innerHTML="";BS.Util.hide($("moreToStopRetryNotice"));}switch(a){case 1:var c=d.length>1?d.length+" builds":"build";$("stopBuildFormTitle").innerHTML="Remove "+c+" from the queue";this.formElement().submit.value="Remove";break;case 2:$("stopBuildFormTitle").innerHTML="Stop running build";this.formElement().submit.value="Stop";break;case 3:$("stopBuildFormTitle").innerHTML="Remove this build";this.formElement().submit.value="Remove";break;}$("moreToStopFragment").innerHTML="";$("moreToStop").style.display="none";if(d.length==1){$("moreToStop").style.display="block";$("moreToStopLoader").style.display="inline";this.disable();BS.ajaxUpdater("moreToStopFragment",window["base_uri"]+"/promotionGraph.html",{parameters:"buildPromotionId="+new String(d[0])+"&jsp=moreToStop.jsp"+"&operationKind="+a,evalScripts:true,onComplete:function(){$("moreToStop").style.display="none";if(a==3){$j("#reAddSection").hide();}BS.StopBuildDialog.initSelectAll();BS.StopBuildDialog.enable();}});}this.formElement().comment.value=b!=null&&b.length>0?b:this.formElement().comment.defaultValue;this.showCentered();$(this.formElement().comment).activate();this.bindCtrlEnterHandler(this.killBuild.bind(this));this.setSaving(false);},savingIndicator:function(){return $("stopBuildIndicator");},killBuild:function(c){if(c){this.formElement().kill.value=c;}if(this.formElement().comment.value==this.formElement().comment.defaultValue){this.formElement().comment.value="";}if(this.isVisible()){this.setSaving(true);this.disable();}var a=this;BS.ajaxRequest(this.formElement().action,{parameters:this.serializeParameters(),onSuccess:function(f){if(a.isVisible()){a.setSaving(false);a.enable();a.close();}var l=BS.Util.documentRoot(f);switch(a.operationKind){case 1:var h=l.getElementsByTagName("unqueuedBuild");if(h&&BS.Queue){for(var g=0;g<h.length;g++){var j=h[g].firstChild.nodeValue;BS.Queue.removeBuildTypeRow(j);}}break;case 2:var e=l.getElementsByTagName("stoppedBuild");if(e){for(var g=0;g<e.length;g++){var m=e[g].firstChild.nodeValue;a.setStopping(m);}}break;case 3:var k=l.getElementsByTagName("bt")[0].firstChild.nodeValue;var d=window["base_uri"]+"/viewType.html?buildTypeId="+k;window.location=d;break;}if(BS.EventTracker){BS.EventTracker.checkEvents();}},onFailure:function(){if(a.isVisible()){a.setSaving(false);a.enable();}alert("Sorry, error accessing the server");}});var b=(this.operationKind==3);if(!b){this.close();}if(BS.QueuedBuildsPopup&&BS.QueuedBuildsPopup.isShown()){BS.QueuedBuildsPopup.hidePopup();}return false;},setStopping:function(b){var a=function(d){var c=$("stopBuild:"+b+":link");if(c){c.innerHTML=d;c.addClassName("stopping");}};a('<span class="stopping">Stopping</span>');if($("stopBuild:"+b+":message")){$("stopBuild:"+b+":message").innerHTML="This build has already been stopped by <em>you</em>";}setTimeout(function(){a('<span class="stopping" title="TeamCity cannot stop this build. Please log in to the build agent and resolve the situation manually.">Cannot stop</span>');},5*60*1000);},initSelectAll:function(){var a=$j("#moreToStopFragment input[name='kill']");$j("#killAll").change(function(){var b=this.checked;a.each(function(){this.checked=b;});});}}));};
/*---
/js/bs/customControl.js
---*/
BS.CustomControl={AbstractControl:{getControlValue:function(){throw"Not Implemented";},errorsProcessor:{onComplexError:function(a){}}}};;
/*---
/js/bs/parameters.js
---*/
BS.TypedParameters={};BS.TypedParameters.create=function(){return{containerId:"contextId",submitUrl:"",components:{},extra:{},AbstractControl:OO.extend(BS.CustomControl.AbstractControl,{}),AbstractSubmitResult:{},register:function(b){var a=OO.extend(this.AbstractControl,{id:b,getControlValue:function(){var c=$(a.id);if(c==null){return null;}return c.getValue();}});this.components[b]=a;return function(c){if(c.getControlValue){a.getControlValue=c.getControlValue.bind(c);}if(c.errorsProcessor){for(var d in c.errorsProcessor){a.errorsProcessor[d]=c.errorsProcessor[d].bind(c.errorsProcessor);}}};},getInternalValues:function(){var a={};for(var c in this.components){var b=this.components[c];a["custom_control:"+c]=b.getControlValue();}return a;},AbstractSubmitValuesParameters:{onComplete:function(a){},onError:function(a){},onFailure:function(){}},getSubmitValues:function(c){var b=this;var a=OO.extend(this.getInternalValues(),{contextId:b.containerId});c=OO.extend(this.AbstractSubmitValuesParameters,c);BS.ajaxRequest(b.submitUrl,{method:"post",parameters:Object.toQueryString(a),onComplete:function(d){c.onComplete(d.responseJSON);},onFailure:function(){c.onFailure();},onException:function(f,d){c.onError(d);}});},AbstractErrorInfo:{"some_control_id":{"mainError":"text","errors":{"k":"v"}}},updateErrors:function(b){var a=false;for(var e in this.components){var c=b[e];var d=this.components[e];if(c){a=true;this.showControlError(e,d,c);}else{this.hideControlError(e);}}return a;},hideErrors:function(){for(var a in this.components){this.hideControlError(a);}},_controlErrorElements:function(b,a){$j("#"+b+"_container span.error").each(a);},showControlError:function(c,b,a){if(a.mainError){this._controlErrorElements(c,function(){$j(this).text(a.mainError);});}},hideControlError:function(a){this._controlErrorElements(a,function(){$j(this).html("");});},createFormSaver:function(a){var c=this;if(!a){a=BS.PasswordFormSaver;}var b=a.save.bind(a);return OO.extend(a,{save:function(e,h,f,d){var g=this;if(!_.any(c.components)){b.apply(g,[e,h,f,d]);return;}f.onBeginSave(e);c.getSubmitValues({onComplete:function(m){if($("submitBuildType").value!="storeInSession"){c.hideErrors();var r=c.updateErrors(m.errors);if(r){f.onCompleteSave(e,$j("<empty/>"),true,"custom controls save");return;}}var l=e.serializeParameters();var p={};var o=false;for(var n in m.nameToValues){o=true;if(!m.encryptedNames[n]){p["prop:"+n]=m.nameToValues[n];}else{p["prop:encrypted:"+n]=m.nameToValues[n];}}if(!o){f.onCompleteSave(e,$j("<empty/>"),true,"custom controls save");BS.reload(true);return;}var q=Object.toQueryString(p);var i=l+"&"+q;var j=OO.extend(f,{onBeginSave:function(){}});var s=OO.extend(e,{serializeParameters:function(){return i;}});b.apply(g,[s,h,j,d]);},onError:function(i){f.onError(e,i);},onFailure:function(){f.onFailure(e);}});}});}};};;
/*---
/js/bs/editParameters.js
---*/
BS.BaseSaveParameterListener=OO.extend(BS.SaveConfigurationListener,{onBeginSave:function(a){a.formElement().parameterName.value=BS.Util.trimSpaces(a.formElement().parameterName.value);a.clearErrors();a.hideSuccessMessages();a.disable();a.setSaving(true);}});BS.EditParameterForm=OO.extend(BS.AbstractWebForm,{setSaving:function(a){if(a){BS.Util.show("userParamsSaving");}else{BS.Util.hide("userParamsSaving");}},formElement:function(){return $("editParamForm");},saveParameter:function(){this.formElement().submitAction.value="updateParameter";var a=this;BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.BaseSaveParameterListener,{onEmptyParameterNameError:function(b){$("error_parameterName").innerHTML=b.firstChild.nodeValue.escapeHTML();a.highlightErrorField($("parameterName"));},onParameterSpecError:function(b){$("error_parameterSpec").innerHTML=b.firstChild.nodeValue.escapeHTML();a.highlightErrorField($("parameterSpec"));},onParameterValueError:function(b){$("error_parameterValue").innerHTML=b.firstChild.nodeValue.escapeHTML();a.highlightErrorField($("parameterValue"));},onCompleteSave:function(c,d,b){BS.ErrorsAwareListener.onCompleteSave(c,d,b);c.enable();if(!b){a.updateParamLists();BS.EditParameterDialog.close();}}}));return false;},doRemoveParameter:function(b,d){var c=this;var a=this.formElement().action+"&submitBuildType=1&submitAction=removeParameter&removedPropertyId="+b+"&paramType="+d;BS.ajaxRequest(a,{onComplete:function(){c.updateParamLists();BS.EditParameterDialog.close();}});},removeParameter:function(a,b){if(!confirm("Are you sure you want to delete this parameter?")){return;}this.doRemoveParameter(a,b);},resetParameter:function(a,b){if(!confirm("Are you sure you want to reset this parameter to default value?")){return;}this.doRemoveParameter(a,b);},updateParamLists:function(){BS.reload(true);}});BS.EditParameterDialog=OO.extend(BS.AbstractModalDialog,{getContainer:function(){return $("editParamFormDialog");},showSpecEditFields:function(b,a){if(b){BS.Util.hide("parameterSpecHolderExpand");BS.Util.show("parameterSpecHolderEdit");}else{BS.Util.show("parameterSpecHolderExpand");BS.Util.hide("parameterSpecHolderEdit");}if(a){this.updateVisibilityHandlers();}},showDialog:function(c,e,a,f,d,k){BS.EditParameterForm.clearErrors();var b=c.firstChild?c.firstChild.nodeValue:"";var i=e.firstChild?e.firstChild.nodeValue:"";var j=k.firstChild?k.firstChild.nodeValue:"";var g=b.length==0;var h=function(l){l=l.replace(/##10##/g,"\n");l=l.replace(/##13##/g,"\r");return l;};i=h(i);j=h(j);$("currentName").value=b;$("parameterName").value=b;$("currentNameWithPrefix").value=b;$("paramType").value=a;$("parameterSpec").value=j;$("editParamFormTitle").innerHTML=g?"Add New Parameter":"Edit Parameter";this.showSpecEditFields(j.length>0);this.showCentered();$("parameterValue").value=i;this.bindCtrlEnterHandler(function(){BS.EditParameterForm.saveParameter();});if(f){Form.Element.disable($("parameterName"));Form.Element.disable($("parameterSpec"));Form.Element.disable($("editParameterSpec"));$("inheritedParamName").show();$("parameterValue").focus();}else{if(d){Form.Element.disable($("parameterName"));Form.Element.enable($("parameterSpec"));Form.Element.enable($("editParameterSpec"));$("parameterValue").focus();}else{if(!g){Form.Element.enable($("parameterName"));Form.Element.enable($("parameterSpec"));Form.Element.enable($("editParameterSpec"));$("parameterValue").focus();}else{Form.Element.enable($("parameterName"));Form.Element.enable($("parameterSpec"));Form.Element.enable($("editParameterSpec"));$("inheritedParamName").hide();$("parameterName").focus();}}}this.updateVisibilityHandlers();},updateVisibilityHandlers:function(){BS.VisibilityHandlers.updateVisibility(this.getContainer());},cancelDialog:function(){this.close();},completionItemSelected:function(c,d){var b=$j(this).data("sliced_text");var a=b.before_length+d.item.value.length+1;this.value=b.before+d.item.value+"%"+b.after;if(!BS.Browser.msie){$j("#parameterValue").attr({selectionStart:a,selectionEnd:a});}return false;},paramNameChangeHandler:function(b){var d=$j("#parameterName").val(),c=d.slice(0,4),a;if(c==="env."){$j("#paramType").val("env");}else{a=d.slice(0,7);if(a==="system."){$j("#paramType").val("system");}else{$j("#paramType").val("conf");}}},removeSystemPrefix:function(a){if(a.length>=7&&a.substring(0,7)==="system."){return a.substring(7);}else{return a;}},removeEnvPrefix:function(a){if(a.length>=4&&a.substring(0,4)==="env."){return a.substring(4);}else{return a;}},removeSystemAndEnvPrefixes:function(a){if(a.length>=7&&a.substring(0,7)==="system."){return BS.EditParameterDialog.removeSystemAndEnvPrefixes(a.substring(7));}else{if(a.length>=4&&a.substring(0,4)==="env."){return BS.EditParameterDialog.removeSystemAndEnvPrefixes(a.substring(4));}else{return a;}}},removePrefixes:function(a,b){if(a==="system"){return BS.EditParameterDialog.removeEnvPrefix(b);}else{if(a==="env"){return BS.EditParameterDialog.removeSystemPrefix(b);}else{return BS.EditParameterDialog.removeSystemAndEnvPrefixes(b);}}},paramTypeChangedHandler:function(){var a=$j("#parameterName"),d=$j("#paramType").val(),c=a.val();var b=BS.EditParameterDialog.removePrefixes(d,c);b=BS.EditParameterDialog.addTypePrefixMaybe(d,b);if(c!=b){a.val(b);}},createParamTypeChangeHandler:function(a,b){return function(){var e=$j(a).val(),d=$j(b).val(),c=BS.AvailableParams.getCursorPosition($j(b).attr("id"));d=BS.EditParameterDialog.removePrefixes(e,d);d=BS.EditParameterDialog.addTypePrefixMaybe(e,d);$j(b).val(d);BS.AvailableParams.setCursorPosition($j(b).get(0),c);};},createParamNameChangeHandler:function(b,a){return function(e){var g=b.val(),c=g.length,f,d;if(c<4){a.val("conf").trigger("change");}else{f=g.slice(0,4);if(f==="env."){a.val("env").trigger("change");}else{if(c<7){a.val("conf").trigger("change");}else{d=g.slice(0,7);if(d==="system."){a.val("system").trigger("change");}else{a.val("conf").trigger("change");}}}}};},splitAt:function(b,a){return{prefix:b.slice(0,a),suffix:b.slice(a+1,b.length)};},addTypePrefixMaybe:function(b,a){if(this.hasTypePrefix(b,a)){return a;}else{return b+"."+a;}},hasTypePrefix:function(a,b){return a==="conf"||b.substring(0,a.length+1)===a+".";},canChangeSelectValue:function(a){return a.keyCode===$j.ui.keyCode.UP||a.keyCode===$j.ui.keyCode.DOWN||a.keyCode===$j.ui.keyCode.PAGE_UP||a.keyCode===$j.ui.keyCode.PAGE_DOWN||a.keyCode===$j.ui.keyCode.HOME||a.keyCode===$j.ui.keyCode.END||a.keyCode===67||a.keyCode===69||a.keyCode===83;}});BS.EditParametersSpecDialog=OO.extend(BS.AbstractWebForm,OO.extend(BS.AbstractModalDialog,{formElement:function(){return $("parameterSpecEditForm");},getContainer:function(){return $("parameterSpecEditFormDialog");},showDialog:function(a){var b=this;$("error_parameterSpec").update("");BS.Util.show("parameterSpecEditFormContentLoading");BS.ajaxUpdater("parameterSpecEditFormContent",this.formElement().action,{method:"get",evalScripts:true,parameters:{spec:encodeURIComponent(a),init:1},onComplete:function(f){BS.Util.hide("parameterSpecEditFormContentLoading");var e=f.responseXML;if(e){var d=false;var c=function(g){$("error_parameterSpec").update(g.escapeHTML());d=true;};BS.XMLResponse.processErrors(e,{onSPEC_ERRORError:function(){c("Failed to parse parameter specification");},onUNKNOWN_TYPEError:function(){c("Unknown parameter type");},onNO_EDITORError:function(){c("Specified parameter type does not support edit");}});if(d){return;}}b.initializeParameterEdit();b.showCentered();b.bindCtrlEnterHandler(b.submitDialog.bind(b));BS.Util.reenableForm(b.formElement());b.updateSelectedType();BS.VisibilityHandlers.updateVisibility(b.formElement());BS.MultilineProperties.updateVisible();}});return false;},updateSelectedType:function(){var d=this;var b=$("specParameterTypeChooser").value;var a="type="+b;var c=(b=="");var e=$j("#parameterSpecEditFormContent .runnerFormTable").first();$("parameterSpecEditFormSubmit").disabled=c;$("parameterSpecEditFormSubmit").title=c?"Select parameter type":"";$("specParameterEditorContainer").refresh(null,a,function(){d.showCentered();
BS.VisibilityHandlers.updateVisibility(d.formElement());BS.MultilineProperties.updateVisible();});},initializeParameterEdit:function(){jQuery("#specParameterTypeChooser").change(this.updateSelectedType.bind(this));},closeDialog:function(){this.close();},submitDialog:function(){var a=this;BS.Util.show("parameterSpecEditFormSaving");BS.FormSaver.save(this,this.formElement().action,OO.extend(BS.ErrorsAwareListener,{onCompleteSave:function(e,f,d){BS.Util.hide("parameterSpecEditFormSaving");var c=BS.XMLResponse.processErrors(f,{},BS.PluginPropertiesForm.propertiesErrorsHandler);BS.ErrorsAwareListener.onCompleteSave(e,f,d);if(c){BS.Util.reenableForm(a.formElement());return;}var b=f.getElementsByTagName("paramter-spec")[0].getAttribute("spec");if(b){$("parameterSpec").value=b;BS.EditParameterDialog.showSpecEditFields(true);BS.EditParameterDialog.updateVisibilityHandlers();}e.close();}}));return false;}}));;
/*---
/js/bs/branch.js
---*/
BS.Branch={WILDCARD_NAME:"__all_branches__",DEFAULT_NAME:"<default>",baseUrl:null,_branches:{},makeDropdown:function(f,g,b,k,c,m){var h=$j("<select class='branchNameSelector' id='"+b+"'/>").prop("disabled",!g),d=(m||{})["tab"],a,l=["buildTypeStatusDiv","buildTypeChains","buildTypeHistoryList","buildTypeChangeLog","buildTypeIssueLog","projectBuildChains","testDetails"];if(!m.wildcardDisplayName){a=l.indexOf(d)>-1?"&lt;All branches&gt;":"&lt;Active branches&gt;";}else{a=m.wildcardDisplayName;}this._addOption(h,a,this.WILDCARD_NAME,f);this._addOption(h,"&lt;Default branch&gt;",this.DEFAULT_NAME,f);var e,j;if(k){j=this._addOptionGroup(h,"Active branches");for(e=0;e<k.length;++e){this._addBranchOption(j,k[e],f);}}if(c){if(k){j=this._addOptionGroup(h,"Inactive branches");}else{j=h;}for(e=0;e<c.length;++e){this._addBranchOption(j,c[e],f);}}return h;},addChangeHandler:function(a,c){var d=this,b=c.projectId,e=c.projectExternalId;a.change(function(){var g=$j(this).find("option:selected").val();var f=BS.Branch._getUrl(window.location.href,g,e);if(g!=BS.Branch.WILDCARD_NAME){f=f.replace(/tab=buildTypeBranches/g,"tab=buildTypeStatusDiv");}if(c.save){BS.User.setProperty("ui.overview.branch."+b,g,{afterComplete:function(){d.registerProjectBranch(e,g);BS.Projects.updateProjectView(b,e,c.isFirst,true);}});}else{window.location.href=f;}});},installDropdownToBreadcrumb:function(g,b,c,e,a){var f=$j("#tabsContainer3");var d=$j("#branchNameSelector");if(!f.length||d.length){return;}this.registerProjectBranch(a.projectExternalId,g);var h=this.makeDropdown(g,b,"branchNameSelector",c,e,a);this.addChangeHandler(h,a);d=$j("<p class='branchNameSelector'/>").append(h).wrap("<li/>").parent();f.addClass("simpleTabsWithSelector").find("ul.tabs").prepend(d);if(document.documentElement.className.indexOf("ua-ie")>-1){$j(document).ready(function(){BS.jQueryDropdown(h,{skin:"popup"});});}else{BS.jQueryDropdown(h,{skin:"popup"});}this.injectBranchParamToLinks(f,a.projectExternalId);},registerProjectBranch:function(a,b){this._branches[a]=b;},installDropDownToProjectPane:function(g,e,c,d,b){g=$j(g);var f="branchNameSelector"+b.projectId;var a=this.makeDropdown(e,true,f,c,d,b);this.registerProjectBranch(b.projectExternalId,e);b.save=true;this.addChangeHandler(a,b);g.append(a);BS.jQueryDropdown(a,{skin:"popup",propagateTrigger:false});g.width(a.parent().outerWidth());},_addBranchOption:function(a,b,c){this._addOption(a,b.escapeHTML(),b,c);},_addOption:function(a,b,d,c){$j("<option/>").val(d).append(b).prop("selected",c==d).appendTo(a);},_addOptionGroup:function(a,b){return $j("<optgroup/>").attr("label",b).appendTo(a);},injectBranchParamToLinks:function(a,d){var b=this.getBranchFromUrl(d);if(b==null){return;}var c=this;a.find("a").each(function(){var f=this;var e=f.href;if(!e||e.startsWith("#")||e.startsWith("javascript:")){return;}if(e.indexOf("tab=buildTypeBranches")>=0){return;}if(e.indexOf("viewType.html")>=0||e.indexOf("project.html")>=0){f.href=c._getUrl(e,b,d);}});},setLink:function(d,a,e,c){if(d.getAttribute("href")=="#"){var b=this.baseUrl;if(!b){b=window["base_uri"]+"/viewType.html?buildTypeId="+a;}d.setAttribute("href",this._getUrl(b,c,e));}},_getUrl:function(a,b,f){var c=a.indexOf("?")>=0?a.toQueryParams():{};for(var d in c){if(d.indexOf("branch_")!=-1){delete c[d];}}c["branch_"+f]=b;var e=a.indexOf("?")>=0?a.substring(0,a.indexOf("?")+1):a+"?";return e+Object.toQueryString(c);},getBranchFromUrl:function(a){return this._branches[a];},addBranchToParams:function(b,c){var a=this.getBranchFromUrl(c);if(a){b["branch_"+c]=a;}},getAllBranchesFromUrl:function(){var a={};for(var b in this._branches){a["branch_"+b]=this._branches[b];}return a;},isCustomBranch:function(a){return a&&!(a==this.WILDCARD_NAME||a==this.DEFAULT_NAME);}};;