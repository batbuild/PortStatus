
/*---
/js/behaviour.js
---*/
var Behaviour={list:new Array,register:function(a){Behaviour.list.push(a);},start:function(){Behaviour.addLoadEvent(function(){Behaviour.apply();});},apply:function(){Behaviour.applyOnce(Behaviour.list);},applyOnce:function(k){var d;for(var f=0;d=k[f];f++){for(var a in d){var g=document.getElementsBySelector(a);if(!g){continue;}var c;var b;for(b=0;c=g[b];b++){try{d[a](c);}catch(j){}}}}},addLoadEvent:function(a){document.observe("dom:loaded",a);}};Behaviour.start();function getAllChildren(a){return a.all?a.all:a.getElementsByTagName("*");}document.getElementsBySelector=function(v){if(!document.getElementsByTagName){return new Array();}var p=v.split(" ");var f=new Array(document);for(var x=0;x<p.length;x++){var l=p[x].replace(/^\s+/,"").replace(/\s+$/,"");if(l.indexOf("#")>-1){var s=l.split("#");var d=s[0];var r=s[1];var b=document.getElementById(r);if(!b){continue;}if(d&&b.nodeName.toLowerCase()!=d){return new Array();}f=new Array(b);continue;}if(l.indexOf(".")>-1){var s=l.split(".");var d=s[0];var c=s[1];if(!d){d="*";}var m=new Array;var g=0;for(var y=0;y<f.length;y++){var n;if(d=="*"){n=getAllChildren(f[y]);}else{n=f[y].getElementsByTagName(d);}for(var u=0;u<n.length;u++){m[g++]=n[u];}}f=new Array;var q=0;for(var t=0;t<m.length;t++){if(m[t].className&&m[t].className.match(new RegExp("\\b"+c+"\\b"))){f[q++]=m[t];}}continue;}if(l.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){var d=RegExp.$1;var w=RegExp.$2;var a=RegExp.$3;var o=RegExp.$4;if(!d){d="*";}var m=new Array;var g=0;for(var y=0;y<f.length;y++){var n;if(d=="*"){n=getAllChildren(f[y]);}else{n=f[y].getElementsByTagName(d);}for(var u=0;u<n.length;u++){m[g++]=n[u];}}f=new Array;var q=0;var e;switch(a){case"=":e=function(h){return(h.getAttribute(w)==o);};break;case"~":e=function(h){return(h.getAttribute(w).match(new RegExp("\\b"+o+"\\b")));};break;case"|":e=function(h){return(h.getAttribute(w).match(new RegExp("^"+o+"-?")));};break;case"^":e=function(h){return(h.getAttribute(w).indexOf(o)==0);};break;case"$":e=function(h){return(h.getAttribute(w).lastIndexOf(o)==h.getAttribute(w).length-o.length);};break;case"*":e=function(h){return(h.getAttribute(w).indexOf(o)>-1);};break;default:e=function(h){return h.getAttribute(w);};}f=new Array;var q=0;for(var t=0;t<m.length;t++){if(e(m[t])){f[q++]=m[t];}}continue;}if(!f[0]){return;}d=l;var m=new Array;var g=0;for(var y=0;y<f.length;y++){var n=f[y].getElementsByTagName(d);for(var u=0;u<n.length;u++){m[g++]=n[u];}}f=m;}return f;};;
/*---
/js/underscore-min.js
---*/
(function(){var Q=this,J=Q._,L=Array.prototype,Z=Object.prototype,H=Function.prototype,V=L.push,ad=L.slice,P=L.concat,S=Z.toString,ab=Z.hasOwnProperty,Y=Array.isArray,K=Object.keys,N=H.bind,W=function(a){return a instanceof W?a:this instanceof W?void (this._wrapped=a):new W(a);};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=W),exports._=W):Q._=W,W.VERSION="1.7.0";var X=function(c,a,b){if(a===void 0){return c;}switch(null==b?3:b){case 1:return function(d){return c.call(a,d);};case 2:return function(d,f){return c.call(a,d,f);};case 3:return function(f,g,d){return c.call(a,f,g,d);};case 4:return function(g,h,d,f){return c.call(a,g,h,d,f);};}return function(){return c.apply(a,arguments);};};W.iteratee=function(c,a,b){return null==c?W.identity:W.isFunction(c)?X(c,a,b):W.isObject(c)?W.matches(c):W.property(c);},W.each=W.forEach=function(g,c,d){if(null==g){return g;}c=X(c,d);var f,a=g.length;if(a===+a){for(f=0;a>f;f++){c(g[f],f,g);}}else{var b=W.keys(g);for(f=0,a=b.length;a>f;f++){c(g[b[f]],b[f],g);}}return g;},W.map=W.collect=function(k,f,g){if(null==k){return[];}f=W.iteratee(f,g);for(var h,c=k.length!==+k.length&&W.keys(k),d=(c||k).length,b=Array(d),j=0;d>j;j++){h=c?c[j]:j,b[j]=f(k[h],h,k);}return b;};var D="Reduce of empty array with no initial value";W.reduce=W.foldl=W.inject=function(k,f,g,h){null==k&&(k=[]),f=X(f,h,4);var c,d=k.length!==+k.length&&W.keys(k),b=(d||k).length,j=0;if(arguments.length<3){if(!b){throw new TypeError(D);}g=k[d?d[j++]:j++];}for(;b>j;j++){c=d?d[j]:j,g=f(g,k[c],c,k);}return g;},W.reduceRight=W.foldr=function(j,f,g,h){null==j&&(j=[]),f=X(f,h,4);var c,d=j.length!==+j.length&&W.keys(j),b=(d||j).length;if(arguments.length<3){if(!b){throw new TypeError(D);}g=j[d?d[--b]:--b];}for(;b--;){c=d?d[b]:b,g=f(g,j[c],c,j);}return g;},W.find=W.detect=function(d,a,b){var c;return a=W.iteratee(a,b),W.some(d,function(g,f,e){return a(g,f,e)?(c=g,!0):void 0;}),c;},W.filter=W.select=function(d,a,b){var c=[];return null==d?c:(a=W.iteratee(a,b),W.each(d,function(g,f,e){a(g,f,e)&&c.push(g);}),c);},W.reject=function(c,a,b){return W.filter(c,W.negate(W.iteratee(a)),b);},W.every=W.all=function(j,f,g){if(null==j){return !0;}f=W.iteratee(f,g);var h,c,d=j.length!==+j.length&&W.keys(j),b=(d||j).length;for(h=0;b>h;h++){if(c=d?d[h]:h,!f(j[c],c,j)){return !1;}}return !0;},W.some=W.any=function(j,f,g){if(null==j){return !1;}f=W.iteratee(f,g);var h,c,d=j.length!==+j.length&&W.keys(j),b=(d||j).length;for(h=0;b>h;h++){if(c=d?d[h]:h,f(j[c],c,j)){return !0;}}return !1;},W.contains=W.include=function(b,a){return null==b?!1:(b.length!==+b.length&&(b=W.values(b)),W.indexOf(b,a)>=0);},W.invoke=function(d,a){var b=ad.call(arguments,2),c=W.isFunction(a);return W.map(d,function(e){return(c?a:e[a]).apply(e,b);});},W.pluck=function(b,a){return W.map(b,W.property(a));},W.where=function(b,a){return W.filter(b,W.matches(a));},W.findWhere=function(b,a){return W.find(b,W.matches(a));},W.max=function(d,m,b){var h,k,g=-1/0,j=-1/0;if(null==m&&null!=d){d=d.length===+d.length?d:W.values(d);for(var c=0,f=d.length;f>c;c++){h=d[c],h>g&&(g=h);}}else{m=W.iteratee(m,b),W.each(d,function(l,a,i){k=m(l,a,i),(k>j||k===-1/0&&g===-1/0)&&(g=l,j=k);});}return g;},W.min=function(d,m,b){var h,k,g=1/0,j=1/0;if(null==m&&null!=d){d=d.length===+d.length?d:W.values(d);for(var c=0,f=d.length;f>c;c++){h=d[c],g>h&&(g=h);}}else{m=W.iteratee(m,b),W.each(d,function(l,a,i){k=m(l,a,i),(j>k||1/0===k&&1/0===g)&&(g=l,j=k);});}return g;},W.shuffle=function(g){for(var c,d=g&&g.length===+g.length?g:W.values(g),f=d.length,a=Array(f),b=0;f>b;b++){c=W.random(0,b),c!==b&&(a[b]=a[c]),a[c]=d[b];}return a;},W.sample=function(c,a,b){return null==a||b?(c.length!==+c.length&&(c=W.values(c)),c[W.random(c.length-1)]):W.shuffle(c).slice(0,Math.max(0,a));},W.sortBy=function(c,a,b){return a=W.iteratee(a,b),W.pluck(W.map(c,function(g,d,f){return{value:g,index:d,criteria:a(g,d,f)};}).sort(function(h,d){var f=h.criteria,g=d.criteria;if(f!==g){if(f>g||f===void 0){return 1;}if(g>f||g===void 0){return -1;}}return h.index-d.index;}),"value");};var R=function(a){return function(c,d,f){var b={};return d=W.iteratee(d,f),W.each(c,function(j,h){var g=d(j,h,c);a(b,j,g);}),b;};};W.groupBy=R(function(c,a,b){W.has(c,b)?c[b].push(a):c[b]=[a];}),W.indexBy=R(function(c,a,b){c[b]=a;}),W.countBy=R(function(c,a,b){W.has(c,b)?c[b]++:c[b]=1;}),W.sortedIndex=function(k,f,g,h){g=W.iteratee(g,h,1);for(var c=g(f),d=0,b=k.length;b>d;){var j=d+b>>>1;g(k[j])<c?d=j+1:b=j;}return d;},W.toArray=function(a){return a?W.isArray(a)?ad.call(a):a.length===+a.length?W.map(a,W.identity):W.values(a):[];},W.size=function(a){return null==a?0:a.length===+a.length?a.length:W.keys(a).length;},W.partition=function(f,b,c){b=W.iteratee(b,c);var d=[],a=[];return W.each(f,function(h,g,e){(b(h,g,e)?d:a).push(h);}),[d,a];},W.first=W.head=W.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:0>a?[]:ad.call(c,0,a);},W.initial=function(c,a,b){return ad.call(c,0,Math.max(0,c.length-(null==a||b?1:a)));},W.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:ad.call(c,Math.max(c.length-a,0));},W.rest=W.tail=W.drop=function(c,a,b){return ad.call(c,null==a||b?1:a);},W.compact=function(a){return W.filter(a,W.identity);};var z=function(i,f,g,h){if(f&&W.every(i,W.isArray)){return P.apply(h,i);}for(var d=0,c=i.length;c>d;d++){var b=i[d];W.isArray(b)||W.isArguments(b)?f?V.apply(h,b):z(b,f,g,h):g||h.push(b);}return h;};W.flatten=function(b,a){return z(b,a,!1,[]);},W.without=function(a){return W.difference(a,ad.call(arguments,1));},W.uniq=W.unique=function(f,s,b,j){if(null==f){return[];}W.isBoolean(s)||(j=b,b=s,s=!1),null!=b&&(b=W.iteratee(b,j));for(var p=[],h=[],m=0,d=f.length;d>m;m++){var g=f[m];if(s){m&&h===g||p.push(g),h=g;}else{if(b){var k=b(g,m,f);W.indexOf(h,k)<0&&(h.push(k),p.push(g));}else{W.indexOf(p,g)<0&&p.push(g);}}}return p;},W.union=function(){return W.uniq(z(arguments,!0,!0,[]));},W.intersection=function(j){if(null==j){return[];}for(var f=[],g=arguments.length,h=0,c=j.length;c>h;h++){var d=j[h];if(!W.contains(f,d)){for(var b=1;g>b&&W.contains(arguments[b],d);b++){}b===g&&f.push(d);}}return f;},W.difference=function(b){var a=z(ad.call(arguments,1),!0,!0,[]);return W.filter(b,function(c){return !W.contains(a,c);});},W.zip=function(d){if(null==d){return[];}for(var a=W.max(arguments,"length").length,b=Array(a),c=0;a>c;c++){b[c]=W.pluck(arguments,c);}return b;},W.object=function(f,b){if(null==f){return{};}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1];}return c;},W.indexOf=function(f,b,c){if(null==f){return -1;}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=W.sortedIndex(f,b),f[d]===b?d:-1;}d=0>c?Math.max(0,a+c):c;}for(;a>d;d++){if(f[d]===b){return d;}}return -1;},W.lastIndexOf=function(d,a,b){if(null==d){return -1;}var c=d.length;for("number"==typeof b&&(c=0>b?c+b+1:Math.min(c,b+1));--c>=0;){if(d[c]===a){return c;}}return -1;},W.range=function(g,c,d){arguments.length<=1&&(c=g||0,g=0),d=d||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=Array(f),b=0;f>b;b++,g+=d){a[b]=g;}return a;};var aa=function(){};W.bind=function(d,a){var b,c;if(N&&d.bind===N){return N.apply(d,ad.call(arguments,1));}if(!W.isFunction(d)){throw new TypeError("Bind must be called on a function");}return b=ad.call(arguments,2),c=function(){if(!(this instanceof c)){return d.apply(a,b.concat(ad.call(arguments)));}aa.prototype=d.prototype;var e=new aa;aa.prototype=null;var f=d.apply(e,b.concat(ad.call(arguments)));return W.isObject(f)?f:e;};},W.partial=function(b){var a=ad.call(arguments,1);return function(){for(var f=0,g=a.slice(),c=0,d=g.length;d>c;c++){g[c]===W&&(g[c]=arguments[f++]);}for(;f<arguments.length;){g.push(arguments[f++]);}return b.apply(this,g);};},W.bindAll=function(d){var a,b,c=arguments.length;if(1>=c){throw new Error("bindAll must be passed function names");}for(a=1;c>a;a++){b=arguments[a],d[b]=W.bind(d[b],d);}return d;},W.memoize=function(c,a){var b=function(g){var d=b.cache,f=a?a.apply(this,arguments):g;return W.has(d,f)||(d[f]=c.apply(this,arguments)),d[f];
};return b.cache={},b;},W.delay=function(c,a){var b=ad.call(arguments,2);return setTimeout(function(){return c.apply(null,b);},a);},W.defer=function(a){return W.delay.apply(W,[a,1].concat(ad.call(arguments,1)));},W.throttle=function(d,m,b){var h,k,g,j=null,c=0;b||(b={});var f=function(){c=b.leading===!1?0:W.now(),j=null,g=d.apply(h,k),j||(h=k=null);};return function(){var e=W.now();c||b.leading!==!1||(c=e);var a=m-(e-c);return h=this,k=arguments,0>=a||a>m?(clearTimeout(j),j=null,c=e,g=d.apply(h,k),j||(h=k=null)):j||b.trailing===!1||(j=setTimeout(f,a)),g;};},W.debounce=function(d,m,b){var h,k,g,j,c,f=function(){var a=W.now()-j;m>a&&a>0?h=setTimeout(f,m-a):(h=null,b||(c=d.apply(g,k),h||(g=k=null)));};return function(){g=this,k=arguments,j=W.now();var a=b&&!h;return h||(h=setTimeout(f,m)),a&&(c=d.apply(g,k),g=k=null),c;};},W.wrap=function(b,a){return W.partial(a,b);},W.negate=function(a){return function(){return !a.apply(this,arguments);};},W.compose=function(){var b=arguments,a=b.length-1;return function(){for(var c=a,d=b[a].apply(this,arguments);c--;){d=b[c].call(this,d);}return d;};},W.after=function(b,a){return function(){return --b<1?a.apply(this,arguments):void 0;};},W.before=function(c,a){var b;return function(){return --c>0?b=a.apply(this,arguments):a=null,b;};},W.once=W.partial(W.before,2),W.keys=function(c){if(!W.isObject(c)){return[];}if(K){return K(c);}var a=[];for(var b in c){W.has(c,b)&&a.push(b);}return a;},W.values=function(f){for(var b=W.keys(f),c=b.length,d=Array(c),a=0;c>a;a++){d[a]=f[b[a]];}return d;},W.pairs=function(f){for(var b=W.keys(f),c=b.length,d=Array(c),a=0;c>a;a++){d[a]=[b[a],f[b[a]]];}return d;},W.invert=function(f){for(var b={},c=W.keys(f),d=0,a=c.length;a>d;d++){b[f[c[d]]]=c[d];}return b;},W.functions=W.methods=function(c){var a=[];for(var b in c){W.isFunction(c[b])&&a.push(b);}return a.sort();},W.extend=function(f){if(!W.isObject(f)){return f;}for(var b,c,d=1,a=arguments.length;a>d;d++){b=arguments[d];for(c in b){ab.call(b,c)&&(f[c]=b[c]);}}return f;},W.pick=function(b,o,a){var j,m={};if(null==b){return m;}if(W.isFunction(o)){o=X(o,a);for(j in b){var g=b[j];o(g,j,b)&&(m[j]=g);}}else{var d=P.apply([],ad.call(arguments,1));b=new Object(b);for(var k=0,h=d.length;h>k;k++){j=d[k],j in b&&(m[j]=b[j]);}}return m;},W.omit=function(d,a,b){if(W.isFunction(a)){a=W.negate(a);}else{var c=W.map(P.apply([],ad.call(arguments,1)),String);a=function(f,e){return !W.contains(c,e);};}return W.pick(d,a,b);},W.defaults=function(f){if(!W.isObject(f)){return f;}for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var a in d){f[a]===void 0&&(f[a]=d[a]);}}return f;},W.clone=function(a){return W.isObject(a)?W.isArray(a)?a.slice():W.extend({},a):a;},W.tap=function(b,a){return a(b),b;};var ac=function(h,x,b,l){if(h===x){return 0!==h||1/h===1/x;}if(null==h||null==x){return h===x;}h instanceof W&&(h=h._wrapped),x instanceof W&&(x=x._wrapped);var w=S.call(h);if(w!==S.call(x)){return !1;}switch(w){case"[object RegExp]":case"[object String]":return""+h==""+x;case"[object Number]":return +h!==+h?+x!==+x:0===+h?1/+h===1/x:+h===+x;case"[object Date]":case"[object Boolean]":return +h===+x;}if("object"!=typeof h||"object"!=typeof x){return !1;}for(var j=b.length;j--;){if(b[j]===h){return l[j]===x;}}var v=h.constructor,g=x.constructor;if(v!==g&&"constructor" in h&&"constructor" in x&&!(W.isFunction(v)&&v instanceof v&&W.isFunction(g)&&g instanceof g)){return !1;}b.push(h),l.push(x);var m,k;if("[object Array]"===w){if(m=h.length,k=m===x.length){for(;m--&&(k=ac(h[m],x[m],b,l));){}}}else{var y,d=W.keys(h);if(m=d.length,k=W.keys(x).length===m){for(;m--&&(y=d[m],k=W.has(x,y)&&ac(h[y],x[y],b,l));){}}}return b.pop(),l.pop(),k;};W.isEqual=function(b,a){return ac(b,a,[],[]);},W.isEmpty=function(b){if(null==b){return !0;}if(W.isArray(b)||W.isString(b)||W.isArguments(b)){return 0===b.length;}for(var a in b){if(W.has(b,a)){return !1;}}return !0;},W.isElement=function(a){return !(!a||1!==a.nodeType);},W.isArray=Y||function(a){return"[object Array]"===S.call(a);},W.isObject=function(b){var a=typeof b;return"function"===a||"object"===a&&!!b;},W.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){W["is"+a]=function(b){return S.call(b)==="[object "+a+"]";};}),W.isArguments(arguments)||(W.isArguments=function(a){return W.has(a,"callee");}),"function"!=typeof/./&&(W.isFunction=function(a){return"function"==typeof a||!1;}),W.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a));},W.isNaN=function(a){return W.isNumber(a)&&a!==+a;},W.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===S.call(a);},W.isNull=function(a){return null===a;},W.isUndefined=function(a){return a===void 0;},W.has=function(b,a){return null!=b&&ab.call(b,a);},W.noConflict=function(){return Q._=J,this;},W.identity=function(a){return a;},W.constant=function(a){return function(){return a;};},W.noop=function(){},W.property=function(a){return function(b){return b[a];};},W.matches=function(c){var a=W.pairs(c),b=a.length;return function(h){if(null==h){return !b;}h=new Object(h);for(var g=0;b>g;g++){var d=a[g],f=d[0];if(d[1]!==h[f]||!(f in h)){return !1;}}return !0;};},W.times=function(f,b,c){var d=Array(Math.max(0,f));b=X(b,c,1);for(var a=0;f>a;a++){d[a]=b(a);}return d;},W.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1));},W.now=Date.now||function(){return(new Date).getTime();};var ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},C=W.invert(ae),U=function(f){var b=function(e){return f[e];},c="(?:"+W.keys(f).join("|")+")",d=RegExp(c),a=RegExp(c,"g");return function(e){return e=null==e?"":""+e,d.test(e)?e.replace(a,b):e;};};W.escape=U(ae),W.unescape=U(C),W.result=function(c,a){if(null==c){return void 0;}var b=c[a];return W.isFunction(b)?c[a]():b;};var B=0;W.uniqueId=function(b){var a=++B+"";return b?b+a:a;},W.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,T={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,G=function(a){return"\\"+T[a];};W.template=function(f,s,b){!s&&b&&(s=b),s=W.defaults({},s,W.templateSettings);var j=RegExp([(s.escape||M).source,(s.interpolate||M).source,(s.evaluate||M).source].join("|")+"|$","g"),p=0,h="__p+='";f.replace(j,function(i,l,n,c,u){return h+=f.slice(p,u).replace(q,G),p=u+i.length,l?h+="'+\n((__t=("+l+"))==null?'':_.escape(__t))+\n'":n?h+="'+\n((__t=("+n+"))==null?'':__t)+\n'":c&&(h+="';\n"+c+"\n__p+='"),i;}),h+="';\n",s.variable||(h="with(obj||{}){\n"+h+"}\n"),h="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{var m=new Function(s.variable||"obj","_",h);}catch(d){throw d.source=h,d;}var g=function(a){return m.call(this,a,W);},k=s.variable||"obj";return g.source="function("+k+"){\n"+h+"}",g;},W.chain=function(b){var a=W(b);return a._chain=!0,a;};var I=function(a){return this._chain?W(a).chain():a;};W.mixin=function(a){W.each(W.functions(a),function(b){var c=W[b]=a[b];W.prototype[b]=function(){var d=[this._wrapped];return V.apply(d,arguments),I.call(this,c.apply(W,d));};});},W.mixin(W),W.each(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=L[b];W.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!==b&&"splice"!==b||0!==c.length||delete c[0],I.call(this,c);};}),W.each(["concat","join","slice"],function(b){var a=L[b];W.prototype[b]=function(){return I.call(this,a.apply(this._wrapped,arguments));};}),W.prototype.value=function(){return this._wrapped;},"function"==typeof define&&define.amd&&define("underscore",[],function(){return W;});}).call(this);;
/*---
/js/atmosphere-2.2.7.js
---*/
(function(a,b){if(typeof define==="function"&&define.amd){define(b);}else{a.atmosphere=b();}}(this,function(){var c="2.2.7-javascript",a={},e,d=false,h=[],g=[],f=0,b=Object.prototype.hasOwnProperty;a={onError:function(i){},onClose:function(i){},onOpen:function(i){},onReopen:function(i){},onMessage:function(i){},onReconnect:function(j,i){},onMessagePublished:function(i){},onTransportFailure:function(j,i){},onLocalMessage:function(i){},onFailureToReconnect:function(j,i){},onClientTimeout:function(i){},onOpenAfterResume:function(i){},WebsocketApiAdapter:function(j){var i,k;j.onMessage=function(l){k.onmessage({data:l.responseBody});};j.onMessagePublished=function(l){k.onmessage({data:l.responseBody});};j.onOpen=function(l){k.onopen(l);};k={close:function(){i.close();},send:function(l){i.push(l);},onmessage:function(l){},onopen:function(l){},onclose:function(l){},onerror:function(l){}};i=new a.subscribe(j);return k;},AtmosphereRequest:function(ad){var q={timeout:300000,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:true,maxRequest:-1,reconnect:true,maxStreamingLength:10000000,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:false,rewriteURL:false,attachHeadersAsQueryString:true,executeCallbackBeforeReconnect:false,readyState:0,withCredentials:false,trackMessageLength:false,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropHeaders:true,uuid:0,async:true,shared:false,readResponsesHeaders:false,maxReconnectOnClose:5,enableProtocol:true,pollingInterval:0,heartbeat:{client:null,server:null},ackInterval:0,closeAsync:false,reconnectOnServerError:true,onError:function(aI){},onClose:function(aI){},onOpen:function(aI){},onMessage:function(aI){},onReopen:function(aJ,aI){},onReconnect:function(aJ,aI){},onMessagePublished:function(aI){},onTransportFailure:function(aJ,aI){},onLocalMessage:function(aI){},onFailureToReconnect:function(aJ,aI){},onClientTimeout:function(aI){},onOpenAfterResume:function(aI){}};var ar={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:false,closedByClientTimeout:false,ffTryingReconnect:false};var aw=null;var ag=null;var A=null;var o=null;var Y=null;var v=true;var ay=0;var K=0;var ak=" ";var aG=false;var R=null;var i;var ax=null;var S=a.util.now();var z;var aF;ao(ad);function aj(){v=true;aG=false;ay=0;aw=null;ag=null;A=null;o=null;}function V(){m();aj();}function x(aI){if(aI=="debug"){return q.logLevel==="debug";}else{if(aI=="info"){return q.logLevel==="info"||q.logLevel==="debug";}else{if(aI=="warn"){return q.logLevel==="warn"||q.logLevel==="info"||q.logLevel==="debug";}else{if(aI=="error"){return q.logLevel==="error"||q.logLevel==="warn"||q.logLevel==="info"||q.logLevel==="debug";}else{return false;}}}}}function aH(aI){if(x("debug")){a.util.debug(new Date()+" Atmosphere: "+aI);}}function J(aJ,aI){if(ar.partialMessage===""&&(aI.transport==="streaming")&&(aJ.responseText.length>aI.maxStreamingLength)){return true;}return false;}function E(){if(q.enableProtocol&&!q.firstMessage){var aK="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+q.uuid;a.util.each(q.headers,function(aM,aO){var aN=a.util.isFunction(aO)?aO.call(this,q,q,ar):aO;if(aN!=null){aK+="&"+encodeURIComponent(aM)+"="+encodeURIComponent(aN);}});var aI=q.url.replace(/([?&])_=[^&]*/,aK);aI=aI+(aI===q.url?(/\?/.test(q.url)?"&":"?")+aK:"");var aJ={connected:false};var aL=new a.AtmosphereRequest(aJ);aL.attachHeadersAsQueryString=false;aL.dropHeaders=true;aL.url=aI;aL.contentType="text/plain";aL.transport="polling";aL.method="GET";aL.data="";if(q.enableXDR){aL.enableXDR=q.enableXDR;}aL.async=q.closeAsync;am("",aL);}}function I(){if(x("debug")){a.util.debug("Closing");}aG=true;if(q.reconnectId){clearTimeout(q.reconnectId);delete q.reconnectId;}if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer);}q.reconnect=false;ar.request=q;ar.state="unsubscribe";ar.responseBody="";ar.status=408;ar.partialMessage="";ai();E();m();}function m(){ar.partialMessage="";if(q.id){clearTimeout(q.id);}if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer);}if(o!=null){o.close();o=null;}if(Y!=null){Y.abort();Y=null;}if(A!=null){A.abort();A=null;}if(aw!=null){if(aw.canSendMessage){aw.close();}aw=null;}if(ag!=null){ag.close();ag=null;}ah();}function ah(){if(i!=null){clearInterval(z);document.cookie=aF+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";i.signal("close",{reason:"",heir:!aG?S:(i.get("children")||[])[0]});i.close();}if(ax!=null){ax.close();}}function ao(aI){V();q=a.util.extend(q,aI);q.mrequest=q.reconnect;if(!q.reconnect){q.reconnect=true;}}function au(){return q.webSocketImpl!=null||window.WebSocket||window.MozWebSocket;}function at(){var aJ=a.util.getAbsoluteURL(q.url.toLowerCase());var aK=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(aJ);var aI=!!(aK&&(aK[1]!=window.location.protocol||aK[2]!=window.location.hostname||(aK[3]||(aK[1]==="http:"?80:443))!=(window.location.port||(window.location.protocol==="http:"?80:443))));return window.EventSource&&(!aI||!a.util.browser.safari||a.util.browser.vmajor>=7);}function aa(){if(q.shared){ax=aD(q);if(ax!=null){if(x("debug")){a.util.debug("Storage service available. All communication will be local");}if(ax.open(q)){return;}}if(x("debug")){a.util.debug("No Storage service available.");}ax=null;}q.firstMessage=f==0?true:false;q.isOpen=false;q.ctime=a.util.now();if(q.uuid===0){q.uuid=f;}ar.closedByClientTimeout=false;if(q.transport!=="websocket"&&q.transport!=="sse"){M(q);}else{if(q.transport==="websocket"){if(!au()){az("Websocket is not supported, using request.fallbackTransport ("+q.fallbackTransport+")");}else{af(false);}}else{if(q.transport==="sse"){if(!at()){az("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+q.fallbackTransport+")");}else{D(false);}}}}}function aD(aM){var aN,aL,aQ,aI="atmosphere-"+aM.url,aJ={storage:function(){function aR(aV){if(aV.key===aI&&aV.newValue){aK(aV.newValue);}}if(!a.util.storage){return;}var aU=window.localStorage,aS=function(aV){return a.util.parseJSON(aU.getItem(aI+"-"+aV));},aT=function(aV,aW){aU.setItem(aI+"-"+aV,a.util.stringifyJSON(aW));};return{init:function(){aT("children",aS("children").concat([S]));a.util.on(window,"storage",aR);return aS("opened");},signal:function(aV,aW){aU.setItem(aI,a.util.stringifyJSON({target:"p",type:aV,data:aW}));},close:function(){var aV=aS("children");a.util.off(window,"storage",aR);if(aV){if(aO(aV,aM.id)){aT("children",aV);}}}};},windowref:function(){var aR=window.open("",aI.replace(/\W/g,""));if(!aR||aR.closed||!aR.callbacks){return;}return{init:function(){aR.callbacks.push(aK);aR.children.push(S);return aR.opened;},signal:function(aS,aT){if(!aR.closed&&aR.fire){aR.fire(a.util.stringifyJSON({target:"p",type:aS,data:aT}));}},close:function(){if(!aQ){aO(aR.callbacks,aK);aO(aR.children,S);}}};}};function aO(aU,aT){var aR,aS=aU.length;for(aR=0;aR<aS;aR++){if(aU[aR]===aT){aU.splice(aR,1);}}return aS!==aU.length;}function aK(aR){var aT=a.util.parseJSON(aR),aS=aT.data;if(aT.target==="c"){switch(aT.type){case"open":W("opening","local",q);break;case"close":if(!aQ){aQ=true;if(aS.reason==="aborted"){I();}else{if(aS.heir===S){aa();}else{setTimeout(function(){aa();},100);}}}break;case"message":l(aS,"messageReceived",200,aM.transport);break;case"localMessage":G(aS);break;}}}function aP(){var aR=new RegExp("(?:^|; )("+encodeURIComponent(aI)+")=([^;]*)").exec(document.cookie);if(aR){return a.util.parseJSON(decodeURIComponent(aR[2]));}}aN=aP();if(!aN||a.util.now()-aN.ts>1000){return;}aL=aJ.storage()||aJ.windowref();if(!aL){return;}return{open:function(){var aR;z=setInterval(function(){var aS=aN;aN=aP();if(!aN||aS.ts===aN.ts){aK(a.util.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:aS.heir}}));}},1000);aR=aL.init();if(aR){setTimeout(function(){W("opening","local",aM);
},50);}return aR;},send:function(aR){aL.signal("send",aR);},localSend:function(aR){aL.signal("localSend",a.util.stringifyJSON({id:S,event:aR}));},close:function(){if(!aG){clearInterval(z);aL.signal("close");aL.close();}}};}function aE(){var aJ,aI="atmosphere-"+q.url,aN={storage:function(){function aO(aQ){if(aQ.key===aI&&aQ.newValue){aK(aQ.newValue);}}if(!a.util.storage){return;}var aP=window.localStorage;return{init:function(){a.util.on(window,"storage",aO);},signal:function(aQ,aR){aP.setItem(aI,a.util.stringifyJSON({target:"c",type:aQ,data:aR}));},get:function(aQ){return a.util.parseJSON(aP.getItem(aI+"-"+aQ));},set:function(aQ,aR){aP.setItem(aI+"-"+aQ,a.util.stringifyJSON(aR));},close:function(){a.util.off(window,"storage",aO);aP.removeItem(aI);aP.removeItem(aI+"-opened");aP.removeItem(aI+"-children");}};},windowref:function(){var aP=aI.replace(/\W/g,""),aO=document.getElementById(aP),aQ;if(!aO){aO=document.createElement("div");aO.id=aP;aO.style.display="none";aO.innerHTML='<iframe name="'+aP+'" />';document.body.appendChild(aO);}aQ=aO.firstChild.contentWindow;return{init:function(){aQ.callbacks=[aK];aQ.fire=function(aR){var aS;for(aS=0;aS<aQ.callbacks.length;aS++){aQ.callbacks[aS](aR);}};},signal:function(aR,aS){if(!aQ.closed&&aQ.fire){aQ.fire(a.util.stringifyJSON({target:"c",type:aR,data:aS}));}},get:function(aR){return !aQ.closed?aQ[aR]:null;},set:function(aR,aS){if(!aQ.closed){aQ[aR]=aS;}},close:function(){}};}};function aK(aO){var aQ=a.util.parseJSON(aO),aP=aQ.data;if(aQ.target==="p"){switch(aQ.type){case"send":u(aP);break;case"localSend":G(aP);break;case"close":I();break;}}}R=function aM(aO){aJ.signal("message",aO);};function aL(){document.cookie=aF+"="+encodeURIComponent(a.util.stringifyJSON({ts:a.util.now()+1,heir:(aJ.get("children")||[])[0]}))+"; path=/";}aJ=aN.storage()||aN.windowref();aJ.init();if(x("debug")){a.util.debug("Installed StorageService "+aJ);}aJ.set("children",[]);if(aJ.get("opened")!=null&&!aJ.get("opened")){aJ.set("opened",false);}aF=encodeURIComponent(aI);aL();z=setInterval(aL,1000);i=aJ;}function W(aK,aN,aJ){if(q.shared&&aN!=="local"){aE();}if(i!=null){i.set("opened",true);}aJ.close=function(){I();};if(ay>0&&aK==="re-connecting"){aJ.isReopen=true;r(ar);}else{if(ar.error==null){ar.request=aJ;var aL=ar.state;ar.state=aK;var aI=ar.transport;ar.transport=aN;var aM=ar.responseBody;ai();ar.responseBody=aM;ar.state=aL;ar.transport=aI;}}}function aB(aK){aK.transport="jsonp";var aJ=q,aI;if((aK!=null)&&(typeof(aK)!=="undefined")){aJ=aK;}Y={open:function(){var aN="atmosphere"+(++S);function aL(){aJ.lastIndex=0;if(aJ.openId){clearTimeout(aJ.openId);}if(aJ.heartbeatTimer){clearTimeout(aJ.heartbeatTimer);}if(aJ.reconnect&&ay++<aJ.maxReconnectOnClose){W("re-connecting",aJ.transport,aJ);an(Y,aJ,aK.reconnectInterval);aJ.openId=setTimeout(function(){Z(aJ);},aJ.reconnectInterval+1000);}else{U(0,"maxReconnectOnClose reached");}}function aM(){var aO=aJ.url;if(aJ.dispatchUrl!=null){aO+=aJ.dispatchUrl;}var aQ=aJ.data;if(aJ.attachHeadersAsQueryString){aO=p(aJ);if(aQ!==""){aO+="&X-Atmosphere-Post-Body="+encodeURIComponent(aQ);}aQ="";}var aP=document.head||document.getElementsByTagName("head")[0]||document.documentElement;aI=document.createElement("script");aI.src=aO+"&jsonpTransport="+aN;aI.clean=function(){aI.clean=aI.onerror=aI.onload=aI.onreadystatechange=null;if(aI.parentNode){aI.parentNode.removeChild(aI);}if(++aK.scriptCount===2){aK.scriptCount=1;aL();}};aI.onload=aI.onreadystatechange=function(){aH("jsonp.onload");if(!aI.readyState||/loaded|complete/.test(aI.readyState)){aI.clean();}};aI.onerror=function(){aH("jsonp.onerror");aK.scriptCount=1;aI.clean();};aP.insertBefore(aI,aP.firstChild);}window[aN]=function(aQ){aH("jsonp.window");aK.scriptCount=0;if(aJ.reconnect&&aJ.maxRequest===-1||aJ.requestCount++<aJ.maxRequest){if(!aJ.executeCallbackBeforeReconnect){an(Y,aJ,aJ.pollingInterval);}if(aQ!=null&&typeof aQ!=="string"){try{aQ=aQ.message;}catch(aP){}}var aO=s(aQ,aJ,ar);if(!aO){l(ar.responseBody,"messageReceived",200,aJ.transport);}if(aJ.executeCallbackBeforeReconnect){an(Y,aJ,aJ.pollingInterval);}k(aJ);}else{a.util.log(q.logLevel,["JSONP reconnect maximum try reached "+q.requestCount]);U(0,"maxRequest reached");}};setTimeout(function(){aM();},50);},abort:function(){if(aI&&aI.clean){aI.clean();}}};Y.open();}function av(aI){if(q.webSocketImpl!=null){return q.webSocketImpl;}else{if(window.WebSocket){return new WebSocket(aI);}else{return new MozWebSocket(aI);}}}function w(){return p(q,a.util.getAbsoluteURL(q.webSocketUrl||q.url)).replace(/^http/,"ws");}function T(){var aI=p(q);return aI;}function D(aJ){ar.transport="sse";var aI=T();if(x("debug")){a.util.debug("Invoking executeSSE");a.util.debug("Using URL: "+aI);}if(aJ&&!q.reconnect){if(ag!=null){m();}return;}try{ag=new EventSource(aI,{withCredentials:q.withCredentials});}catch(aK){U(0,aK);az("SSE failed. Downgrading to fallback transport and resending");return;}if(q.connectTimeout>0){q.id=setTimeout(function(){if(!aJ){m();}},q.connectTimeout);}ag.onopen=function(aL){aH("sse.onopen");k(q);if(x("debug")){a.util.debug("SSE successfully opened");}if(!q.enableProtocol){if(!aJ){W("opening","sse",q);}else{W("re-opening","sse",q);}}else{if(q.isReopen){q.isReopen=false;W("re-opening",q.transport,q);}}aJ=true;if(q.method==="POST"){ar.state="messageReceived";ag.send(q.data);}};ag.onmessage=function(aM){aH("sse.onmessage");k(q);if(!q.enableXDR&&aM.origin&&aM.origin!==window.location.protocol+"//"+window.location.host){a.util.log(q.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]);return;}ar.state="messageReceived";ar.status=200;aM=aM.data;var aL=s(aM,q,ar);if(!aL){ai();ar.responseBody="";ar.messages=[];}};ag.onerror=function(aL){aH("sse.onerror");clearTimeout(q.id);if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer);}if(ar.closedByClientTimeout){return;}ae(aJ);m();if(aG){a.util.log(q.logLevel,["SSE closed normally"]);}else{if(!aJ){az("SSE failed. Downgrading to fallback transport and resending");}else{if(q.reconnect&&(ar.transport==="sse")){if(ay++<q.maxReconnectOnClose){W("re-connecting",q.transport,q);if(q.reconnectInterval>0){q.reconnectId=setTimeout(function(){D(true);},q.reconnectInterval);}else{D(true);}ar.responseBody="";ar.messages=[];}else{a.util.log(q.logLevel,["SSE reconnect maximum try reached "+ay]);U(0,"maxReconnectOnClose reached");}}}}};}function af(aJ){ar.transport="websocket";var aI=w(q.url);if(x("debug")){a.util.debug("Invoking executeWebSocket");a.util.debug("Using URL: "+aI);}if(aJ&&!q.reconnect){if(aw!=null){m();}return;}aw=av(aI);if(q.webSocketBinaryType!=null){aw.binaryType=q.webSocketBinaryType;}if(q.connectTimeout>0){q.id=setTimeout(function(){if(!aJ){var aM={code:1002,reason:"",wasClean:false};aw.onclose(aM);try{m();}catch(aN){}return;}},q.connectTimeout);}aw.onopen=function(aN){aH("websocket.onopen");k(q);d=false;if(x("debug")){a.util.debug("Websocket successfully opened");}var aM=aJ;if(aw!=null){aw.canSendMessage=true;}if(!q.enableProtocol){aJ=true;if(aM){W("re-opening","websocket",q);}else{W("opening","websocket",q);}}if(aw!=null){if(q.method==="POST"){ar.state="messageReceived";aw.send(q.data);}}};aw.onmessage=function(aO){aH("websocket.onmessage");k(q);if(q.enableProtocol){aJ=true;}ar.state="messageReceived";ar.status=200;aO=aO.data;var aM=typeof(aO)==="string";if(aM){var aN=s(aO,q,ar);if(!aN){ai();ar.responseBody="";ar.messages=[];}}else{aO=t(q,aO);if(aO===""){return;}ar.responseBody=aO;ai();ar.responseBody=null;}};aw.onerror=function(aM){aH("websocket.onerror");clearTimeout(q.id);if(q.heartbeatTimer){clearTimeout(q.heartbeatTimer);}};aw.onclose=function(aM){aH("websocket.onclose");clearTimeout(q.id);if(ar.state==="closed"){return;}var aN=aM.reason;if(aN===""){switch(aM.code){case 1000:aN="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:aN="The endpoint is going away, either because of a server failure or because the "+"browser is navigating away from the page that opened the connection.";
break;case 1002:aN="The endpoint is terminating the connection due to a protocol error.";break;case 1003:aN="The connection is being terminated because the endpoint received data of a type it "+"cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:aN="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:aN="Unknown: no status code was provided even though one was expected.";break;case 1006:aN="Connection was closed abnormally (that is, with no close frame being sent).";break;}}if(x("warn")){a.util.warn("Websocket closed, reason: "+aN);a.util.warn("Websocket closed, wasClean: "+aM.wasClean);}if(ar.closedByClientTimeout||d){if(q.reconnectId){clearTimeout(q.reconnectId);delete q.reconnectId;}return;}ae(aJ);ar.state="closed";if(aG){a.util.log(q.logLevel,["Websocket closed normally"]);}else{if(!aJ){az("Websocket failed. Downgrading to Comet and resending");}else{if(q.reconnect&&ar.transport==="websocket"&&aM.code!==1001){m();if(ay++<q.maxReconnectOnClose){W("re-connecting",q.transport,q);if(q.reconnectInterval>0){q.reconnectId=setTimeout(function(){ar.responseBody="";ar.messages=[];af(true);},q.reconnectInterval);}else{ar.responseBody="";ar.messages=[];af(true);}}else{a.util.log(q.logLevel,["Websocket reconnect maximum try reached "+q.requestCount]);if(x("warn")){a.util.warn("Websocket error, reason: "+aM.reason);}U(0,"maxReconnectOnClose reached");}}}}};var aK=navigator.userAgent.toLowerCase();var aL=aK.indexOf("android")>-1;if(aL&&aw.url===undefined){aw.onclose({reason:"Android 4.1 does not support websockets.",wasClean:false});}}function t(aM,aL){var aK=aL;if(aM.transport==="polling"){return aK;}if(aM.enableProtocol&&aM.firstMessage&&a.util.trim(aL).length!==0){var aN=aM.trackMessageLength?1:0;var aJ=aL.split(aM.messageDelimiter);if(aJ.length<=aN+1){return aK;}aM.firstMessage=false;aM.uuid=a.util.trim(aJ[aN]);if(aJ.length<=aN+2){a.util.log("error",["Protocol data not sent by the server. "+"If you enable protocol on client side, be sure to install JavascriptProtocol interceptor on server side."+"Also note that atmosphere-runtime 2.2+ should be used."]);}K=parseInt(a.util.trim(aJ[aN+1]),10);ak=aJ[aN+2];if(aM.transport!=="long-polling"){Z(aM);}f=aM.uuid;aK="";aN=aM.trackMessageLength?4:3;if(aJ.length>aN+1){for(var aI=aN;aI<aJ.length;aI++){aK+=aJ[aI];if(aI+1!==aJ.length){aK+=aM.messageDelimiter;}}}if(aM.ackInterval!==0){setTimeout(function(){u("...ACK...");},aM.ackInterval);}}else{if(aM.enableProtocol&&aM.firstMessage&&a.util.browser.msie&&+a.util.browser.version.split(".")[0]<10){a.util.log(q.logLevel,["Receiving unexpected data from IE"]);}else{Z(aM);}}return aK;}function k(aI){clearTimeout(aI.id);if(aI.timeout>0&&aI.transport!=="polling"){aI.id=setTimeout(function(){aC(aI);E();m();},aI.timeout);}}function aC(aI){ar.closedByClientTimeout=true;ar.state="closedByClient";ar.responseBody="";ar.status=408;ar.messages=[];ai();}function U(aI,aJ){m();clearTimeout(q.id);ar.state="error";ar.reasonPhrase=aJ;ar.responseBody="";ar.status=aI;ar.messages=[];ai();}function s(aM,aL,aI){aM=t(aL,aM);if(aM.length===0){return true;}aI.responseBody=aM;if(aL.trackMessageLength){aM=aI.partialMessage+aM;var aK=[];var aJ=aM.indexOf(aL.messageDelimiter);if(aJ!=-1){while(aJ!==-1){var aO=aM.substring(0,aJ);var aN=+aO;if(isNaN(aN)){throw new Error('message length "'+aO+'" is not a number');}aJ+=aL.messageDelimiter.length;if(aJ+aN>aM.length){aJ=-1;}else{aK.push(aM.substring(aJ,aJ+aN));aM=aM.substring(aJ+aN,aM.length);aJ=aM.indexOf(aL.messageDelimiter);}}aI.partialMessage=aM;if(aK.length!==0){aI.responseBody=aK.join(aL.messageDelimiter);aI.messages=aK;return false;}else{aI.responseBody="";aI.messages=[];return true;}}}aI.responseBody=aM;aI.messages=[aM];return false;}function az(aI){a.util.log(q.logLevel,[aI]);if(typeof(q.onTransportFailure)!=="undefined"){q.onTransportFailure(aI,q);}else{if(typeof(a.util.onTransportFailure)!=="undefined"){a.util.onTransportFailure(aI,q);}}q.transport=q.fallbackTransport;var aJ=q.connectTimeout===-1?0:q.connectTimeout;if(q.reconnect&&q.transport!=="none"||q.transport==null){q.method=q.fallbackMethod;ar.transport=q.fallbackTransport;q.fallbackTransport="none";if(aJ>0){q.reconnectId=setTimeout(function(){aa();},aJ);}else{aa();}}else{U(500,"Unable to reconnect with fallback transport");}}function p(aK,aI){var aJ=q;if((aK!=null)&&(typeof(aK)!=="undefined")){aJ=aK;}if(aI==null){aI=aJ.url;}if(!aJ.attachHeadersAsQueryString){return aI;}if(aI.indexOf("X-Atmosphere-Framework")!==-1){return aI;}aI+=(aI.indexOf("?")!==-1)?"&":"?";aI+="X-Atmosphere-tracking-id="+aJ.uuid;aI+="&X-Atmosphere-Framework="+c;aI+="&X-Atmosphere-Transport="+aJ.transport;if(aJ.trackMessageLength){aI+="&X-Atmosphere-TrackMessageSize="+"true";}if(aJ.heartbeat!==null&&aJ.heartbeat.server!==null){aI+="&X-Heartbeat-Server="+aJ.heartbeat.server;}if(aJ.contentType!==""){aI+="&Content-Type="+(aJ.transport==="websocket"?aJ.contentType:encodeURIComponent(aJ.contentType));}if(aJ.enableProtocol){aI+="&X-atmo-protocol=true";}a.util.each(aJ.headers,function(aL,aN){var aM=a.util.isFunction(aN)?aN.call(this,aJ,aK,ar):aN;if(aM!=null){aI+="&"+encodeURIComponent(aL)+"="+encodeURIComponent(aM);}});return aI;}function Z(aI){if(!aI.isOpen){aI.isOpen=true;W("opening",aI.transport,aI);}else{if(aI.isReopen){aI.isReopen=false;W("re-opening",aI.transport,aI);}else{if(ar.state==="messageReceived"&&(aI.transport==="jsonp"||aI.transport==="long-polling")){ap(ar);}else{return;}}}C(aI);}function C(aJ){if(aJ.heartbeatTimer!=null){clearTimeout(aJ.heartbeatTimer);}if(!isNaN(K)&&K>0){var aI=function(){if(x("debug")){a.util.debug("Sending heartbeat");}u(ak);aJ.heartbeatTimer=setTimeout(aI,K);};aJ.heartbeatTimer=setTimeout(aI,K);}}function M(aL){var aJ=q;if((aL!=null)||(typeof(aL)!=="undefined")){aJ=aL;}aJ.lastIndex=0;aJ.readyState=0;if((aJ.transport==="jsonp")||((aJ.enableXDR)&&(a.util.checkCORSSupport()))){aB(aJ);return;}if(a.util.browser.msie&&+a.util.browser.version.split(".")[0]<10){if((aJ.transport==="streaming")){if(aJ.enableXDR&&window.XDomainRequest){Q(aJ);}else{aA(aJ);}return;}if((aJ.enableXDR)&&(window.XDomainRequest)){Q(aJ);return;}}var aM=function(aO){aJ.lastIndex=0;if(aO||(aJ.reconnect&&ay++<aJ.maxReconnectOnClose)){ar.ffTryingReconnect=true;W("re-connecting",aL.transport,aL);an(aK,aJ,aL.reconnectInterval);}else{U(0,"maxReconnectOnClose reached");}};var aI=function(){ar.errorHandled=true;m();aM(false);};if(aJ.force||(aJ.reconnect&&(aJ.maxRequest===-1||aJ.requestCount++<aJ.maxRequest))){aJ.force=false;var aK=a.util.xhr();aK.hasData=false;N(aK,aJ,true);if(aJ.suspend){A=aK;}if(aJ.transport!=="polling"){ar.transport=aJ.transport;aK.onabort=function(){aH("ajaxrequest.onabort");ae(true);};aK.onerror=function(){aH("ajaxrequest.onerror");ar.error=true;ar.ffTryingReconnect=true;try{ar.status=XMLHttpRequest.status;}catch(aO){ar.status=500;}if(!ar.status){ar.status=500;}if(!ar.errorHandled){m();aM(false);}};}aK.onreadystatechange=function(){aH("ajaxRequest.onreadystatechange, new state: "+aK.readyState);if(aG){return;}ar.error=null;var aP=false;var aV=false;if(aJ.transport==="streaming"&&aJ.readyState>2&&aK.readyState===4){m();aM(false);return;}aJ.readyState=aK.readyState;if(aJ.transport==="streaming"&&aK.readyState>=3){aV=true;}else{if(aJ.transport==="long-polling"&&aK.readyState===4){aV=true;}}k(q);if(aJ.transport!=="polling"){var aO=200;if(aK.readyState===4){aO=aK.status>1000?0:aK.status;}if(!aJ.reconnectOnServerError&&(aO>=300&&aO<600)){U(aO,aK.statusText);return;}if(aO>=300||aO===0){aI();return;}if((!aJ.enableProtocol||!aL.firstMessage)&&aK.readyState===2){if(a.util.browser.mozilla&&ar.ffTryingReconnect){ar.ffTryingReconnect=false;setTimeout(function(){if(!ar.ffTryingReconnect){Z(aJ);}},500);}else{Z(aJ);}}}else{if(aK.readyState===4){aV=true;}}if(aV){var aS=aK.responseText;ar.errorHandled=false;if(aJ.transport==="long-polling"&&a.util.trim(aS).length===0){if(!aK.hasData){aM(true);}else{aK.hasData=false;}return;}aK.hasData=true;
H(aK,q);if(aJ.transport==="streaming"){if(!a.util.browser.opera){var aR=aS.substring(aJ.lastIndex,aS.length);aP=s(aR,aJ,ar);aJ.lastIndex=aS.length;if(aP){return;}}else{a.util.iterate(function(){if(ar.status!==500&&aK.responseText.length>aJ.lastIndex){try{ar.status=aK.status;ar.headers=a.util.parseHeaders(aK.getAllResponseHeaders());H(aK,q);}catch(aX){ar.status=404;}k(q);ar.state="messageReceived";var aW=aK.responseText.substring(aJ.lastIndex);aJ.lastIndex=aK.responseText.length;aP=s(aW,aJ,ar);if(!aP){ai();}if(J(aK,aJ)){L(aK,aJ);return;}}else{if(ar.status>400){aJ.lastIndex=aK.responseText.length;return false;}}},0);}}else{aP=s(aS,aJ,ar);}var aU=J(aK,aJ);try{ar.status=aK.status;ar.headers=a.util.parseHeaders(aK.getAllResponseHeaders());H(aK,aJ);}catch(aT){ar.status=404;}if(aJ.suspend){ar.state=ar.status===0?"closed":"messageReceived";}else{ar.state="messagePublished";}var aQ=!aU&&aL.transport!=="streaming"&&aL.transport!=="polling";if(aQ&&!aJ.executeCallbackBeforeReconnect){an(aK,aJ,aJ.pollingInterval);}if(ar.responseBody.length!==0&&!aP){ai();}if(aQ&&aJ.executeCallbackBeforeReconnect){an(aK,aJ,aJ.pollingInterval);}if(aU){L(aK,aJ);}}};try{aK.send(aJ.data);v=true;}catch(aN){a.util.log(aJ.logLevel,["Unable to connect to "+aJ.url]);U(0,aN);}}else{if(aJ.logLevel==="debug"){a.util.log(aJ.logLevel,["Max re-connection reached."]);}U(0,"maxRequest reached");}}function L(aJ,aI){ar.messages=[];aI.isReopen=true;I();aG=false;an(aJ,aI,500);}function N(aK,aL,aJ){var aI=aL.url;if(aL.dispatchUrl!=null&&aL.method==="POST"){aI+=aL.dispatchUrl;}aI=p(aL,aI);aI=a.util.prepareURL(aI);if(aJ){aK.open(aL.method,aI,aL.async);if(aL.connectTimeout>0){aL.id=setTimeout(function(){if(aL.requestCount===0){m();l("Connect timeout","closed",200,aL.transport);}},aL.connectTimeout);}}if(q.withCredentials&&q.transport!=="websocket"){if("withCredentials" in aK){aK.withCredentials=true;}}if(!q.dropHeaders){aK.setRequestHeader("X-Atmosphere-Framework",a.util.version);aK.setRequestHeader("X-Atmosphere-Transport",aL.transport);if(aL.heartbeat!==null&&aL.heartbeat.server!==null){aK.setRequestHeader("X-Heartbeat-Server",aK.heartbeat.server);}if(aL.trackMessageLength){aK.setRequestHeader("X-Atmosphere-TrackMessageSize","true");}aK.setRequestHeader("X-Atmosphere-tracking-id",aL.uuid);a.util.each(aL.headers,function(aM,aO){var aN=a.util.isFunction(aO)?aO.call(this,aK,aL,aJ,ar):aO;if(aN!=null){aK.setRequestHeader(aM,aN);}});}if(aL.contentType!==""){aK.setRequestHeader("Content-Type",aL.contentType);}}function an(aJ,aK,aL){if(ar.closedByClientTimeout){return;}if(aK.reconnect||(aK.suspend&&v)){var aI=0;if(aJ&&aJ.readyState>1){aI=aJ.status>1000?0:aJ.status;}ar.status=aI===0?204:aI;ar.reason=aI===0?"Server resumed the connection or down.":"OK";clearTimeout(aK.id);if(aK.reconnectId){clearTimeout(aK.reconnectId);delete aK.reconnectId;}if(aL>0){q.reconnectId=setTimeout(function(){M(aK);},aL);}else{M(aK);}}}function r(aI){aI.state="re-connecting";al(aI);}function ap(aI){aI.state="openAfterResume";al(aI);aI.state="messageReceived";}function Q(aI){if(aI.transport!=="polling"){o=ac(aI);o.open();}else{ac(aI).open();}}function ac(aK){var aJ=q;if((aK!=null)&&(typeof(aK)!=="undefined")){aJ=aK;}var aP=aJ.transport;var aO=0;var aI=new window.XDomainRequest();var aM=function(){if(aJ.transport==="long-polling"&&(aJ.reconnect&&(aJ.maxRequest===-1||aJ.requestCount++<aJ.maxRequest))){aI.status=200;Q(aJ);}};var aN=aJ.rewriteURL||function(aR){var aQ=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(aQ&&aQ[1]){case"JSESSIONID":return aR.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+aQ[2]+"$1");case"PHPSESSID":return aR.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+aQ[2]+"&").replace(/&$/,"");}return aR;};aI.onprogress=function(){aL(aI);};aI.onerror=function(){if(aJ.transport!=="polling"){m();if(ay++<aJ.maxReconnectOnClose){if(aJ.reconnectInterval>0){aJ.reconnectId=setTimeout(function(){W("re-connecting",aK.transport,aK);Q(aJ);},aJ.reconnectInterval);}else{W("re-connecting",aK.transport,aK);Q(aJ);}}else{U(0,"maxReconnectOnClose reached");}}};aI.onload=function(){};var aL=function(aQ){clearTimeout(aJ.id);var aS=aQ.responseText;aS=aS.substring(aO);aO+=aS.length;if(aP!=="polling"){k(aJ);var aR=s(aS,aJ,ar);if(aP==="long-polling"&&a.util.trim(aS).length===0){return;}if(aJ.executeCallbackBeforeReconnect){aM();}if(!aR){l(ar.responseBody,"messageReceived",200,aP);}if(!aJ.executeCallbackBeforeReconnect){aM();}}};return{open:function(){var aQ=aJ.url;if(aJ.dispatchUrl!=null){aQ+=aJ.dispatchUrl;}aQ=p(aJ,aQ);aI.open(aJ.method,aN(aQ));if(aJ.method==="GET"){aI.send();}else{aI.send(aJ.data);}if(aJ.connectTimeout>0){aJ.id=setTimeout(function(){if(aJ.requestCount===0){m();l("Connect timeout","closed",200,aJ.transport);}},aJ.connectTimeout);}},close:function(){aI.abort();}};}function aA(aI){o=ab(aI);o.open();}function ab(aL){var aK=q;if((aL!=null)&&(typeof(aL)!=="undefined")){aK=aL;}var aJ;var aM=new window.ActiveXObject("htmlfile");aM.open();aM.close();var aI=aK.url;if(aK.dispatchUrl!=null){aI+=aK.dispatchUrl;}if(aK.transport!=="polling"){ar.transport=aK.transport;}return{open:function(){var aN=aM.createElement("iframe");aI=p(aK);if(aK.data!==""){aI+="&X-Atmosphere-Post-Body="+encodeURIComponent(aK.data);}aI=a.util.prepareURL(aI);aN.src=aI;aM.body.appendChild(aN);var aO=aN.contentDocument||aN.contentWindow.document;aJ=a.util.iterate(function(){try{if(!aO.firstChild){return;}var aR=aO.body?aO.body.lastChild:aO;var aT=function(){var aV=aR.cloneNode(true);aV.appendChild(aO.createTextNode("."));var aU=aV.innerText;aU=aU.substring(0,aU.length-1);return aU;};if(!aO.body||!aO.body.firstChild||aO.body.firstChild.nodeName.toLowerCase()!=="pre"){var aQ=aO.head||aO.getElementsByTagName("head")[0]||aO.documentElement||aO;var aP=aO.createElement("script");aP.text="document.write('<plaintext>')";aQ.insertBefore(aP,aQ.firstChild);aQ.removeChild(aP);aR=aO.body.lastChild;}if(aK.closed){aK.isReopen=true;}aJ=a.util.iterate(function(){var aV=aT();if(aV.length>aK.lastIndex){k(q);ar.status=200;ar.error=null;aR.innerText="";var aU=s(aV,aK,ar);if(aU){return"";}l(ar.responseBody,"messageReceived",200,aK.transport);}aK.lastIndex=0;if(aO.readyState==="complete"){ae(true);W("re-connecting",aK.transport,aK);if(aK.reconnectInterval>0){aK.reconnectId=setTimeout(function(){aA(aK);},aK.reconnectInterval);}else{aA(aK);}return false;}},null);return false;}catch(aS){ar.error=true;W("re-connecting",aK.transport,aK);if(ay++<aK.maxReconnectOnClose){if(aK.reconnectInterval>0){aK.reconnectId=setTimeout(function(){aA(aK);},aK.reconnectInterval);}else{aA(aK);}}else{U(0,"maxReconnectOnClose reached");}aM.execCommand("Stop");aM.close();return false;}});},close:function(){if(aJ){aJ();}aM.execCommand("Stop");ae(true);}};}function u(aI){if(ax!=null){F(aI);}else{if(A!=null||ag!=null){P(aI);}else{if(o!=null){j(aI);}else{if(Y!=null){B(aI);}else{if(aw!=null){X(aI);}else{U(0,"No suspended connection available");a.util.error("No suspended connection available. Make sure atmosphere.subscribe has been called and request.onOpen invoked before trying to push data");}}}}}}function am(aJ,aI){if(!aI){aI=y(aJ);}aI.transport="polling";aI.method="GET";aI.withCredentials=false;aI.reconnect=false;aI.force=true;aI.suspend=false;aI.timeout=1000;M(aI);}function F(aI){ax.send(aI);}function aq(aJ){if(aJ.length===0){return;}try{if(ax){ax.localSend(aJ);}else{if(i){i.signal("localMessage",a.util.stringifyJSON({id:S,event:aJ}));}}}catch(aI){a.util.error(aI);}}function P(aJ){var aI=y(aJ);M(aI);}function j(aJ){if(q.enableXDR&&a.util.checkCORSSupport()){var aI=y(aJ);aI.reconnect=false;aB(aI);}else{P(aJ);}}function B(aI){P(aI);}function O(aI){var aJ=aI;if(typeof(aJ)==="object"){aJ=aI.data;}return aJ;}function y(aJ){var aK=O(aJ);var aI={connected:false,timeout:60000,method:"POST",url:q.url,contentType:q.contentType,headers:q.headers,reconnect:true,callback:null,data:aK,suspend:false,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:q.withCredentials,async:q.async,transport:"polling",isOpen:true,attachHeadersAsQueryString:true,enableXDR:q.enableXDR,uuid:q.uuid,dispatchUrl:q.dispatchUrl,enableProtocol:false,messageDelimiter:"|",trackMessageLength:q.trackMessageLength,maxReconnectOnClose:q.maxReconnectOnClose,heartbeatTimer:q.heartbeatTimer,heartbeat:q.heartbeat};
if(typeof(aJ)==="object"){aI=a.util.extend(aI,aJ);}return aI;}function X(aI){var aL=a.util.isBinary(aI)?aI:O(aI);var aJ;try{if(q.dispatchUrl!=null){aJ=q.webSocketPathDelimiter+q.dispatchUrl+q.webSocketPathDelimiter+aL;}else{aJ=aL;}if(!aw.canSendMessage){a.util.error("WebSocket not connected.");return;}aw.send(aJ);}catch(aK){aw.onclose=function(aM){};m();az("Websocket failed. Downgrading to Comet and resending "+aI);P(aI);}}function G(aJ){var aI=a.util.parseJSON(aJ);if(aI.id!==S){if(typeof(q.onLocalMessage)!=="undefined"){q.onLocalMessage(aI.event);}else{if(typeof(a.util.onLocalMessage)!=="undefined"){a.util.onLocalMessage(aI.event);}}}}function l(aL,aI,aJ,aK){ar.responseBody=aL;ar.transport=aK;ar.status=aJ;ar.state=aI;ai();}function H(aI,aK){if(!aK.readResponsesHeaders){if(!aK.enableProtocol){aK.uuid=S;}}else{try{var aJ=aI.getResponseHeader("X-Atmosphere-tracking-id");if(aJ&&aJ!=null){aK.uuid=aJ.split(" ").pop();}}catch(aL){}}}function al(aI){n(aI,q);n(aI,a.util);}function n(aJ,aK){switch(aJ.state){case"messageReceived":aH("Firing onMessage");ay=0;if(typeof(aK.onMessage)!=="undefined"){aK.onMessage(aJ);}if(typeof(aK.onmessage)!=="undefined"){aK.onmessage(aJ);}break;case"error":aH("Firing onError");if(typeof(aK.onError)!=="undefined"){aK.onError(aJ);}if(typeof(aK.onerror)!=="undefined"){aK.onerror(aJ);}break;case"opening":delete q.closed;aH("Firing onOpen");if(typeof(aK.onOpen)!=="undefined"){aK.onOpen(aJ);}if(typeof(aK.onopen)!=="undefined"){aK.onopen(aJ);}break;case"messagePublished":aH("Firing messagePublished");if(typeof(aK.onMessagePublished)!=="undefined"){aK.onMessagePublished(aJ);}break;case"re-connecting":aH("Firing onReconnect");if(typeof(aK.onReconnect)!=="undefined"){aK.onReconnect(q,aJ);}break;case"closedByClient":aH("Firing closedByClient");if(typeof(aK.onClientTimeout)!=="undefined"){aK.onClientTimeout(q);}break;case"re-opening":delete q.closed;aH("Firing onReopen");if(typeof(aK.onReopen)!=="undefined"){aK.onReopen(q,aJ);}break;case"fail-to-reconnect":aH("Firing onFailureToReconnect");if(typeof(aK.onFailureToReconnect)!=="undefined"){aK.onFailureToReconnect(q,aJ);}break;case"unsubscribe":case"closed":var aI=typeof(q.closed)!=="undefined"?q.closed:false;if(!aI){aH("Firing onClose");if(typeof(aK.onClose)!=="undefined"){aK.onClose(aJ);}if(typeof(aK.onclose)!=="undefined"){aK.onclose(aJ);}}else{aH("Closed but not firing onClose");}q.closed=true;break;case"openAfterResume":if(typeof(aK.onOpenAfterResume)!=="undefined"){aK.onOpenAfterResume(q);}break;}}function ae(aI){if(ar.state!=="closed"){ar.state="closed";ar.responseBody="";ar.messages=[];ar.status=!aI?501:200;ai();}}function ai(){var aK=function(aN,aO){aO(ar);};if(ax==null&&R!=null){R(ar.responseBody);}q.reconnect=q.mrequest;var aI=typeof(ar.responseBody)==="string";var aL=(aI&&q.trackMessageLength)?(ar.messages.length>0?ar.messages:[""]):new Array(ar.responseBody);for(var aJ=0;aJ<aL.length;aJ++){if(aL.length>1&&aL[aJ].length===0){continue;}ar.responseBody=(aI)?a.util.trim(aL[aJ]):aL[aJ];if(ax==null&&R!=null){R(ar.responseBody);}if((ar.responseBody.length===0||(aI&&ak===ar.responseBody))&&ar.state==="messageReceived"){continue;}al(ar);if(g.length>0){if(x("debug")){a.util.debug("Invoking "+g.length+" global callbacks: "+ar.state);}try{a.util.each(g,aK);}catch(aM){a.util.log(q.logLevel,["Callback exception"+aM]);}}if(typeof(q.callback)==="function"){if(x("debug")){a.util.debug("Invoking request callbacks");}try{q.callback(ar);}catch(aM){a.util.log(q.logLevel,["Callback exception"+aM]);}}}}this.subscribe=function(aI){ao(aI);aa();};this.execute=function(){aa();};this.close=function(){I();};this.disconnect=function(){E();};this.getUrl=function(){return q.url;};this.push=function(aK,aJ){if(aJ!=null){var aI=q.dispatchUrl;q.dispatchUrl=aJ;u(aK);q.dispatchUrl=aI;}else{u(aK);}};this.getUUID=function(){return q.uuid;};this.pushLocal=function(aI){aq(aI);};this.enableProtocol=function(aI){return q.enableProtocol;};this.init=function(){aj();};this.request=q;this.response=ar;}};a.subscribe=function(i,l,k){if(typeof(l)==="function"){a.addCallback(l);}if(typeof(i)!=="string"){k=i;}else{k.url=i;}f=((typeof(k)!=="undefined")&&typeof(k.uuid)!=="undefined")?k.uuid:0;var j=new a.AtmosphereRequest(k);j.execute();h[h.length]=j;return j;};a.unsubscribe=function(){if(h.length>0){var j=[].concat(h);for(var l=0;l<j.length;l++){var k=j[l];k.close();clearTimeout(k.response.request.id);if(k.heartbeatTimer){clearTimeout(k.heartbeatTimer);}}}h=[];g=[];};a.unsubscribeUrl=function(k){var j=-1;if(h.length>0){for(var m=0;m<h.length;m++){var l=h[m];if(l.getUrl()===k){l.close();clearTimeout(l.response.request.id);if(l.heartbeatTimer){clearTimeout(l.heartbeatTimer);}j=m;break;}}}if(j>=0){h.splice(j,1);}};a.addCallback=function(i){if(a.util.inArray(i,g)===-1){g.push(i);}};a.removeCallback=function(j){var i=a.util.inArray(j,g);if(i!==-1){g.splice(i,1);}};a.util={browser:{},parseHeaders:function(j){var i,l=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,k={};while(i=l.exec(j)){k[i[1]]=i[2];}return k;},now:function(){return new Date().getTime();},isArray:function(i){return Object.prototype.toString.call(i)==="[object Array]";},inArray:function(l,m){if(!Array.prototype.indexOf){var j=m.length;for(var k=0;k<j;++k){if(m[k]===l){return k;}}return -1;}return m.indexOf(l);},isBinary:function(i){return/^\[object\s(?:Blob|ArrayBuffer|.+Array)\]$/.test(Object.prototype.toString.call(i));},isFunction:function(i){return Object.prototype.toString.call(i)==="[object Function]";},getAbsoluteURL:function(i){var j=document.createElement("div");j.innerHTML='<a href="'+i+'"/>';return encodeURI(decodeURI(j.firstChild.href));},prepareURL:function(j){var k=a.util.now();var i=j.replace(/([?&])_=[^&]*/,"$1_="+k);return i+(i===j?(/\?/.test(j)?"&":"?")+"_="+k:"");},trim:function(i){if(!String.prototype.trim){return i.toString().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ");}else{return i.toString().trim();}},param:function(m){var k,i=[];function l(n,o){o=a.util.isFunction(o)?o():(o==null?"":o);i.push(encodeURIComponent(n)+"="+encodeURIComponent(o));}function j(o,p){var n;if(a.util.isArray(p)){a.util.each(p,function(r,q){if(/\[\]$/.test(o)){l(o,q);}else{j(o+"["+(typeof q==="object"?r:"")+"]",q);}});}else{if(Object.prototype.toString.call(p)==="[object Object]"){for(n in p){j(o+"["+n+"]",p[n]);}}else{l(o,p);}}}for(k in m){j(k,m[k]);}return i.join("&").replace(/%20/g,"+");},storage:function(){try{return !!(window.localStorage&&window.StorageEvent);}catch(i){return false;}},iterate:function(k,j){var l;j=j||0;(function i(){l=setTimeout(function(){if(k()===false){return;}i();},j);})();return function(){clearTimeout(l);};},each:function(o,p,k){if(!o){return;}var n,l=0,m=o.length,j=a.util.isArray(o);if(k){if(j){for(;l<m;l++){n=p.apply(o[l],k);if(n===false){break;}}}else{for(l in o){n=p.apply(o[l],k);if(n===false){break;}}}}else{if(j){for(;l<m;l++){n=p.call(o[l],l,o[l]);if(n===false){break;}}}else{for(l in o){n=p.call(o[l],l,o[l]);if(n===false){break;}}}}return o;},extend:function(m){var l,k,j;for(l=1;l<arguments.length;l++){if((k=arguments[l])!=null){for(j in k){m[j]=k[j];}}}return m;},on:function(k,j,i){if(k.addEventListener){k.addEventListener(j,i,false);}else{if(k.attachEvent){k.attachEvent("on"+j,i);}}},off:function(k,j,i){if(k.removeEventListener){k.removeEventListener(j,i,false);}else{if(k.detachEvent){k.detachEvent("on"+j,i);}}},log:function(k,j){if(window.console){var i=window.console[k];if(typeof i==="function"){i.apply(window.console,j);}}},warn:function(){a.util.log("warn",arguments);},info:function(){a.util.log("info",arguments);},debug:function(){a.util.log("debug",arguments);},error:function(){a.util.log("error",arguments);},xhr:function(){try{return new window.XMLHttpRequest();}catch(j){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(i){}}},parseJSON:function(i){return !i?null:window.JSON&&window.JSON.parse?window.JSON.parse(i):new Function("return "+i)();},stringifyJSON:function(k){var n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
function i(o){return'"'+o.replace(n,function(p){var q=l[p];return typeof q==="string"?q:"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4);})+'"';}function j(o){return o<10?"0"+o:o;}return window.JSON&&window.JSON.stringify?window.JSON.stringify(k):(function m(t,s){var r,q,o,p,w=s[t],u=typeof w;if(w&&typeof w==="object"&&typeof w.toJSON==="function"){w=w.toJSON(t);u=typeof w;}switch(u){case"string":return i(w);case"number":return isFinite(w)?String(w):"null";case"boolean":return String(w);case"object":if(!w){return"null";}switch(Object.prototype.toString.call(w)){case"[object Date]":return isFinite(w.valueOf())?'"'+w.getUTCFullYear()+"-"+j(w.getUTCMonth()+1)+"-"+j(w.getUTCDate())+"T"+j(w.getUTCHours())+":"+j(w.getUTCMinutes())+":"+j(w.getUTCSeconds())+"Z"+'"':"null";case"[object Array]":o=w.length;p=[];for(r=0;r<o;r++){p.push(m(r,w)||"null");}return"["+p.join(",")+"]";default:p=[];for(r in w){if(b.call(w,r)){q=m(r,w);if(q){p.push(i(r)+":"+q);}}}return"{"+p.join(",")+"}";}}})("",{"":k});},checkCORSSupport:function(){if(a.util.browser.msie&&!window.XDomainRequest&&+a.util.browser.version.split(".")[0]<11){return true;}else{if(a.util.browser.opera&&+a.util.browser.version.split(".")<12){return true;}else{if(a.util.trim(navigator.userAgent).slice(0,16)==="KreaTVWebKit/531"){return true;}else{if(a.util.trim(navigator.userAgent).slice(-7).toLowerCase()==="kreatel"){return true;}}}}var i=navigator.userAgent.toLowerCase();var j=i.indexOf("android")>-1;if(j){return true;}return false;}};e=a.util.now();(function(){var j=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(j)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(j)||/(msie) ([\w.]+)/.exec(j)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(j)||j.indexOf("android")<0&&/version\/(.+) (safari)/.exec(j)||j.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(j)||[];if(i[2]==="safari"){i[2]=i[1];i[1]="safari";}a.util.browser[i[1]||""]=true;a.util.browser.version=i[2]||"0";a.util.browser.vmajor=a.util.browser.version.split(".")[0];if(a.util.browser.trident){a.util.browser.msie=true;}if(a.util.browser.msie||(a.util.browser.mozilla&&+a.util.browser.version.split(".")[0]===1)){a.util.storage=false;}})();a.util.on(window,"unload",function(i){a.util.debug(new Date()+" Atmosphere: "+"unload event");a.unsubscribe();});a.util.on(window,"beforeunload",function(i){a.util.debug(new Date()+" Atmosphere: "+"beforeunload event");a.unsubscribe();});a.util.on(window,"keypress",function(i){if(i.charCode===27||i.keyCode===27){if(i.preventDefault){i.preventDefault();}}});a.util.on(window,"offline",function(){d=true;if(h.length>0){var j=[].concat(h);for(var l=0;l<j.length;l++){var k=j[l];k.close();clearTimeout(k.response.request.id);if(k.heartbeatTimer){clearTimeout(k.heartbeatTimer);}}}});a.util.on(window,"online",function(){if(h.length>0){for(var j=0;j<h.length;j++){h[j].init();h[j].execute();}}d=false;});return a;}));;
/*---
/js/retina.js
---*/
/*!
 * Retina.js v1.3.0++
 *
 * Copyright 2014 Imulus, LLC
 * Released under the MIT license
 *
 * Retina.js is an open source script that makes it easy to serve
 * high-resolution images to devices with retina displays.
 */
(function(){var c=(typeof exports==="undefined"?window:exports);var d={retinaImageSuffix:"@2x",check_mime_type:true,force_original_dimensions:true};function b(){}c.Retina=b;b.configure=function(h){if(h===null){h={};}for(var i in h){if(h.hasOwnProperty(i)){d[i]=h[i];}}};b.init=function(h){if(h===null){h=c;}var i=h.onload||function(){};h.onload=function(){var j=document.getElementsByTagName("img"),k=[],l,m;for(l=0;l<j.length;l+=1){m=j[l];if(!!!m.getAttributeNode("data-no-retina")){k.push(new e(m));}}i();};};b.isRetina=function(){var h="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";if(c.devicePixelRatio>1){return true;}if(c.matchMedia&&c.matchMedia(h).matches){return true;}return false;};var g=/\.\w+$/;function a(h){return d.retinaImageSuffix+h;}function f(k,i){this.path=k||"";if(typeof i!=="undefined"&&i!==null){this.at_2x_path=i;this.perform_check=false;}else{if(undefined!==document.createElement){var h=document.createElement("a");h.href=this.path;h.pathname=h.pathname.replace(g,a);this.at_2x_path=h.href;}else{var j=this.path.split("?");j[0]=j[0].replace(g,a);this.at_2x_path=j.join("?");}this.perform_check=true;}}c.RetinaImagePath=f;f.confirmed_paths=[];f.prototype.is_external=function(){return !!(this.path.match(/^https?\:/i)&&!this.path.match("//"+document.domain));};f.prototype.check_2x_variant=function(j){var h,i=this;if(this.is_external()){return j(false);}else{if(!this.perform_check&&typeof this.at_2x_path!=="undefined"&&this.at_2x_path!==null){return j(true);}else{if(f.confirmed_paths.indexOf(this.at_2x_path)!==-1){return j(true);}else{f.confirmed_paths.push(i.at_2x_path);h=new XMLHttpRequest();h.open("HEAD",this.at_2x_path);h.onreadystatechange=function(){var l,k=false;if(h.readyState===4){if(h.status>=200&&h.status<=399){l=h.getResponseHeader("Content-Type");if(!d.check_mime_type||l!==null&&l.match(/^image/i)){k=true;}}if(!k){f.confirmed_paths=f.confirmed_paths.filter(function(m){return m!==i.at_2x_path;});}return j(k);}};h.send();}}}};function e(h){this.el=h;this.path=new f(this.el.getAttribute("src"),this.el.getAttribute("data-at2x"));var i=this;this.path.check_2x_variant(function(j){if(j){i.swap();}});}c.RetinaImage=e;e.prototype.swap=function(j){if(typeof j==="undefined"){j=this.path.at_2x_path;}var h=this;function i(){if(!h.el.complete){setTimeout(i,5);}else{if(d.force_original_dimensions){if(h.el.offsetWidth===0&&h.el.offsetHeight===0){h.el.setAttribute("width",h.el.naturalWidth);h.el.setAttribute("height",h.el.naturalHeight);}else{h.el.setAttribute("width",h.el.offsetWidth);h.el.setAttribute("height",h.el.offsetHeight);}}h.el.setAttribute("src",j);h.el.setAttribute("data-no-retina",true);}}i();};if(b.isRetina()){b.init(c);}})();;